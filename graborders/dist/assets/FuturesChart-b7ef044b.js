import{h as Ft,j as Ct}from"./index-7e817a56.js";/**
     * @license
     * KLineChart v10.0.0-alpha5
     * Copyright (c) 2019 lihu.
     * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
     */var Te=function(r,e){return Te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])},Te(r,e)};function V(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Te(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var R=function(){return R=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},R.apply(this,arguments)};function re(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(r);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(r,i[a])&&(t[i[a]]=r[i[a]]);return t}function sr(r,e,t,i){function a(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function s(h){try{u(i.next(h))}catch(c){o(c)}}function l(h){try{u(i.throw(h))}catch(c){o(c)}}function u(h){h.done?n(h.value):a(h.value).then(s,l)}u((i=i.apply(r,e||[])).next())})}function lr(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,a,n,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(h){return l([u,h])}}function l(u){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(i=1,a&&(n=u[0]&2?a.return:u[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,u[1])).done)return n;switch(a=0,n&&(u=[u[0]&2,n.value]),u[0]){case 0:case 1:n=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,a=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){t.label=u[1];break}if(u[0]===6&&t.label<n[1]){t.label=n[1],n=u;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(u);break}n[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(h){u=[6,h],a=0}finally{i=n=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function ut(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function It(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),a,n=[],o;try{for(;(e===void 0||e-- >0)&&!(a=i.next()).done;)n.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return n}function ae(r,e,t){if(t||arguments.length===2)for(var i=0,a=e.length,n;i<a;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return r.concat(n||Array.prototype.slice.call(e))}function q(r,e){if(!(!Et(r)&&!Et(e))){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=r[t],a=e[t];Et(a)&&Et(i)?q(i,a):S(e[t])&&(r[t]=ie(e[t]))}}}function ie(r){if(!Et(r))return r;var e=null;At(r)?e=[]:e={};for(var t in r)if(Object.prototype.hasOwnProperty.call(r,t)){var i=r[t];Et(i)?e[t]=ie(i):e[t]=i}return e}function At(r){return Object.prototype.toString.call(r)==="[object Array]"}function at(r){return typeof r=="function"}function Et(r){return typeof r=="object"&&S(r)}function B(r){return typeof r=="number"&&Number.isFinite(r)}function S(r){return r!=null}function Ce(r){return typeof r=="boolean"}function Y(r){return typeof r=="string"}function Zt(r){return r==="transparent"||r==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(r)||/^[hH][Ss][Ll][Aa]\(([\s]*(360ï½œ3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(r)}function Bt(r,e){var t=r.replace(/^#/,""),i=parseInt(t,16),a=i>>16&255,n=i>>8&255,o=i&255;return"rgba(".concat(a,", ").concat(n,", ").concat(o,", ").concat(e??1,")")}var H;(function(r){r.Dashed="dashed",r.Solid="solid"})(H||(H={}));var Pe;(function(r){r.Stroke="stroke",r.Fill="fill"})(Pe||(Pe={}));var X;(function(r){r.Stroke="stroke",r.Fill="fill",r.StrokeFill="stroke_fill"})(X||(X={}));var qt;(function(r){r.Always="always",r.FollowCross="follow_cross",r.None="none"})(qt||(qt={}));var St;(function(r){r.Standard="standard",r.Rect="rect"})(St||(St={}));var ge;(function(r){r.Path="path",r.IconFont="icon_font"})(ge||(ge={}));var Kt;(function(r){r.Left="left",r.Middle="middle",r.Right="right"})(Kt||(Kt={}));var pe;(function(r){r.Fixed="fixed",r.Pointer="pointer"})(pe||(pe={}));var ft;(function(r){r.CandleSolid="candle_solid",r.CandleStroke="candle_stroke",r.CandleUpStroke="candle_up_stroke",r.CandleDownStroke="candle_down_stroke",r.Ohlc="ohlc",r.Area="area"})(ft||(ft={}));var Lt;(function(r){r.CurrentOpen="current_open",r.PreviousClose="previous_close"})(Lt||(Lt={}));var L={RED:"#F92855",GREEN:"#2DC08E",WHITE:"#FFFFFF",GREY:"#76808F",BLUE:"#1677FF"};function Hr(){return{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:H.Dashed,dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:H.Dashed,dashedValue:[2,2]}}}function Gr(){var r={show:!0,color:L.GREY,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"};return{type:ft.CandleSolid,bar:{compareRule:Lt.CurrentOpen,upColor:L.GREEN,downColor:L.RED,noChangeColor:L.GREY,upBorderColor:L.GREEN,downBorderColor:L.RED,noChangeBorderColor:L.GREY,upWickColor:L.GREEN,downWickColor:L.RED,noChangeWickColor:L.GREY},area:{lineSize:2,lineColor:L.BLUE,smooth:!1,value:"close",backgroundColor:[{offset:0,color:Bt(L.BLUE,.01)},{offset:1,color:Bt(L.BLUE,.2)}],point:{show:!0,color:L.BLUE,radius:4,rippleColor:Bt(L.BLUE,.3),rippleRadius:8,animation:!0,animationDuration:1e3}},priceMark:{show:!0,high:R({},r),low:R({},r),last:{show:!0,compareRule:Lt.CurrentOpen,upColor:L.GREEN,downColor:L.RED,noChangeColor:L.GREY,line:{show:!0,style:H.Dashed,dashedValue:[4,4],size:1},text:{show:!0,style:X.Fill,size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:H.Solid,borderSize:0,borderDashedValue:[2,2],color:L.WHITE,family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:qt.Always,showType:St.Standard,custom:[{title:"time",value:"{time}"},{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}],defaultValue:"n/a",rect:{position:pe.Fixed,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:L.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},features:[]}}}function Ur(){var r=Bt(L.GREEN,.7),e=Bt(L.RED,.7);return{ohlc:{compareRule:Lt.CurrentOpen,upColor:r,downColor:e,noChangeColor:L.GREY},bars:[{style:X.Fill,borderStyle:H.Solid,borderSize:1,borderDashedValue:[2,2],upColor:r,downColor:e,noChangeColor:L.GREY}],lines:["#FF9600","#935EBD",L.BLUE,"#E11D74","#01C5C4"].map(function(t){return{style:H.Solid,smooth:!1,size:1,dashedValue:[2,2],color:t}}),circles:[{style:X.Fill,borderStyle:H.Solid,borderSize:1,borderDashedValue:[2,2],upColor:r,downColor:e,noChangeColor:L.GREY}],lastValueMark:{show:!1,text:{show:!1,style:X.Fill,color:L.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:H.Solid,borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:qt.Always,showType:St.Standard,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:L.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},features:[]}}}function Ye(){return{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:L.GREY,size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}}}function Zr(){function r(){return{show:!0,line:{show:!0,style:H.Dashed,dashedValue:[4,2],size:1,color:L.GREY},text:{show:!0,style:X.Fill,color:L.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:H.Solid,borderDashedValue:[2,2],borderSize:1,borderColor:L.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:L.GREY}}}return{show:!0,horizontal:r(),vertical:r()}}function qr(){var r=Bt(L.BLUE,.35),e=Bt(L.BLUE,.25);function t(){return{style:X.Fill,color:L.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:H.Solid,borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:L.BLUE,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:L.BLUE}}return{point:{color:L.BLUE,borderColor:r,borderSize:1,radius:5,activeColor:L.BLUE,activeBorderColor:r,activeBorderSize:3,activeRadius:5},line:{style:H.Solid,smooth:!1,color:L.BLUE,size:1,dashedValue:[2,2]},rect:{style:X.Fill,color:e,borderColor:L.BLUE,borderSize:1,borderRadius:0,borderStyle:H.Solid,borderDashedValue:[2,2]},polygon:{style:X.Fill,color:L.BLUE,borderColor:L.BLUE,borderSize:1,borderStyle:H.Solid,borderDashedValue:[2,2]},circle:{style:X.Fill,color:e,borderColor:L.BLUE,borderSize:1,borderStyle:H.Solid,borderDashedValue:[2,2]},arc:{style:H.Solid,color:L.BLUE,size:1,dashedValue:[2,2]},text:t()}}function jr(){return{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:Bt(L.BLUE,.08)}}function $r(){return{grid:Hr(),candle:Gr(),indicator:Ur(),xAxis:Ye(),yAxis:Ye(),separator:jr(),crosshair:Zr(),overlay:qr()}}var Qr=/\\(\\)?/g,Jr=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function Q(r,e,t){if(S(r)){var i=[];e.replace(Jr,function(s){for(var l=[],u=1;u<arguments.length;u++)l[u-1]=arguments[u];var h=s;return S(l[1])?h=l[2].replace(Qr,"$1"):S(l[0])&&(h=l[0].trim()),i.push(h),""});for(var a=r,n=0,o=i.length;S(a)&&n<o;)a=a==null?void 0:a[i[n++]];return S(a)?a:t??"--"}return t??"--"}function ur(r,e){var t={};return r.formatToParts(new Date(e)).forEach(function(i){var a=i.type,n=i.value;switch(a){case"year":{t.YYYY=n;break}case"month":{t.MM=n;break}case"day":{t.DD=n;break}case"hour":{t.HH=n==="24"?"00":n;break}case"minute":{t.mm=n;break}case"second":{t.ss=n;break}}}),t}function Kr(r,e,t){var i=ur(r,e);return t.replace(/YYYY|MM|DD|HH|mm|ss/g,function(a){return i[a]})}function it(r,e){var t=+r;return B(t)?t.toFixed(e??2):"".concat(r)}function ti(r){var e=+r;if(B(e)){if(e>1e9)return"".concat(+(e/1e9).toFixed(3),"B");if(e>1e6)return"".concat(+(e/1e6).toFixed(3),"M");if(e>1e3)return"".concat(+(e/1e3).toFixed(3),"K")}return"".concat(r)}function ei(r,e){var t="".concat(r);if(e.length===0)return t;if(t.includes(".")){var i=t.split(".");return"".concat(i[0].replace(/(\d)(?=(\d{3})+$)/g,function(a){return"".concat(a).concat(e)}),".").concat(i[1])}return t.replace(/(\d)(?=(\d{3})+$)/g,function(a){return"".concat(a).concat(e)})}function ri(r,e){var t="".concat(r),i=new RegExp("\\.0{"+e+",}[1-9][0-9]*$");if(i.test(t)){var a=t.split("."),n=a.length-1,o=a[n],s=/0*/.exec(o);if(S(s)){var l=s[0].length;return a[n]=o.replace(/0*/,"0{".concat(l,"}")),a.join(".")}}return t}var $t=null;function Ot(r){var e,t;return(t=(e=r.ownerDocument.defaultView)===null||e===void 0?void 0:e.devicePixelRatio)!==null&&t!==void 0?t:1}function zt(r,e,t){return"".concat(e??"normal"," ").concat(r??12,"px ").concat(t??"Helvetica Neue")}function me(r,e,t,i){if(!S($t)){var a=document.createElement("canvas"),n=Ot(a);$t=a.getContext("2d"),$t.scale(n,n)}return $t.font=zt(e,t,i),Math.round($t.measureText(r).width)}var _t;(function(r){r.OnZoom="onZoom",r.OnScroll="onScroll",r.OnVisibleRangeChange="onVisibleRangeChange",r.OnCandleTooltipFeatureClick="onCandleTooltipFeatureClick",r.OnCrosshairChange="onCrosshairChange",r.OnCandleBarClick="onCandleBarClick",r.OnPaneDrag="onPaneDrag"})(_t||(_t={}));var ii=function(){function r(){this._callbacks=[]}return r.prototype.subscribe=function(e){var t=this._callbacks.indexOf(e);t<0&&this._callbacks.push(e)},r.prototype.unsubscribe=function(e){if(at(e)){var t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)}else this._callbacks=[]},r.prototype.execute=function(e){this._callbacks.forEach(function(t){t(e)})},r.prototype.isEmpty=function(){return this._callbacks.length===0},r}(),ht;(function(r){r.Normal="normal",r.Price="price",r.Volume="volume"})(ht||(ht={}));var Me;(function(r){r.Feature="feature"})(Me||(Me={}));var te;(function(r){r.Loading="loading",r.Error="error",r.Ready="ready"})(te||(te={}));function Fe(r,e,t,i){var a=r.result,n=r.figures,o=r.styles,s=Q(o,"circles",t.circles),l=s.length,u=Q(o,"bars",t.bars),h=u.length,c=Q(o,"lines",t.lines),v=c.length,d=0,g=0,f=0,p,m=0;n.forEach(function(_){var x;switch(_.type){case"circle":{m=d;var b=s[d%l];p=R(R({},b),{color:b.noChangeColor}),d++;break}case"bar":{m=g;var y=u[g%h];p=R(R({},y),{color:y.noChangeColor}),g++;break}case"line":{m=f,p=c[f%v],f++;break}}if(S(_.type)){var E=(x=_.styles)===null||x===void 0?void 0:x.call(_,{data:{prev:a[e-1],current:a[e],next:a[e+1]},indicator:r,defaultStyles:t});i(_,R(R({},p),E),m)}})}var ai=function(){function r(e){this.precision=4,this.calcParams=[],this.shouldOhlc=!1,this.shouldFormatBigNumber=!1,this.visible=!0,this.zLevel=0,this.series=ht.Normal,this.figures=[],this.minValue=null,this.maxValue=null,this.styles=null,this.shouldUpdate=function(t,i){var a=JSON.stringify(t.calcParams)!==JSON.stringify(i.calcParams)||t.figures!==i.figures||t.calc!==i.calc,n=a||t.shortName!==i.shortName||t.series!==i.series||t.minValue!==i.minValue||t.maxValue!==i.maxValue||t.precision!==i.precision||t.shouldOhlc!==i.shouldOhlc||t.shouldFormatBigNumber!==i.shouldFormatBigNumber||t.visible!==i.visible||t.zLevel!==i.zLevel||t.extendData!==i.extendData||t.regenerateFigures!==i.regenerateFigures||t.createTooltipDataSource!==i.createTooltipDataSource||t.draw!==i.draw;return{calc:a,draw:n}},this.calc=function(){return[]},this.regenerateFigures=null,this.createTooltipDataSource=null,this.draw=null,this.onClick=null,this.onDataStateChange=null,this.result=[],this._lockSeriesPrecision=!1,this.override(e),this._lockSeriesPrecision=!1}return r.prototype.override=function(e){var t,i,a=this,n=a.result,o=re(a,["result"]);this._prevIndicator=R(R({},ie(o)),{result:n});var s=e.id,l=e.name,u=e.shortName,h=e.precision,c=e.styles,v=e.figures,d=e.calcParams,g=re(e,["id","name","shortName","precision","styles","figures","calcParams"]);!Y(this.id)&&Y(s)&&(this.id=s),Y(this.name)||(this.name=l??""),this.shortName=(t=u??this.shortName)!==null&&t!==void 0?t:this.name,B(h)&&(this.precision=h,this._lockSeriesPrecision=!0),S(c)&&((i=this.styles)!==null&&i!==void 0||(this.styles={}),q(this.styles,c)),q(this,g),S(d)&&(this.calcParams=d,at(this.regenerateFigures)&&(this.figures=this.regenerateFigures(this.calcParams))),this.figures=v??this.figures},r.prototype.setSeriesPrecision=function(e){this._lockSeriesPrecision||(this.precision=e)},r.prototype.shouldUpdateImp=function(){var e=this._prevIndicator.zLevel!==this.zLevel,t=this.shouldUpdate(this._prevIndicator,this);return Ce(t)?{calc:t,draw:t,sort:e}:R(R({},t),{sort:e})},r.prototype.calcImp=function(e){return sr(this,void 0,void 0,function(){var t;return lr(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.calc(e,this)];case 1:return t=i.sent(),this.result=t,[2,!0];case 2:return i.sent(),[2,!1];case 3:return[2]}})})},r.extend=function(e){var t=function(i){V(a,i);function a(){return i.call(this,e)||this}return a}(r);return t},r}(),Gt;(function(r){r.Normal="normal",r.WeakMagnet="weak_magnet",r.StrongMagnet="strong_magnet"})(Gt||(Gt={}));function dt(r,e){var t,i=(t=e==null?void 0:e.ignoreEvent)!==null&&t!==void 0?t:!1;return Ce(i)?!i:!i.includes(r)}var He=1,Qt=-1,ni="overlay_",Yt="overlay_figure_",oi=function(){function r(e){this.groupId="",this.totalStep=1,this.currentStep=He,this.lock=!1,this.visible=!0,this.zLevel=0,this.needDefaultPointFigure=!1,this.needDefaultXAxisFigure=!1,this.needDefaultYAxisFigure=!1,this.mode=Gt.Normal,this.modeSensitivity=8,this.points=[],this.styles=null,this.createPointFigures=null,this.createXAxisFigures=null,this.createYAxisFigures=null,this.performEventPressedMove=null,this.performEventMoveForDrawing=null,this.onDrawStart=null,this.onDrawing=null,this.onDrawEnd=null,this.onClick=null,this.onDoubleClick=null,this.onRightClick=null,this.onPressedMoveStart=null,this.onPressedMoving=null,this.onPressedMoveEnd=null,this.onMouseEnter=null,this.onMouseLeave=null,this.onRemoved=null,this.onSelected=null,this.onDeselected=null,this._prevZLevel=0,this._prevPressedPoint=null,this._prevPressedPoints=[],this.override(e)}return r.prototype.override=function(e){var t,i;this._prevOverlay=ie(this);var a=e.id,n=e.name;e.currentStep;var o=e.points,s=e.styles,l=re(e,["id","name","currentStep","points","styles"]);if(q(this,l),Y(this.name)||(this.name=n??""),!Y(this.id)&&Y(a)&&(this.id=a),S(s)&&((t=this.styles)!==null&&t!==void 0||(this.styles={}),q(this.styles,s)),At(o)&&o.length>0){var u=0;if(this.points=ae([],It(o),!1),o.length>=this.totalStep-1?(this.currentStep=Qt,u=this.totalStep-1):(this.currentStep=o.length+1,u=o.length),at(this.performEventMoveForDrawing))for(var h=0;h<u;h++)this.performEventMoveForDrawing({currentStep:h+2,mode:this.mode,points:this.points,performPointIndex:h,performPoint:this.points[h]});this.currentStep===Qt&&((i=this.performEventPressedMove)===null||i===void 0||i.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}))}},r.prototype.getPrevZLevel=function(){return this._prevZLevel},r.prototype.setPrevZLevel=function(e){this._prevZLevel=e},r.prototype.shouldUpdate=function(){var e=this._prevOverlay.zLevel!==this.zLevel,t=e||JSON.stringify(this._prevOverlay)!==JSON.stringify(this.points)||this._prevOverlay.visible!==this.visible||this._prevOverlay.extendData!==this.extendData||this._prevOverlay.styles!==this.styles;return{sort:e,draw:t}},r.prototype.nextStep=function(){this.currentStep===this.totalStep-1?this.currentStep=Qt:this.currentStep++},r.prototype.forceComplete=function(){this.currentStep=Qt},r.prototype.isDrawing=function(){return this.currentStep!==Qt},r.prototype.isStart=function(){return this.currentStep===He},r.prototype.eventMoveForDrawing=function(e){var t,i=this.currentStep-1,a={};B(e.timestamp)&&(a.timestamp=e.timestamp),B(e.dataIndex)&&(a.dataIndex=e.dataIndex),B(e.value)&&(a.value=e.value),this.points[i]=a,(t=this.performEventMoveForDrawing)===null||t===void 0||t.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:i,performPoint:a})},r.prototype.eventPressedPointMove=function(e,t){var i;this.points[t].timestamp=e.timestamp,B(e.value)&&(this.points[t].value=e.value),(i=this.performEventPressedMove)===null||i===void 0||i.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:t,performPoint:this.points[t]})},r.prototype.startPressedMove=function(e){this._prevPressedPoint=R({},e),this._prevPressedPoints=ie(this.points)},r.prototype.eventPressedOtherMove=function(e,t){if(this._prevPressedPoint!==null){var i=null;B(e.dataIndex)&&B(this._prevPressedPoint.dataIndex)&&(i=e.dataIndex-this._prevPressedPoint.dataIndex);var a=null;B(e.value)&&B(this._prevPressedPoint.value)&&(a=e.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(function(n){var o;B(n.timestamp)&&(n.dataIndex=t.timestampToDataIndex(n.timestamp));var s=R({},n);return B(i)&&B(n.dataIndex)&&(s.dataIndex=n.dataIndex+i,s.timestamp=(o=t.dataIndexToTimestamp(s.dataIndex))!==null&&o!==void 0?o:void 0),B(a)&&B(n.value)&&(s.value=n.value+a),s})}},r.extend=function(e){var t=function(i){V(a,i);function a(){return i.call(this,e)||this}return a}(r);return t},r}(),yt;(function(r){r[r.Tooltip=0]="Tooltip",r[r.Crosshair=1]="Crosshair",r[r.XAxis=2]="XAxis"})(yt||(yt={}));function ye(r){var e={width:0,height:0,left:0,right:0,top:0,bottom:0};return S(r)&&q(e,r),e}var Ut=-1;function _e(r){return at(window.requestAnimationFrame)?window.requestAnimationFrame(r):window.setTimeout(r,20)}function Ge(r){at(window.cancelAnimationFrame)?window.cancelAnimationFrame(r):window.clearTimeout(r)}function Ue(r){if(at(window.requestIdleCallback))return window.requestIdleCallback(r);var e=performance.now();return window.setTimeout(function(){r({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(performance.now()-e))}})},1)}function si(r){at(window.cancelIdleCallback)?window.cancelIdleCallback(r):window.clearTimeout(r)}var Ae=function(){function r(e){this._options={duration:500,iterationCount:1},this._currentIterationCount=0,this._running=!1,this._time=0,q(this._options,e)}return r.prototype._loop=function(){var e=this;this._running=!0;var t=function(){var i;if(e._running){var a=new Date().getTime()-e._time;a<e._options.duration?((i=e._doFrameCallback)===null||i===void 0||i.call(e,a),_e(t)):(e.stop(),e._currentIterationCount++,e._currentIterationCount<e._options.iterationCount&&e.start())}};_e(t)},r.prototype.doFrame=function(e){return this._doFrameCallback=e,this},r.prototype.setDuration=function(e){return this._options.duration=e,this},r.prototype.setIterationCount=function(e){return this._options.iterationCount=e,this},r.prototype.start=function(){this._running||(this._time=new Date().getTime(),this._loop())},r.prototype.stop=function(){var e;this._running&&((e=this._doFrameCallback)===null||e===void 0||e.call(this,this._options.duration)),this._running=!1},r}(),Ee=1,Ze=new Date().getTime();function ve(r){var e=new Date().getTime();return e===Ze?++Ee:Ee=1,Ze=e,"".concat(r??"").concat(e,"_").concat(Ee)}function Dt(r,e){var t,i=document.createElement(r),a=e??{};for(var n in a)i.style[n]=(t=a[n])!==null&&t!==void 0?t:"";return i}function ke(r,e,t){var i=0,a=0;for(a=r.length-1;i!==a;){var n=Math.floor((a+i)/2),o=a-i,s=r[n][e];if(t===r[i][e])return i;if(t===r[a][e])return a;if(t===s)return n;if(t>s?i=n:a=n,o<=2)break}return i}function li(r){var e=Math.floor(Mt(r)),t=Wt(e),i=r/t,a=0;return i<1.5?a=1:i<2.5?a=2:i<3.5?a=3:i<4.5?a=4:i<5.5?a=5:i<6.5?a=6:a=8,r=a*t,+r.toFixed(Math.abs(e))}function qe(r,e){e=Math.max(0,e??0);var t=Math.pow(10,e);return Math.round(r*t)/t}function ui(r){var e=r.toString(),t=e.indexOf("e");if(t>0){var i=+e.slice(t+1);return i<0?-i:0}var a=e.indexOf(".");return a<0?0:e.length-1-a}function hr(r,e,t){for(var i,a,n=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],o=r.length,s=0;s<o;){var l=r[s];n[0]=Math.max((i=l[e])!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER,n[0]),n[1]=Math.min((a=l[t])!==null&&a!==void 0?a:Number.MAX_SAFE_INTEGER,n[1]),++s}return n}function Mt(r){return r===0?0:Math.log10(r)}function Wt(r){return Math.pow(10,r)}var st;(function(r){r.Init="init",r.Forward="forward",r.Backward="backward",r.Update="update"})(st||(st={}));function je(){return{from:0,to:0,realFrom:0,realTo:0}}function $e(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.join("_")}var hi=function(){function r(e){this._requestIdleCallbackId=Ut,this._tasks=e??[],this._operateTasks()}return r.prototype._operateTasks=function(e){var t=this;this._requestIdleCallbackId!==Ut&&(si(this._requestIdleCallbackId),this._requestIdleCallbackId=Ut),e==null||e(),this._requestIdleCallbackId=Ue(function(i){t._runTasks(i)})},r.prototype._runTasks=function(e){for(var t=this;e.timeRemaining()>0&&this._tasks.length>0;){var i=this._tasks.shift();i==null||i.handler()}this._tasks.length>0&&(this._requestIdleCallbackId=Ue(function(a){t._runTasks(a)}))},r.prototype.addTask=function(e){var t=this;return this._operateTasks(function(){var i=t._tasks.findIndex(function(a){return a.id===e.id});i>-1?t._tasks[i]=e:t._tasks.push(e)}),this},r.prototype.removeTask=function(e){var t=this;return this._operateTasks(function(){var i=t._tasks.findIndex(function(a){return a.id===e});i>-1&&t._tasks.splice(i,1)}),this},r}(),lt={Year:365*24*3600,Month:30*24*3600,Day:24*3600,Hour:3600,Minute:60,Second:1};function cr(r,e,t,i,a,n){var o;i===void 0&&(i=0);for(var s=null,l=n??null,u=0;u<e.length;u++){var h=e[u].timestamp,c=lt.Minute,v=ur(t,h);S(s)&&(v.YYYY!==s.YYYY?c=lt.Year:v.MM!==s.MM?c=lt.Month:v.DD!==s.DD?c=lt.Day:v.HH!==s.HH?c=lt.Hour:v.mm!==s.mm?c=lt.Minute:c=lt.Second),B(l)&&B(a==null?void 0:a.compare)&&(a.compare=Math.min(a.compare,h-l));var d=(o=r.get(c))!==null&&o!==void 0?o:[];d.push({dataIndex:u+i,weight:c,timestamp:h}),r.set(c,d),s=v,l=h}}function vr(r,e){var t=Math.max(me("0000-00-00 00:00:00",e.size,e.weight,e.family),146);return Math.ceil(t/r)}function De(r,e,t){var i=vr(e,t),a=[];return Array.from(r.keys()).sort(function(n,o){return o-n}).forEach(function(n){var o=r.get(n),s=a;a=[];for(var l=s.length,u=0,h=o.length,c=1/0,v=-1/0,d=0;d<h;d++){for(var g=o[d],f=g.dataIndex;u<l;){var p=s[u],m=p.dataIndex;if(m<f)u++,a.push(p),v=m,c=1/0;else{c=m;break}}c-f>=i&&f-v>=i&&(a.push(g),v=f)}for(;u<l;u++)a.push(s[u])}),a}var ci={name:"AVP",shortName:"AVP",series:ht.Price,precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:function(r){var e=0,t=0;return r.map(function(i){var a,n,o={},s=(a=i.turnover)!==null&&a!==void 0?a:0,l=(n=i.volume)!==null&&n!==void 0?n:0;return e+=s,t+=l,t!==0&&(o.avp=e/t),o})}},vi={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:function(r){var e,t,i=r.data,a=r.indicator,n=r.defaultStyles,o=i.prev,s=i.current,l=(e=o==null?void 0:o.ao)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER,u=(t=s==null?void 0:s.ao)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER,h="";u>l?h=Q(a.styles,"bars[0].upColor",n.bars[0].upColor):h=Q(a.styles,"bars[0].downColor",n.bars[0].downColor);var c=u>l?X.Stroke:X.Fill;return{color:h,style:c,borderColor:h}}}],calc:function(r,e){var t=e.calcParams,i=Math.max(t[0],t[1]),a=0,n=0,o=0,s=0;return r.map(function(l,u){var h={},c=(l.low+l.high)/2;if(a+=c,n+=c,u>=t[0]-1){o=a/t[0];var v=r[u-(t[0]-1)];a-=(v.low+v.high)/2}if(u>=t[1]-1){s=n/t[1];var v=r[u-(t[1]-1)];n-=(v.low+v.high)/2}return u>=i-1&&(h.ao=o-s),h})}},di={name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:function(r){return r.map(function(e,t){return{key:"bias".concat(t+1),title:"BIAS".concat(e,": "),type:"line"}})},calc:function(r,e){var t=e.calcParams,i=e.figures,a=[];return r.map(function(n,o){var s={},l=n.close;return t.forEach(function(u,h){var c;if(a[h]=((c=a[h])!==null&&c!==void 0?c:0)+l,o>=u-1){var v=a[h]/t[h];s[i[h].key]=(l-v)/v*100,a[h]-=r[o-(u-1)].close}}),s})}};function fi(r,e){var t=r.length,i=0;return r.forEach(function(a){var n=a.close-e;i+=n*n}),i=Math.abs(i),Math.sqrt(i/t)}var gi={name:"BOLL",shortName:"BOLL",series:ht.Price,calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=t[0]-1,a=0;return r.map(function(n,o){var s=n.close,l={};if(a+=s,o>=i){l.mid=a/t[0];var u=fi(r.slice(o-i,o+1),l.mid);l.up=l.mid+t[1]*u,l.dn=l.mid-t[1]*u,a-=r[o-i].close}return l})}},pi={name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=0,a=0,n=0,o=0;return r.map(function(s,l){var u,h,c={},v=s.high,d=s.low,g=s.open,f=((u=r[l-1])!==null&&u!==void 0?u:s).close;if(n+=v-g,o+=g-d,i+=v-f,a+=f-d,l>=t[0]-1){o!==0?c.ar=n/o*100:c.ar=0,a!==0?c.br=i/a*100:c.br=0;var p=r[l-(t[0]-1)],m=p.high,_=p.low,x=p.open,b=((h=r[l-t[0]])!==null&&h!==void 0?h:r[l-(t[0]-1)]).close;i-=m-b,a-=b-_,n-=m-x,o-=x-_}return c})}},mi={name:"BBI",shortName:"BBI",series:ht.Price,precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=Math.max.apply(Math,ae([],It(t),!1)),a=[],n=[];return r.map(function(o,s){var l={},u=o.close;if(t.forEach(function(c,v){var d;a[v]=((d=a[v])!==null&&d!==void 0?d:0)+u,s>=c-1&&(n[v]=a[v]/c,a[v]-=r[s-(c-1)].close)}),s>=i-1){var h=0;n.forEach(function(c){h+=c}),l.bbi=h/4}return l})}},yi={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=t[0]-1,a=0,n=[];return r.map(function(o,s){var l={},u=(o.high+o.low+o.close)/3;if(a+=u,n.push(u),s>=i){var h=a/t[0],c=n.slice(s-i,s+1),v=0;c.forEach(function(f){v+=Math.abs(f-h)});var d=v/t[0];l.cci=d!==0?(u-h)/d/.015:0;var g=(r[s-i].high+r[s-i].low+r[s-i].close)/3;a-=g}return l})}},_i={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=Math.ceil(t[1]/2.5+1),a=Math.ceil(t[2]/2.5+1),n=Math.ceil(t[3]/2.5+1),o=Math.ceil(t[4]/2.5+1),s=0,l=[],u=0,h=[],c=0,v=[],d=0,g=[],f=[];return r.forEach(function(p,m){var _,x,b,y,E,C={},w=(_=r[m-1])!==null&&_!==void 0?_:p,I=(w.high+w.close+w.low+w.open)/4,T=Math.max(0,p.high-I),M=Math.max(0,I-p.low);m>=t[0]-1&&(M!==0?C.cr=T/M*100:C.cr=0,s+=C.cr,u+=C.cr,c+=C.cr,d+=C.cr,m>=t[0]+t[1]-2&&(l.push(s/t[1]),m>=t[0]+t[1]+i-3&&(C.ma1=l[l.length-1-i]),s-=(x=f[m-(t[1]-1)].cr)!==null&&x!==void 0?x:0),m>=t[0]+t[2]-2&&(h.push(u/t[2]),m>=t[0]+t[2]+a-3&&(C.ma2=h[h.length-1-a]),u-=(b=f[m-(t[2]-1)].cr)!==null&&b!==void 0?b:0),m>=t[0]+t[3]-2&&(v.push(c/t[3]),m>=t[0]+t[3]+n-3&&(C.ma3=v[v.length-1-n]),c-=(y=f[m-(t[3]-1)].cr)!==null&&y!==void 0?y:0),m>=t[0]+t[4]-2&&(g.push(d/t[4]),m>=t[0]+t[4]+o-3&&(C.ma4=g[g.length-1-o]),d-=(E=f[m-(t[4]-1)].cr)!==null&&E!==void 0?E:0)),f.push(C)}),f}},xi={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=Math.max(t[0],t[1]),a=0,n=0,o=0,s=[];return r.forEach(function(l,u){var h,c={},v=l.close;a+=v,n+=v;var d=0,g=0;if(u>=t[0]-1&&(d=a/t[0],a-=r[u-(t[0]-1)].close),u>=t[1]-1&&(g=n/t[1],n-=r[u-(t[1]-1)].close),u>=i-1){var f=d-g;c.dma=f,o+=f,u>=i+t[2]-2&&(c.ama=o/t[2],o-=(h=s[u-(t[2]-1)].dma)!==null&&h!==void 0?h:0)}s.push(c)}),s}},bi={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=0,a=0,n=0,o=0,s=0,l=0,u=0,h=0,c=[];return r.forEach(function(v,d){var g,f,p={},m=(g=r[d-1])!==null&&g!==void 0?g:v,_=m.close,x=v.high,b=v.low,y=x-b,E=Math.abs(x-_),C=Math.abs(_-b),w=x-m.high,I=m.low-b,T=Math.max(Math.max(y,E),C),M=w>0&&w>I?w:0,F=I>0&&I>w?I:0;if(i+=T,a+=M,n+=F,d>=t[0]-1){d>t[0]-1?(o=o-o/t[0]+T,s=s-s/t[0]+M,l=l-l/t[0]+F):(o=i,s=a,l=n);var A=0,D=0;o!==0&&(A=s*100/o,D=l*100/o),p.pdi=A,p.mdi=D;var P=0;D+A!==0&&(P=Math.abs(D-A)/(D+A)*100),u+=P,d>=t[0]*2-2&&(d>t[0]*2-2?h=(h*(t[0]-1)+P)/t[0]:h=u/t[0],p.adx=h,d>=t[0]*2+t[1]-3&&(p.adxr=(((f=c[d-(t[1]-1)].adx)!==null&&f!==void 0?f:0)+h)/2))}c.push(p)}),c}},Ci={name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=0,a=[];return r.map(function(n,o){var s,l={};if(o>0){var u=r[o-1],h=n.high,c=n.low,v=(s=n.volume)!==null&&s!==void 0?s:0,d=(h+c)/2-(u.high+u.low)/2;if(v===0||h-c===0)l.emv=0;else{var g=v/1e8/(h-c);l.emv=d/g}i+=l.emv,a.push(l.emv),o>=t[0]&&(l.maEmv=i/t[0],i-=a[o-t[0]])}return l})}},wi={name:"EMA",shortName:"EMA",series:ht.Price,calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:function(r){return r.map(function(e,t){return{key:"ema".concat(t+1),title:"EMA".concat(e,": "),type:"line"}})},calc:function(r,e){var t=e.calcParams,i=e.figures,a=0,n=[];return r.map(function(o,s){var l={},u=o.close;return a+=u,t.forEach(function(h,c){s>=h-1&&(s>h-1?n[c]=(2*u+(h-1)*n[c])/(h+1):n[c]=a/h,l[i[c].key]=n[c])}),l})}},Si={name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=0,a=[];return r.forEach(function(n,o){var s,l={};if(o>=t[0]){var u=n.close,h=r[o-t[0]].close;l.mtm=u-h,i+=l.mtm,o>=t[0]+t[1]-1&&(l.maMtm=i/t[1],i-=(s=a[o-(t[1]-1)].mtm)!==null&&s!==void 0?s:0)}a.push(l)}),a}},Ei={name:"MA",shortName:"MA",series:ht.Price,calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA30: ",type:"line"},{key:"ma4",title:"MA60: ",type:"line"}],regenerateFigures:function(r){return r.map(function(e,t){return{key:"ma".concat(t+1),title:"MA".concat(e,": "),type:"line"}})},calc:function(r,e){var t=e.calcParams,i=e.figures,a=[];return r.map(function(n,o){var s={},l=n.close;return t.forEach(function(u,h){var c;a[h]=((c=a[h])!==null&&c!==void 0?c:0)+l,o>=u-1&&(s[i[h].key]=a[h]/u,a[h]-=r[o-(u-1)].close)}),s})}},Ii={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:function(r){var e,t,i=r.data,a=r.indicator,n=r.defaultStyles,o=i.prev,s=i.current,l=(e=o==null?void 0:o.macd)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER,u=(t=s==null?void 0:s.macd)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER,h="";u>0?h=Q(a.styles,"bars[0].upColor",n.bars[0].upColor):u<0?h=Q(a.styles,"bars[0].downColor",n.bars[0].downColor):h=Q(a.styles,"bars[0].noChangeColor",n.bars[0].noChangeColor);var c=l<u?X.Stroke:X.Fill;return{style:c,color:h,borderColor:h}}}],calc:function(r,e){var t=e.calcParams,i=0,a=0,n=0,o=0,s=0,l=0,u=Math.max(t[0],t[1]);return r.map(function(h,c){var v={},d=h.close;return i+=d,c>=t[0]-1&&(c>t[0]-1?a=(2*d+(t[0]-1)*a)/(t[0]+1):a=i/t[0]),c>=t[1]-1&&(c>t[1]-1?n=(2*d+(t[1]-1)*n)/(t[1]+1):n=i/t[1]),c>=u-1&&(o=a-n,v.dif=o,s+=o,c>=u+t[2]-2&&(c>u+t[2]-2?l=(o*2+l*(t[2]-1))/(t[2]+1):l=s/t[2],v.macd=(o-l)*2,v.dea=l)),v})}},Ti={name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=0,a=0,n=[];return r.forEach(function(o,s){var l,u,h,c,v=(l=r[s-1])!==null&&l!==void 0?l:o;o.close<v.close?a-=(u=o.volume)!==null&&u!==void 0?u:0:o.close>v.close&&(a+=(h=o.volume)!==null&&h!==void 0?h:0);var d={obv:a};i+=a,s>=t[0]-1&&(d.maObv=i/t[0],i-=(c=n[s-(t[0]-1)].obv)!==null&&c!==void 0?c:0),n.push(d)}),n}},Pi={name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:function(r){var e=0;return r.map(function(t,i){var a,n,o={},s=t.close,l=(a=t.volume)!==null&&a!==void 0?a:1,u=((n=r[i-1])!==null&&n!==void 0?n:t).close,h=0,c=u*l;return c!==0&&(h=(s-u)/c),e+=h,o.pvt=e,o})}},Mi={name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=0,a=0,n=[],o=[];return r.forEach(function(s,l){var u,h,c={},v=((u=r[l-1])!==null&&u!==void 0?u:s).close,d=s.close-v>0?1:0;n.push(d),i+=d,l>=t[0]-1&&(c.psy=i/t[0]*100,a+=c.psy,l>=t[0]+t[1]-2&&(c.maPsy=a/t[1],a-=(h=o[l-(t[1]-1)].psy)!==null&&h!==void 0?h:0),i-=n[l-(t[0]-1)]),o.push(c)}),o}},Ai={name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=[],a=0;return r.forEach(function(n,o){var s,l,u={};if(o>=t[0]-1){var h=n.close,c=((s=r[o-t[0]])!==null&&s!==void 0?s:r[o-(t[0]-1)]).close;c!==0?u.roc=(h-c)/c*100:u.roc=0,a+=u.roc,o>=t[0]-1+t[1]-1&&(u.maRoc=a/t[1],a-=(l=i[o-(t[1]-1)].roc)!==null&&l!==void 0?l:0)}i.push(u)}),i}},ki={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:function(r){return r.map(function(e,t){var i=t+1;return{key:"rsi".concat(i),title:"RSI".concat(i,": "),type:"line"}})},calc:function(r,e){var t=e.calcParams,i=e.figures,a=[],n=[];return r.map(function(o,s){var l,u={},h=((l=r[s-1])!==null&&l!==void 0?l:o).close,c=o.close-h;return t.forEach(function(v,d){var g,f,p;if(c>0?a[d]=((g=a[d])!==null&&g!==void 0?g:0)+c:n[d]=((f=n[d])!==null&&f!==void 0?f:0)+Math.abs(c),s>=v-1){n[d]!==0?u[i[d].key]=100-100/(1+a[d]/n[d]):u[i[d].key]=0;var m=r[s-(v-1)],_=(p=r[s-v])!==null&&p!==void 0?p:m,x=m.close-_.close;x>0?a[d]-=x:n[d]-=Math.abs(x)}}),u})}},Di={name:"SMA",shortName:"SMA",series:ht.Price,calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:function(r,e){var t=e.calcParams,i=0,a=0;return r.map(function(n,o){var s={},l=n.close;return i+=l,o>=t[0]-1&&(o>t[0]-1?a=(l*t[1]+a*(t[0]-t[1]+1))/(t[0]+1):a=i/t[0],s.sma=a),s})}},Ri={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=[];return r.forEach(function(a,n){var o,s,l,u,h={},c=a.close;if(n>=t[0]-1){var v=hr(r.slice(n-(t[0]-1),n+1),"high","low"),d=v[0],g=v[1],f=d-g,p=(c-g)/(f===0?1:f)*100;h.k=((t[1]-1)*((s=(o=i[n-1])===null||o===void 0?void 0:o.k)!==null&&s!==void 0?s:50)+p)/t[1],h.d=((t[2]-1)*((u=(l=i[n-1])===null||l===void 0?void 0:l.d)!==null&&u!==void 0?u:50)+h.k)/t[2],h.j=3*h.k-2*h.d}i.push(h)}),i}},Fi={name:"SAR",shortName:"SAR",series:ht.Price,calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:function(r){var e,t,i,a=r.data,n=r.indicator,o=r.defaultStyles,s=a.current,l=(e=s==null?void 0:s.sar)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER,u=(((t=s==null?void 0:s.high)!==null&&t!==void 0?t:0)+((i=s==null?void 0:s.low)!==null&&i!==void 0?i:0))/2,h=l<u?Q(n.styles,"circles[0].upColor",o.circles[0].upColor):Q(n.styles,"circles[0].downColor",o.circles[0].downColor);return{color:h}}}],calc:function(r,e){var t=e.calcParams,i=t[0]/100,a=t[1]/100,n=t[2]/100,o=i,s=-100,l=!1,u=0;return r.map(function(h,c){var v=u,d=h.high,g=h.low;if(l){(s===-100||s<d)&&(s=d,o=Math.min(o+a,n)),u=v+o*(s-v);var f=Math.min(r[Math.max(1,c)-1].low,g);u>h.low?(u=s,o=i,s=-100,l=!l):u>f&&(u=f)}else{(s===-100||s>g)&&(s=g,o=Math.min(o+a,n)),u=v+o*(s-v);var p=Math.max(r[Math.max(1,c)-1].high,d);u<h.high?(u=s,o=0,s=-100,l=!l):u<p&&(u=p)}return{high:d,low:g,sar:u}})}},Bi={name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=0,a=0,n=0,o=0,s=0,l=0,u=0,h=[];return r.forEach(function(c,v){var d,g={},f=c.close;if(i+=f,v>=t[0]-1&&(v>t[0]-1?a=(2*f+(t[0]-1)*a)/(t[0]+1):a=i/t[0],s+=a,v>=t[0]*2-2&&(v>t[0]*2-2?n=(2*a+(t[0]-1)*n)/(t[0]+1):n=s/t[0],l+=n,v>=t[0]*3-3))){var p=0,m=0;v>t[0]*3-3?(p=(2*n+(t[0]-1)*o)/(t[0]+1),m=(p-o)/o*100):p=l/t[0],o=p,g.trix=m,u+=m,v>=t[0]*3+t[1]-4&&(g.maTrix=u/t[1],u-=(d=h[v-(t[1]-1)].trix)!==null&&d!==void 0?d:0)}h.push(g)}),h}};function Qe(){return{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:function(r){var e=r.data,t=r.indicator,i=r.defaultStyles,a=e.current,n=Q(t.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor);return S(a)&&(a.close>a.open?n=Q(t.styles,"bars[0].upColor",i.bars[0].upColor):a.close<a.open&&(n=Q(t.styles,"bars[0].downColor",i.bars[0].downColor))),{color:n}}}}var Oi={name:"VOL",shortName:"VOL",series:ht.Volume,calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},Qe()],regenerateFigures:function(r){var e=r.map(function(t,i){return{key:"ma".concat(i+1),title:"MA".concat(t,": "),type:"line"}});return e.push(Qe()),e},calc:function(r,e){var t=e.calcParams,i=e.figures,a=[];return r.map(function(n,o){var s,l=(s=n.volume)!==null&&s!==void 0?s:0,u={volume:l,open:n.open,close:n.close};return t.forEach(function(h,c){var v,d;a[c]=((v=a[c])!==null&&v!==void 0?v:0)+l,o>=h-1&&(u[i[c].key]=a[c]/h,a[c]-=(d=r[o-(h-1)].volume)!==null&&d!==void 0?d:0)}),u})}},Li={name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:function(r,e){var t=e.calcParams,i=0,a=0,n=0,o=0,s=[];return r.forEach(function(l,u){var h,c,v,d,g,f={},p=l.close,m=((h=r[u-1])!==null&&h!==void 0?h:l).close,_=(c=l.volume)!==null&&c!==void 0?c:0;if(p>m?i+=_:p<m?a+=_:n+=_,u>=t[0]-1){var x=n/2;a+x===0?f.vr=0:f.vr=(i+x)/(a+x)*100,o+=f.vr,u>=t[0]+t[1]-2&&(f.maVr=o/t[1],o-=(v=s[u-(t[1]-1)].vr)!==null&&v!==void 0?v:0);var b=r[u-(t[0]-1)],y=(d=r[u-t[0]])!==null&&d!==void 0?d:b,E=b.close,C=(g=b.volume)!==null&&g!==void 0?g:0;E>y.close?i-=C:E<y.close?a-=C:n-=C}s.push(f)}),s}},Vi={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:function(r){return r.map(function(e,t){return{key:"wr".concat(t+1),title:"WR".concat(t+1,": "),type:"line"}})},calc:function(r,e){var t=e.calcParams,i=e.figures;return r.map(function(a,n){var o={},s=a.close;return t.forEach(function(l,u){var h=l-1;if(n>=h){var c=hr(r.slice(n-h,n+1),"high","low"),v=c[0],d=c[1],g=v-d;o[i[u].key]=g===0?0:(s-v)/g*100}}),o})}},dr={},Ni=[ci,vi,di,gi,pi,mi,yi,_i,xi,bi,Ci,wi,Si,Ei,Ii,Ti,Pi,Mi,Ai,ki,Di,Ri,Fi,Bi,Oi,Li,Vi];Ni.forEach(function(r){dr[r.name]=ai.extend(r)});function fr(r){var e;return(e=dr[r])!==null&&e!==void 0?e:null}var Wi={name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e,t=r.chart,i=r.coordinates,a=r.bounding,n=r.overlay,o=r.yAxis,s=n.points;if(i.length>0){var l=0;if(!((e=o==null?void 0:o.isInCandle())!==null&&e!==void 0)||e)l=t.getPrecision().price;else{var u=t.getIndicators({paneId:n.paneId});u.forEach(function(m){l=Math.max(l,m.precision)})}var h=[],c=[],v=0,d=a.width;if(i.length>1&&B(s[0].value)&&B(s[1].value)){var g=[1,.786,.618,.5,.382,.236,0],f=i[0].y-i[1].y,p=s[0].value-s[1].value;g.forEach(function(m){var _,x=i[1].y+f*m,b=t.getDecimalFold().format(t.getThousandsSeparator().format((((_=s[1].value)!==null&&_!==void 0?_:0)+p*m).toFixed(l)));h.push({coordinates:[{x:v,y:x},{x:d,y:x}]}),c.push({x:v,y:x,text:"".concat(b," (").concat((m*100).toFixed(1),"%)"),baseline:"bottom"})})}return[{type:"line",attrs:h},{type:"text",isCheckEvent:!1,attrs:c}]}return[]}},zi={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=r.bounding,i={x:0,y:e[0].y};return S(e[1])&&e[0].x<e[1].x&&(i.x=t.width),[{type:"line",attrs:{coordinates:[e[0],i]}}]},performEventPressedMove:function(r){var e=r.points,t=r.performPoint;e[0].value=t.value,e[1].value=t.value},performEventMoveForDrawing:function(r){var e=r.currentStep,t=r.points,i=r.performPoint;e===2&&(t[0].value=i.value)}},Xi={name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=[];return e.length===2&&t.push({coordinates:e}),[{type:"line",attrs:t}]},performEventPressedMove:function(r){var e=r.points,t=r.performPoint;e[0].value=t.value,e[1].value=t.value},performEventMoveForDrawing:function(r){var e=r.currentStep,t=r.points,i=r.performPoint;e===2&&(t[0].value=i.value)}},Yi={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=r.bounding;return[{type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:t.width,y:e[0].y}]}}]}},Be=function(){function r(){this._children=[],this._callbacks=new Map}return r.prototype.registerEvent=function(e,t){return this._callbacks.set(e,t),this},r.prototype.onEvent=function(e,t,i){var a=this._callbacks.get(e);return S(a)&&this.checkEventOn(t)?a(t,i):!1},r.prototype.checkEventOn=function(e){var t,i;try{for(var a=ut(this._children),n=a.next();!n.done;n=a.next()){var o=n.value;if(o.checkEventOn(e))return!0}}catch(s){t={error:s}}finally{try{n&&!n.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return!1},r.prototype.dispatchEvent=function(e,t,i){var a=this._children.length-1;if(a>-1){for(var n=a;n>-1;n--)if(this._children[n].dispatchEvent(e,t,i))return!0}return this.onEvent(e,t,i)},r.prototype.addChild=function(e){return this._children.push(e),this},r.prototype.clear=function(){this._children=[]},r}(),$=2,Hi=function(r){V(e,r);function e(t){var i=r.call(this)||this;return i.attrs=t.attrs,i.styles=t.styles,i}return e.prototype.checkEventOn=function(t){return this.checkEventOnImp(t,this.attrs,this.styles)},e.prototype.setAttrs=function(t){return this.attrs=t,this},e.prototype.setStyles=function(t){return this.styles=t,this},e.prototype.draw=function(t){this.drawImp(t,this.attrs,this.styles)},e.extend=function(t){var i=function(a){V(n,a);function n(){return a!==null&&a.apply(this,arguments)||this}return n.prototype.checkEventOnImp=function(o,s,l){return t.checkEventOn(o,s,l)},n.prototype.drawImp=function(o,s,l){t.draw(o,s,l)},n}(e);return i},e}(Be);function Gi(r,e){var t,i,a=[];a=a.concat(e);try{for(var n=ut(a),o=n.next();!o.done;o=n.next()){var s=o.value,l=s.coordinates;if(l.length>1)for(var u=1;u<l.length;u++){var h=l[u-1],c=l[u];if(h.x===c.x){if(Math.abs(h.y-r.y)+Math.abs(c.y-r.y)-Math.abs(h.y-c.y)<$+$&&Math.abs(r.x-h.x)<$)return!0}else{var v=Oe(h,c),d=gr(v,r),g=Math.abs(d-r.y);if(Math.abs(h.x-r.x)+Math.abs(c.x-r.x)-Math.abs(h.x-c.x)<$+$&&g*g/(v[0]*v[0]+1)<$*$)return!0}}}}catch(f){t={error:f}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return!1}function gr(r,e){return r!==null?e.x*r[0]+r[1]:e.y}function xe(r,e,t){var i=Oe(r,e);return gr(i,t)}function Oe(r,e){var t=r.x-e.x;if(t!==0){var i=(r.y-e.y)/t,a=r.y-i*r.x;return[i,a]}return null}function pr(r,e,t){var i=e.length,a=B(t)?t>0&&t<1?t:0:t?.5:0;if(a>0&&i>2){for(var n=e[0].x,o=e[0].y,s=1;s<i-1;s++){var l=e[s-1],u=e[s],h=e[s+1],c=u.x-l.x,v=u.y-l.y,d=h.x-u.x,g=h.y-u.y,f=h.x-l.x,p=h.y-l.y,m=Math.sqrt(c*c+v*v),_=Math.sqrt(d*d+g*g),x=_/(_+m),b=u.x+f*a*x,y=u.y+p*a*x;b=Math.min(b,Math.max(h.x,u.x)),y=Math.min(y,Math.max(h.y,u.y)),b=Math.max(b,Math.min(h.x,u.x)),y=Math.max(y,Math.min(h.y,u.y)),f=b-u.x,p=y-u.y;var E=u.x-f*m/_,C=u.y-p*m/_;E=Math.min(E,Math.max(l.x,u.x)),C=Math.min(C,Math.max(l.y,u.y)),E=Math.max(E,Math.min(l.x,u.x)),C=Math.max(C,Math.min(l.y,u.y)),f=u.x-E,p=u.y-C,b=u.x+f*_/m,y=u.y+p*_/m,r.bezierCurveTo(n,o,E,C,u.x,u.y),n=b,o=y}var w=e[i-1];r.bezierCurveTo(n,o,w.x,w.y,w.x,w.y)}else for(var s=1;s<i;s++)r.lineTo(e[s].x,e[s].y)}function Ui(r,e,t){var i=[];i=i.concat(e);var a=t.style,n=a===void 0?H.Solid:a,o=t.smooth,s=o===void 0?!1:o,l=t.size,u=l===void 0?1:l,h=t.color,c=h===void 0?"currentColor":h,v=t.dashedValue,d=v===void 0?[2,2]:v;r.lineWidth=u,r.strokeStyle=c,n===H.Dashed?r.setLineDash(d):r.setLineDash([]);var g=u%2===1?.5:0;i.forEach(function(f){var p=f.coordinates;p.length>1&&(p.length===2&&(p[0].x===p[1].x||p[0].y===p[1].y)?(r.beginPath(),p[0].x===p[1].x?(r.moveTo(p[0].x+g,p[0].y),r.lineTo(p[1].x+g,p[1].y)):(r.moveTo(p[0].x,p[0].y+g),r.lineTo(p[1].x,p[1].y+g)),r.stroke(),r.closePath()):(r.save(),u%2===1&&r.translate(.5,.5),r.beginPath(),r.moveTo(p[0].x,p[0].y),pr(r,p,s),r.stroke(),r.closePath(),r.restore()))})}var Zi={name:"line",checkEventOn:Gi,draw:function(r,e,t){Ui(r,e,t)}};function mr(r,e,t){var i=t??0,a=[];if(r.length>1)if(r[0].x===r[1].x){var n=0,o=e.height;if(a.push({coordinates:[{x:r[0].x,y:n},{x:r[0].x,y:o}]}),r.length>2){a.push({coordinates:[{x:r[2].x,y:n},{x:r[2].x,y:o}]});for(var s=r[0].x-r[2].x,l=0;l<i;l++){var u=s*(l+1);a.push({coordinates:[{x:r[0].x+u,y:n},{x:r[0].x+u,y:o}]})}}}else{var h=0,c=e.width,v=Oe(r[0],r[1]),d=v[0],g=v[1];if(a.push({coordinates:[{x:h,y:h*d+g},{x:c,y:c*d+g}]}),r.length>2){var f=r[2].y-d*r[2].x;a.push({coordinates:[{x:h,y:h*d+f},{x:c,y:c*d+f}]});for(var s=g-f,l=0;l<i;l++){var p=g+s*(l+1);a.push({coordinates:[{x:h,y:h*d+p},{x:c,y:c*d+p}]})}}}return a}var qi={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=r.bounding;return[{type:"line",attrs:mr(e,t)}]}},ji={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=r.bounding;return[{type:"line",attrs:mr(e,t,1)}]}},$i={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e,t=r.chart,i=r.coordinates,a=r.bounding,n=r.overlay,o=r.yAxis,s=0;if(!((e=o==null?void 0:o.isInCandle())!==null&&e!==void 0)||e)s=t.getPrecision().price;else{var l=t.getIndicators({paneId:n.paneId});l.forEach(function(c){s=Math.max(s,c.precision)})}var u=n.points[0].value,h=u===void 0?0:u;return[{type:"line",attrs:{coordinates:[i[0],{x:a.width,y:i[0].y}]}},{type:"text",ignoreEvent:!0,attrs:{x:i[0].x,y:i[0].y,text:t.getDecimalFold().format(t.getThousandsSeparator().format(h.toFixed(s))),baseline:"bottom"}}]}};function Qi(r,e){if(r.length>1){var t={x:0,y:0};return r[0].x===r[1].x&&r[0].y!==r[1].y?r[0].y<r[1].y?t={x:r[0].x,y:e.height}:t={x:r[0].x,y:0}:r[0].x>r[1].x?t={x:0,y:xe(r[0],r[1],{x:0,y:r[0].y})}:t={x:e.width,y:xe(r[0],r[1],{x:e.width,y:r[0].y})},{coordinates:[r[0],t]}}return[]}var Ji={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=r.bounding;return[{type:"line",attrs:Qi(e,t)}]}},Ki={name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates;return e.length===2?[{type:"line",attrs:{coordinates:e}}]:[]}},ta={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=r.bounding;return e.length===2?e[0].x===e[1].x?[{type:"line",attrs:{coordinates:[{x:e[0].x,y:0},{x:e[0].x,y:t.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:xe(e[0],e[1],{x:0,y:e[0].y})},{x:t.width,y:xe(e[0],e[1],{x:t.width,y:e[0].y})}]}}]:[]}},ea={name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=r.bounding;if(e.length===2){var i={x:e[0].x,y:0};return e[0].y<e[1].y&&(i.y=t.height),[{type:"line",attrs:{coordinates:[e[0],i]}}]}return[]},performEventPressedMove:function(r){var e=r.points,t=r.performPoint;e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex,e[1].timestamp=t.timestamp,e[1].dataIndex=t.dataIndex},performEventMoveForDrawing:function(r){var e=r.currentStep,t=r.points,i=r.performPoint;e===2&&(t[0].timestamp=i.timestamp,t[0].dataIndex=i.dataIndex)}},ra={name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates;return e.length===2?[{type:"line",attrs:{coordinates:e}}]:[]},performEventPressedMove:function(r){var e=r.points,t=r.performPoint;e[0].timestamp=t.timestamp,e[0].dataIndex=t.dataIndex,e[1].timestamp=t.timestamp,e[1].dataIndex=t.dataIndex},performEventMoveForDrawing:function(r){var e=r.currentStep,t=r.points,i=r.performPoint;e===2&&(t[0].timestamp=i.timestamp,t[0].dataIndex=i.dataIndex)}},ia={name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:function(r){var e=r.coordinates,t=r.bounding;return[{type:"line",attrs:{coordinates:[{x:e[0].x,y:0},{x:e[0].x,y:t.height}]}}]}},aa={name:"simpleAnnotation",totalStep:2,styles:{line:{style:H.Dashed}},createPointFigures:function(r){var e,t=r.overlay,i=r.coordinates,a="";S(t.extendData)&&(at(t.extendData)?a=t.extendData(t):a=(e=t.extendData)!==null&&e!==void 0?e:"");var n=i[0].x,o=i[0].y-6,s=o-50,l=s-5;return[{type:"line",attrs:{coordinates:[{x:n,y:o},{x:n,y:s}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:n,y:s},{x:n-4,y:l},{x:n+4,y:l}]},ignoreEvent:!0},{type:"text",attrs:{x:n,y:l,text:a,align:"center",baseline:"bottom"},ignoreEvent:!0}]}},na={name:"simpleTag",totalStep:2,styles:{line:{style:H.Dashed}},createPointFigures:function(r){var e=r.bounding,t=r.coordinates;return{type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:e.width,y:t[0].y}]},ignoreEvent:!0}},createYAxisFigures:function(r){var e,t,i=r.chart,a=r.overlay,n=r.coordinates,o=r.bounding,s=r.yAxis,l=(e=s==null?void 0:s.isFromZero())!==null&&e!==void 0?e:!1,u="left",h=0;l?(u="left",h=0):(u="right",h=o.width);var c="";return S(a.extendData)&&(at(a.extendData)?c=a.extendData(a):c=(t=a.extendData)!==null&&t!==void 0?t:""),!S(c)&&B(a.points[0].value)&&(c=it(a.points[0].value,i.getPrecision().price)),{type:"text",attrs:{x:h,y:n[0].y,text:c,align:u,baseline:"middle"}}}},yr={},oa=[Wi,zi,Xi,Yi,qi,ji,$i,Ji,Ki,ta,ea,ra,ia,aa,na];oa.forEach(function(r){yr[r.name]=oi.extend(r)});function sa(r){var e;return(e=yr[r])!==null&&e!==void 0?e:null}var la={grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},text:{color:"#76808F"}}},indicator:{tooltip:{text:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},ua={grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},text:{color:"#929AA5"}}},indicator:{tooltip:{text:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}},ha={light:la,dark:ua};function ca(r){var e;return(e=ha[r])!==null&&e!==void 0?e:null}var de=30,_r=100,N={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",X_AXIS:"x_axis_pane"},Je={MIN:1,MAX:50},va=10,da=80,fa=.2,Re=10,Ke=15*60*1e3,ga=function(){function r(e,t){var i=this;this._styles=$r(),this._customApi={formatDate:function(c,v){return Kr(i._dateTimeFormat,c,v)},formatBigNumber:ti},this._locale="en-US",this._thousandsSeparator={sign:",",format:function(c){return ei(c,i._thousandsSeparator.sign)}},this._decimalFold={threshold:3,format:function(c){return ri(c,i._decimalFold.threshold)}},this._precision={price:2,volume:0},this._dataList=[],this._loadMoreDataCallback=null,this._loading=!0,this._loadDataMore={forward:!1,backward:!1},this._zoomEnabled=!0,this._scrollEnabled=!0,this._totalBarSpace=0,this._barSpace=va,this._offsetRightDistance=da,this._startLastBarRightSideDiffBarCount=0,this._scrollLimitRole=0,this._minVisibleBarCount={left:2,right:2},this._maxOffsetDistance={left:50,right:50},this._visibleRange=je(),this._timeWeightTickMap=new Map,this._timeWeightTickList=[],this._minTimeSpan={compare:Number.MAX_SAFE_INTEGER,calc:Ke},this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._crosshair={},this._activeTooltipFeatureInfo=null,this._actions=new Map,this._indicators=new Map,this._taskScheduler=new hi,this._overlays=new Map,this._progressOverlayInfo=null,this._pressedOverlayInfo={paneId:"",overlay:null,figureType:0,figureIndex:-1,figure:null},this._hoverOverlayInfo={paneId:"",overlay:null,figureType:0,figureIndex:-1,figure:null},this._clickOverlayInfo={paneId:"",overlay:null,figureType:0,figureIndex:-1,figure:null},this._chart=e,this._calcOptimalBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace;var a=t??{},n=a.styles,o=a.locale,s=a.timezone,l=a.customApi,u=a.thousandsSeparator,h=a.decimalFold;S(n)&&this.setStyles(n),Y(o)&&this.setLocale(o),this.setTimezone(s??""),S(l)&&this.setCustomApi(l),S(u)&&this.setThousandsSeparator(u),S(h)&&this.setDecimalFold(h)}return r.prototype.setStyles=function(e){var t,i,a=null;Y(e)?a=ca(e):a=e,q(this._styles,a),At((i=(t=a==null?void 0:a.candle)===null||t===void 0?void 0:t.tooltip)===null||i===void 0?void 0:i.custom)&&(this._styles.candle.tooltip.custom=a.candle.tooltip.custom)},r.prototype.getStyles=function(){return this._styles},r.prototype.setCustomApi=function(e){q(this._customApi,e)},r.prototype.getCustomApi=function(){return this._customApi},r.prototype.setLocale=function(e){this._locale=e},r.prototype.getLocale=function(){return this._locale},r.prototype.setTimezone=function(e){if(!S(this._dateTimeFormat)||this.getTimezone()!==e){var t={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};e.length>0&&(t.timeZone=e);var i=null;try{i=new Intl.DateTimeFormat("en",t)}catch{}i!==null&&(this._classifyTimeWeightTicks(this._dataList),this._dateTimeFormat=i)}},r.prototype.getTimezone=function(){return this._dateTimeFormat.resolvedOptions().timeZone},r.prototype.getDateTimeFormat=function(){return this._dateTimeFormat},r.prototype.setThousandsSeparator=function(e){q(this._thousandsSeparator,e)},r.prototype.getThousandsSeparator=function(){return this._thousandsSeparator},r.prototype.setDecimalFold=function(e){q(this._decimalFold,e)},r.prototype.getDecimalFold=function(){return this._decimalFold},r.prototype.getPrecision=function(){return this._precision},r.prototype.setPrecision=function(e){q(this._precision,e),this._synchronizeIndicatorSeriesPrecision()},r.prototype.getDataList=function(){return this._dataList},r.prototype.getVisibleRangeDataList=function(){return this._visibleRangeDataList},r.prototype.getVisibleRangeHighLowPrice=function(){return this._visibleRangeHighLowPrice},r.prototype.addData=function(e,t,i){var a=this,n,o,s,l,u=!1,h=!1,c=0;if(At(e)){switch(c=e.length,t){case st.Init:{this.clearData(),this._dataList=e,this._loadDataMore.backward=(n=i==null?void 0:i.backward)!==null&&n!==void 0?n:!1,this._loadDataMore.forward=(o=i==null?void 0:i.forward)!==null&&o!==void 0?o:!1,this._classifyTimeWeightTicks(this._dataList),this.setOffsetRightDistance(this._offsetRightDistance),h=!0;break}case st.Backward:{this._classifyTimeWeightTicks(e,!0),this._dataList=this._dataList.concat(e),this._loadDataMore.backward=(s=i==null?void 0:i.backward)!==null&&s!==void 0?s:!1,h=c>0;break}case st.Forward:{this._dataList=e.concat(this._dataList),this._classifyTimeWeightTicks(this._dataList),this._loadDataMore.forward=(l=i==null?void 0:i.forward)!==null&&l!==void 0?l:!1,h=c>0;break}}this._loading=!1,u=!0}else{var v=this._dataList.length,d=e.timestamp,g=Q(this._dataList[v-1],"timestamp",0);if(d>g){this._classifyTimeWeightTicks([e],!0),this._dataList.push(e);var f=this.getLastBarRightSideDiffBarCount();f<0&&this.setLastBarRightSideDiffBarCount(--f),c=1,u=!0,h=!0}else d===g&&(this._dataList[v-1]=e,u=!0,h=!0)}if(u&&h){this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0});var p=this.getIndicatorsByFilter({});p.forEach(function(m){a._addIndicatorCalcTask(m,t)}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})}},r.prototype.setLoadMoreDataCallback=function(e){this._loadMoreDataCallback=e},r.prototype._calcOptimalBarSpace=function(){var e=4,t=1-fa*Math.atan(Math.max(e,this._barSpace)-e)/(Math.PI*.5),i=Math.min(Math.floor(this._barSpace*t),Math.floor(this._barSpace));i%2===0&&i+2>=this._barSpace&&--i,this._gapBarSpace=Math.max(1,i)},r.prototype._classifyTimeWeightTicks=function(e,t){var i=0,a=null;t??!1?(i=this._dataList.length,a=this._dataList[i-1].timestamp):(this._timeWeightTickMap.clear(),this._minTimeSpan={compare:Number.MAX_SAFE_INTEGER,calc:Ke}),cr(this._timeWeightTickMap,e,this._dateTimeFormat,i,this._minTimeSpan,a),this._minTimeSpan.compare!==Number.MAX_SAFE_INTEGER&&(this._minTimeSpan.calc=this._minTimeSpan.compare),this._timeWeightTickList=De(this._timeWeightTickMap,this._barSpace,this._styles.xAxis.tickText)},r.prototype.getTimeWeightTickList=function(){return this._timeWeightTickList},r.prototype._adjustVisibleRange=function(){var e=this,t,i,a,n,o=this._dataList.length,s=this._totalBarSpace/this._barSpace,l=0,u=0;this._scrollLimitRole===1?(l=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,u=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(l=this._minVisibleBarCount.left,u=this._minVisibleBarCount.right),l=Math.max(0,l),u=Math.max(0,u);var h=s-Math.min(l,o);this._lastBarRightSideDiffBarCount>h&&(this._lastBarRightSideDiffBarCount=h);var c=-o+Math.min(u,o);this._lastBarRightSideDiffBarCount<c&&(this._lastBarRightSideDiffBarCount=c);var v=Math.round(this._lastBarRightSideDiffBarCount+o+.5),d=v;v>o&&(v=o);var g=Math.round(v-s)-1;g<0&&(g=0);var f=this._lastBarRightSideDiffBarCount>0?Math.round(o+this._lastBarRightSideDiffBarCount-s)-1:g;this._visibleRange={from:g,to:v,realFrom:f,realTo:d},this.executeAction(_t.OnVisibleRangeChange,this._visibleRange),this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}];for(var p=f;p<d;p++){var m=this._dataList[p],_=this.dataIndexToCoordinate(p);this._visibleRangeDataList.push({dataIndex:p,x:_,data:{prev:(t=this._dataList[p-1])!==null&&t!==void 0?t:m,current:m,next:(i=this._dataList[p-1])!==null&&i!==void 0?i:m}}),S(m)&&(this._visibleRangeHighLowPrice[0].price<m.high&&(this._visibleRangeHighLowPrice[0].price=m.high,this._visibleRangeHighLowPrice[0].x=_),this._visibleRangeHighLowPrice[1].price>m.low&&(this._visibleRangeHighLowPrice[1].price=m.low,this._visibleRangeHighLowPrice[1].x=_))}if(!this._loading&&S(this._loadMoreDataCallback)){var x=null;g===0?this._loadDataMore.forward&&(this._loading=!0,x={type:st.Forward,data:(a=this._dataList[0])!==null&&a!==void 0?a:null,callback:function(b,y){e.addData(b,st.Forward,{forward:y??!1,backward:y??!1})}}):v===o&&this._loadDataMore.backward&&(this._loading=!0,x={type:st.Backward,data:(n=this._dataList[o-1])!==null&&n!==void 0?n:null,callback:function(b,y){e.addData(b,st.Backward,{forward:y??!1,backward:y??!1})}}),S(x)&&this._loadMoreDataCallback(x)}},r.prototype.getBarSpace=function(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:Math.floor(this._gapBarSpace/2)}},r.prototype.setBarSpace=function(e,t){e<Je.MIN||e>Je.MAX||this._barSpace===e||(this._barSpace=e,this._timeWeightTickList=De(this._timeWeightTickMap,this._barSpace,this._styles.xAxis.tickText),this._calcOptimalBarSpace(),t==null||t(),this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}))},r.prototype.setTotalBarSpace=function(e){this._totalBarSpace!==e&&(this._totalBarSpace=e,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}))},r.prototype.setOffsetRightDistance=function(e,t){return this._offsetRightDistance=this._scrollLimitRole===1?Math.min(this._maxOffsetDistance.right,e):e,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,(t??!1)&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})),this},r.prototype.getInitialOffsetRightDistance=function(){return this._offsetRightDistance},r.prototype.getOffsetRightDistance=function(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)},r.prototype.getLastBarRightSideDiffBarCount=function(){return this._lastBarRightSideDiffBarCount},r.prototype.setLastBarRightSideDiffBarCount=function(e){this._lastBarRightSideDiffBarCount=e},r.prototype.setMaxOffsetLeftDistance=function(e){this._scrollLimitRole=1,this._maxOffsetDistance.left=e},r.prototype.setMaxOffsetRightDistance=function(e){this._scrollLimitRole=1,this._maxOffsetDistance.right=e},r.prototype.setLeftMinVisibleBarCount=function(e){this._scrollLimitRole=0,this._minVisibleBarCount.left=e},r.prototype.setRightMinVisibleBarCount=function(e){this._scrollLimitRole=0,this._minVisibleBarCount.right=e},r.prototype.getVisibleRange=function(){return this._visibleRange},r.prototype.startScroll=function(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount},r.prototype.scroll=function(e){if(this._scrollEnabled){var t=e/this._barSpace,i=this._lastBarRightSideDiffBarCount*this._barSpace;this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-t,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0});var a=Math.round(i-this._lastBarRightSideDiffBarCount*this._barSpace);a!==0&&this.executeAction(_t.OnScroll,{distance:a})}},r.prototype.getDataByDataIndex=function(e){var t;return(t=this._dataList[e])!==null&&t!==void 0?t:null},r.prototype.coordinateToFloatIndex=function(e){var t=this._dataList.length,i=(this._totalBarSpace-e)/this._barSpace,a=t+this._lastBarRightSideDiffBarCount-i;return Math.round(a*1e6)/1e6},r.prototype.dataIndexToTimestamp=function(e){var t=this._dataList.length;if(t===0)return null;var i=this.getDataByDataIndex(e);if(S(i))return i.timestamp;var a=t-1;return e>a?this._dataList[a].timestamp+this._minTimeSpan.calc*(e-a):e<0?this._dataList[0].timestamp-this._minTimeSpan.calc*Math.abs(e):null},r.prototype.timestampToDataIndex=function(e){var t=this._dataList.length;if(t===0)return 0;var i=t-1,a=this._dataList[i].timestamp;if(e>a)return i+Math.floor((e-a)/this._minTimeSpan.calc);var n=this._dataList[0].timestamp;return e<n?Math.floor((e-n)/this._minTimeSpan.calc):ke(this._dataList,"timestamp",e)},r.prototype.dataIndexToCoordinate=function(e){var t=this._dataList.length,i=t+this._lastBarRightSideDiffBarCount-e;return Math.floor(this._totalBarSpace-(i-.5)*this._barSpace+.5)},r.prototype.coordinateToDataIndex=function(e){return Math.ceil(this.coordinateToFloatIndex(e))-1},r.prototype.zoom=function(e,t){var i=this,a;if(this._zoomEnabled){var n=t??null;B(n==null?void 0:n.x)||(n={x:(a=this._crosshair.x)!==null&&a!==void 0?a:this._totalBarSpace/2});var o=n.x,s=this.coordinateToFloatIndex(o),l=this._barSpace,u=this._barSpace+e*(this._barSpace/Re);this.setBarSpace(u,function(){i._lastBarRightSideDiffBarCount+=s-i.coordinateToFloatIndex(o)});var h=this._barSpace/l;h!==1&&this.executeAction(_t.OnZoom,{scale:h})}},r.prototype.setZoomEnabled=function(e){this._zoomEnabled=e},r.prototype.isZoomEnabled=function(){return this._zoomEnabled},r.prototype.setScrollEnabled=function(e){this._scrollEnabled=e},r.prototype.isScrollEnabled=function(){return this._scrollEnabled},r.prototype.setCrosshair=function(e,t){var i,a=t??{},n=a.notInvalidate,o=a.notExecuteAction,s=a.forceInvalidate,l=e??{},u=0,h=0;B(l.x)?(u=this.coordinateToDataIndex(l.x),u<0?h=0:u>this._dataList.length-1?h=this._dataList.length-1:h=u):(u=this._dataList.length-1,h=u);var c=this._dataList[h],v=this.dataIndexToCoordinate(u),d={x:this._crosshair.x,y:this._crosshair.y,paneId:this._crosshair.paneId};this._crosshair=R(R({},l),{realX:v,kLineData:c,realDataIndex:u,dataIndex:h,timestamp:(i=this.dataIndexToTimestamp(u))!==null&&i!==void 0?i:void 0}),(d.x!==l.x||d.y!==l.y||d.paneId!==l.paneId||(s??!1))&&(S(c)&&!(o??!1)&&this._chart.crosshairChange(this._crosshair),(n??!1)||this._chart.updatePane(1))},r.prototype.getCrosshair=function(){return this._crosshair},r.prototype.setActiveTooltipFeatureInfo=function(e){this._activeTooltipFeatureInfo=e??null},r.prototype.getActiveTooltipFeatureInfo=function(){return this._activeTooltipFeatureInfo},r.prototype.executeAction=function(e,t){var i;(i=this._actions.get(e))===null||i===void 0||i.execute(t)},r.prototype.subscribeAction=function(e,t){var i;this._actions.has(e)||this._actions.set(e,new ii),(i=this._actions.get(e))===null||i===void 0||i.subscribe(t)},r.prototype.unsubscribeAction=function(e,t){var i=this._actions.get(e);S(i)&&(i.unsubscribe(t),i.isEmpty()&&this._actions.delete(e))},r.prototype.hasAction=function(e){var t=this._actions.get(e);return S(t)&&!t.isEmpty()},r.prototype._sortIndicators=function(e){var t;Y(e)?(t=this._indicators.get(e))===null||t===void 0||t.sort(function(i,a){return i.zLevel-a.zLevel}):this._indicators.forEach(function(i){i.sort(function(a,n){return a.zLevel-n.zLevel})})},r.prototype._addIndicatorCalcTask=function(e,t){var i=this;this._taskScheduler.addTask({id:$e(e.id),handler:function(){var a;(a=e.onDataStateChange)===null||a===void 0||a.call(e,{state:te.Loading,type:t,indicator:e}),e.calcImp(i._dataList).then(function(n){var o;n&&(i._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}),(o=e.onDataStateChange)===null||o===void 0||o.call(e,{state:te.Ready,type:t,indicator:e}))}).catch(function(){var n;(n=e.onDataStateChange)===null||n===void 0||n.call(e,{state:te.Error,type:t,indicator:e})})}})},r.prototype.addIndicator=function(e,t,i){var a=e.name,n=this.getIndicatorsByFilter(e);if(n.length>0)return!1;var o=this.getIndicatorsByPaneId(t),s=fr(a),l=new s;return this._synchronizeIndicatorSeriesPrecision(l),l.paneId=t,l.override(e),i||(this.removeIndicator({paneId:t}),o=[]),o.push(l),this._indicators.set(t,o),this._sortIndicators(t),this._addIndicatorCalcTask(l,st.Init),!0},r.prototype.getIndicatorsByPaneId=function(e){var t;return(t=this._indicators.get(e))!==null&&t!==void 0?t:[]},r.prototype.getIndicatorsByFilter=function(e){var t=e.paneId,i=e.name,a=e.id,n=function(s){return S(a)?s.id===a:!S(i)||s.name===i},o=[];return S(t)?o=o.concat(this.getIndicatorsByPaneId(t).filter(n)):this._indicators.forEach(function(s){o=o.concat(s.filter(n))}),o},r.prototype.removeIndicator=function(e){var t=this,i=!1,a=this.getIndicatorsByFilter(e);return a.forEach(function(n){var o=t.getIndicatorsByPaneId(n.paneId),s=o.findIndex(function(l){return l.id===n.id});s>-1&&(t._taskScheduler.removeTask($e(n.id)),o.splice(s,1),i=!0),o.length===0&&t._indicators.delete(n.paneId)}),i},r.prototype.hasIndicators=function(e){return this._indicators.has(e)},r.prototype._synchronizeIndicatorSeriesPrecision=function(e){var t=this._precision,i=t.price,a=t.volume,n=function(o){switch(o.series){case ht.Price:{o.setSeriesPrecision(i);break}case ht.Volume:{o.setSeriesPrecision(a);break}}};S(e)?n(e):this._indicators.forEach(function(o){o.forEach(function(s){n(s)})})},r.prototype.overrideIndicator=function(e){var t=this,i=!1,a=!1,n=this.getIndicatorsByFilter(e);return n.forEach(function(o){o.override(e);var s=o.shouldUpdateImp(),l=s.calc,u=s.draw,h=s.sort;h&&(a=!0),l?t._addIndicatorCalcTask(o,st.Update):u&&(i=!0)}),a&&this._sortIndicators(),i?(this._chart.layout({update:!0}),!0):!1},r.prototype.getOverlaysByFilter=function(e){var t,i=e.id,a=e.groupId,n=e.paneId,o=e.name,s=function(h){return S(i)?h.id===i:S(a)?h.groupId===a&&(!S(o)||h.name===o):!S(o)||h.name===o},l=[];S(n)?l=l.concat(this.getOverlaysByPaneId(n).filter(s)):this._overlays.forEach(function(h){l=l.concat(h.filter(s))});var u=(t=this._progressOverlayInfo)===null||t===void 0?void 0:t.overlay;return S(u)&&s(u)&&l.push(u),l},r.prototype.getOverlaysByPaneId=function(e){var t;if(!Y(e)){var i=[];return this._overlays.forEach(function(a){i=i.concat(a)}),i}return(t=this._overlays.get(e))!==null&&t!==void 0?t:[]},r.prototype._sortOverlays=function(e){var t;Y(e)?(t=this._overlays.get(e))===null||t===void 0||t.sort(function(i,a){return i.zLevel-a.zLevel}):this._overlays.forEach(function(i){i.sort(function(a,n){return a.zLevel-n.zLevel})})},r.prototype.addOverlays=function(e,t){var i=this,a=[],n=e.map(function(o,s){var l,u,h,c,v,d,g,f;if(S(o.id)){var p=null;try{for(var m=ut(i._overlays),_=m.next();!_.done;_=m.next()){var x=It(_.value,2),b=x[1],y=b.find(function(T){return T.id===o.id});if(S(y)){p=y;break}}}catch(T){l={error:T}}finally{try{_&&!_.done&&(u=m.return)&&u.call(m)}finally{if(l)throw l.error}}if(S(p))return o.id}var E=sa(o.name);if(S(E)){var C=(h=o.id)!==null&&h!==void 0?h:ve(ni),y=new E,w=(c=o.paneId)!==null&&c!==void 0?c:N.CANDLE;o.id=C,(v=o.groupId)!==null&&v!==void 0||(o.groupId=C);var I=i.getOverlaysByPaneId(w).length;return(d=o.zLevel)!==null&&d!==void 0||(o.zLevel=I),y.override(o),a.includes(w)||a.push(w),y.isDrawing()?i._progressOverlayInfo={paneId:w,overlay:y,appointPaneFlag:t[s]}:(i._overlays.has(w)||i._overlays.set(w,[]),(g=i._overlays.get(w))===null||g===void 0||g.push(y)),y.isStart()&&((f=y.onDrawStart)===null||f===void 0||f.call(y,{overlay:y,chart:i._chart})),C}return null});return a.length>0&&(this._sortOverlays(),a.forEach(function(o){i._chart.updatePane(1,o)}),this._chart.updatePane(1,N.X_AXIS)),n},r.prototype.getProgressOverlayInfo=function(){return this._progressOverlayInfo},r.prototype.progressOverlayComplete=function(){var e;if(this._progressOverlayInfo!==null){var t=this._progressOverlayInfo,i=t.overlay,a=t.paneId;i.isDrawing()||(this._overlays.has(a)||this._overlays.set(a,[]),(e=this._overlays.get(a))===null||e===void 0||e.push(i),this._sortOverlays(a),this._progressOverlayInfo=null)}},r.prototype.updateProgressOverlayInfo=function(e,t){this._progressOverlayInfo!==null&&(Ce(t)&&t&&(this._progressOverlayInfo.appointPaneFlag=t),this._progressOverlayInfo.paneId=e,this._progressOverlayInfo.overlay.override({paneId:e}))},r.prototype.overrideOverlay=function(e){var t=this,i=!1,a=[],n=this.getOverlaysByFilter(e);return n.forEach(function(o){o.override(e);var s=o.shouldUpdate(),l=s.sort,u=s.draw;l&&(i=!0),(l||u)&&(a.includes(o.paneId)||a.push(o.paneId))}),i&&this._sortOverlays(),a.length>0?(a.forEach(function(o){t._chart.updatePane(1,o)}),this._chart.updatePane(1,N.X_AXIS),!0):!1},r.prototype.removeOverlay=function(e){var t=this,i=[],a=this.getOverlaysByFilter(e);return a.forEach(function(n){var o,s=n.paneId,l=t.getOverlaysByPaneId(n.paneId);if((o=n.onRemoved)===null||o===void 0||o.call(n,{overlay:n,chart:t._chart}),i.includes(s)||i.push(s),n.isDrawing())t._progressOverlayInfo=null;else{var u=l.findIndex(function(h){return h.id===n.id});u>-1&&l.splice(u,1)}l.length===0&&t._overlays.delete(s)}),i.length>0?(i.forEach(function(n){t._chart.updatePane(1,n)}),this._chart.updatePane(1,N.X_AXIS),!0):!1},r.prototype.setPressedOverlayInfo=function(e){this._pressedOverlayInfo=e},r.prototype.getPressedOverlayInfo=function(){return this._pressedOverlayInfo},r.prototype.setHoverOverlayInfo=function(e,t){var i,a=this._hoverOverlayInfo,n=a.overlay,o=a.figureType,s=a.figureIndex,l=a.figure,u=e.overlay;if(((n==null?void 0:n.id)!==(u==null?void 0:u.id)||o!==e.figureType||s!==e.figureIndex)&&(this._hoverOverlayInfo=e,(n==null?void 0:n.id)!==(u==null?void 0:u.id))){var h=!1,c=!1;n!==null&&(n.override({zLevel:n.getPrevZLevel()}),c=!0,at(n.onMouseLeave)&&dt("onMouseLeave",l)&&(n.onMouseLeave(R({chart:this._chart,overlay:n,figure:l??void 0},t)),h=!0)),u!==null&&(u.setPrevZLevel(u.zLevel),u.override({zLevel:Number.MAX_SAFE_INTEGER}),c=!0,at(u.onMouseEnter)&&dt("onMouseEnter",e.figure)&&(u.onMouseEnter(R({chart:this._chart,overlay:u,figure:(i=e.figure)!==null&&i!==void 0?i:void 0},t)),h=!0)),c&&this._sortOverlays(),h||this._chart.updatePane(1)}},r.prototype.getHoverOverlayInfo=function(){return this._hoverOverlayInfo},r.prototype.setClickOverlayInfo=function(e,t){var i,a,n,o,s,l,u=this._clickOverlayInfo,h=u.paneId,c=u.overlay,v=u.figureType,d=u.figure,g=u.figureIndex,f=e.overlay;!((i=f==null?void 0:f.isDrawing())!==null&&i!==void 0&&i)&&dt("onClick",e.figure)&&((a=f==null?void 0:f.onClick)===null||a===void 0||a.call(f,R({chart:this._chart,overlay:f,figure:(n=e.figure)!==null&&n!==void 0?n:void 0},t))),((c==null?void 0:c.id)!==(f==null?void 0:f.id)||v!==e.figureType||g!==e.figureIndex)&&(this._clickOverlayInfo=e,(c==null?void 0:c.id)!==(f==null?void 0:f.id)&&(dt("onDeselected",d)&&((o=c==null?void 0:c.onDeselected)===null||o===void 0||o.call(c,R({chart:this._chart,overlay:c,figure:d??void 0},t))),dt("onSelected",e.figure)&&((s=f==null?void 0:f.onSelected)===null||s===void 0||s.call(f,R({chart:this._chart,overlay:f,figure:(l=e.figure)!==null&&l!==void 0?l:void 0},t))),this._chart.updatePane(1,e.paneId),h!==e.paneId&&this._chart.updatePane(1,h),this._chart.updatePane(1,N.X_AXIS)))},r.prototype.getClickOverlayInfo=function(){return this._clickOverlayInfo},r.prototype.isOverlayEmpty=function(){return this._overlays.size===0&&this._progressOverlayInfo===null},r.prototype.isOverlayDrawing=function(){var e,t;return(t=(e=this._progressOverlayInfo)===null||e===void 0?void 0:e.overlay.isDrawing())!==null&&t!==void 0?t:!1},r.prototype.clearData=function(){this._loadDataMore.backward=!1,this._loadDataMore.forward=!1,this._loading=!0,this._dataList=[],this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._visibleRange=je(),this._timeWeightTickMap.clear(),this._timeWeightTickList=[],this._crosshair={},this._activeTooltipFeatureInfo=null},r.prototype.getChart=function(){return this._chart},r}(),W={MAIN:"main",X_AXIS:"xAxis",Y_AXIS:"yAxis",SEPARATOR:"separator"},ee=7;function pa(){return sr(this,void 0,void 0,function(){return lr(this,function(r){switch(r.label){case 0:return[4,new Promise(function(e){var t=new ResizeObserver(function(i){e(i.every(function(a){return"devicePixelContentBoxSize"in a})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})];case 1:return[2,r.sent()]}})})}var tr=function(){function r(e,t){var i=this;this._supportedDevicePixelContentBox=!1,this._width=0,this._height=0,this._pixelWidth=0,this._pixelHeight=0,this._nextPixelWidth=0,this._nextPixelHeight=0,this._requestAnimationId=Ut,this._mediaQueryListener=function(){var a=Ot(i._element);i._nextPixelWidth=Math.round(i._element.clientWidth*a),i._nextPixelHeight=Math.round(i._element.clientHeight*a),i._resetPixelRatio()},this._listener=t,this._element=Dt("canvas",e),this._ctx=this._element.getContext("2d"),pa().then(function(a){i._supportedDevicePixelContentBox=a,a?(i._resizeObserver=new ResizeObserver(function(n){var o=n.find(function(l){return l.target===i._element}),s=o==null?void 0:o.devicePixelContentBoxSize[0];S(s)&&(i._nextPixelWidth=s.inlineSize,i._nextPixelHeight=s.blockSize,(i._pixelWidth!==i._nextPixelWidth||i._pixelHeight!==i._nextPixelHeight)&&i._resetPixelRatio())}),i._resizeObserver.observe(i._element,{box:"device-pixel-content-box"})):(i._mediaQueryList=window.matchMedia("(resolution: ".concat(Ot(i._element),"dppx)")),i._mediaQueryList.addListener(i._mediaQueryListener))}).catch(function(a){return!1})}return r.prototype._resetPixelRatio=function(){var e=this;this._executeListener(function(){var t=e._element.clientWidth,i=e._element.clientHeight;e._width=t,e._height=i,e._pixelWidth=e._nextPixelWidth,e._pixelHeight=e._nextPixelHeight,e._element.width=e._nextPixelWidth,e._element.height=e._nextPixelHeight;var a=e._nextPixelWidth/t,n=e._nextPixelHeight/i;e._ctx.scale(a,n)})},r.prototype._executeListener=function(e){var t=this;this._requestAnimationId===Ut&&(this._requestAnimationId=_e(function(){t._ctx.clearRect(0,0,t._width,t._height),e==null||e(),t._listener(),t._requestAnimationId=Ut}))},r.prototype.update=function(e,t){if(this._width!==e||this._height!==t){if(this._element.style.width="".concat(e,"px"),this._element.style.height="".concat(t,"px"),!this._supportedDevicePixelContentBox){var i=Ot(this._element);this._nextPixelWidth=Math.round(e*i),this._nextPixelHeight=Math.round(t*i),this._resetPixelRatio()}}else this._executeListener()},r.prototype.getElement=function(){return this._element},r.prototype.getContext=function(){return this._ctx},r.prototype.destroy=function(){S(this._resizeObserver)&&this._resizeObserver.unobserve(this._element),S(this._mediaQueryList)&&this._mediaQueryList.removeListener(this._mediaQueryListener)},r}(),xr=function(r){V(e,r);function e(t,i){var a=r.call(this)||this;return a._bounding=ye(),a._pane=i,a._rootContainer=t,a._container=a.createContainer(),t.appendChild(a._container),a}return e.prototype.setBounding=function(t){return q(this._bounding,t),this},e.prototype.getContainer=function(){return this._container},e.prototype.getBounding=function(){return this._bounding},e.prototype.getPane=function(){return this._pane},e.prototype.update=function(t){this.updateImp(this._container,this._bounding,t??3)},e.prototype.destroy=function(){this._rootContainer.removeChild(this._container)},e}(Be),Le=function(r){V(e,r);function e(t,i){var a=r.call(this,t,i)||this;a._mainCanvas=new tr({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},function(){a.updateMain(a._mainCanvas.getContext())}),a._overlayCanvas=new tr({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},function(){a.updateOverlay(a._overlayCanvas.getContext())});var n=a.getContainer();return n.appendChild(a._mainCanvas.getElement()),n.appendChild(a._overlayCanvas.getElement()),a}return e.prototype.createContainer=function(){return Dt("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})},e.prototype.updateImp=function(t,i,a){var n=i.width,o=i.height,s=i.left;t.style.left="".concat(s,"px");var l=a,u=t.clientWidth,h=t.clientHeight;switch((n!==u||o!==h)&&(t.style.width="".concat(n,"px"),t.style.height="".concat(o,"px"),l=3),l){case 0:{this._mainCanvas.update(n,o);break}case 1:{this._overlayCanvas.update(n,o);break}case 3:case 4:{this._mainCanvas.update(n,o),this._overlayCanvas.update(n,o);break}}},e.prototype.destroy=function(){this._mainCanvas.destroy(),this._overlayCanvas.destroy()},e.prototype.getImage=function(t){var i=this.getBounding(),a=i.width,n=i.height,o=Dt("canvas",{width:"".concat(a,"px"),height:"".concat(n,"px"),boxSizing:"border-box"}),s=o.getContext("2d"),l=Ot(o);return o.width=a*l,o.height=n*l,s.scale(l,l),s.drawImage(this._mainCanvas.getElement(),0,0,a,n),t&&s.drawImage(this._overlayCanvas.getElement(),0,0,a,n),o},e}(xr);function ma(r,e){var t,i,a=[];a=a.concat(e);try{for(var n=ut(a),o=n.next();!o.done;o=n.next()){var s=o.value,l=s.x,u=s.y,h=s.r,c=r.x-l,v=r.y-u;if(!(c*c+v*v>h*h))return!0}}catch(d){t={error:d}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return!1}function ya(r,e,t){var i=[];i=i.concat(e);var a=t.style,n=a===void 0?X.Fill:a,o=t.color,s=o===void 0?"currentColor":o,l=t.borderSize,u=l===void 0?1:l,h=t.borderColor,c=h===void 0?"currentColor":h,v=t.borderStyle,d=v===void 0?H.Solid:v,g=t.borderDashedValue,f=g===void 0?[2,2]:g,p=(n===X.Fill||t.style===X.StrokeFill)&&(!Y(s)||!Zt(s));p&&(r.fillStyle=s,i.forEach(function(m){var _=m.x,x=m.y,b=m.r;r.beginPath(),r.arc(_,x,b,0,Math.PI*2),r.closePath(),r.fill()})),(n===X.Stroke||t.style===X.StrokeFill)&&u>0&&!Zt(c)&&(r.strokeStyle=c,r.lineWidth=u,d===H.Dashed?r.setLineDash(f):r.setLineDash([]),i.forEach(function(m){var _=m.x,x=m.y,b=m.r;(!p||b>u)&&(r.beginPath(),r.arc(_,x,b,0,Math.PI*2),r.closePath(),r.stroke())}))}var _a={name:"circle",checkEventOn:ma,draw:function(r,e,t){ya(r,e,t)}};function xa(r,e){var t,i,a=[];a=a.concat(e);try{for(var n=ut(a),o=n.next();!o.done;o=n.next()){for(var s=o.value,l=!1,u=s.coordinates,h=0,c=u.length-1;h<u.length;c=h++)u[h].y>r.y!=u[c].y>r.y&&r.x<(u[c].x-u[h].x)*(r.y-u[h].y)/(u[c].y-u[h].y)+u[h].x&&(l=!l);if(l)return!0}}catch(v){t={error:v}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return!1}function ba(r,e,t){var i=[];i=i.concat(e);var a=t.style,n=a===void 0?X.Fill:a,o=t.color,s=o===void 0?"currentColor":o,l=t.borderSize,u=l===void 0?1:l,h=t.borderColor,c=h===void 0?"currentColor":h,v=t.borderStyle,d=v===void 0?H.Solid:v,g=t.borderDashedValue,f=g===void 0?[2,2]:g;(n===X.Fill||t.style===X.StrokeFill)&&(!Y(s)||!Zt(s))&&(r.fillStyle=s,i.forEach(function(p){var m=p.coordinates;r.beginPath(),r.moveTo(m[0].x,m[0].y);for(var _=1;_<m.length;_++)r.lineTo(m[_].x,m[_].y);r.closePath(),r.fill()})),(n===X.Stroke||t.style===X.StrokeFill)&&u>0&&!Zt(c)&&(r.strokeStyle=c,r.lineWidth=u,d===H.Dashed?r.setLineDash(f):r.setLineDash([]),i.forEach(function(p){var m=p.coordinates;r.beginPath(),r.moveTo(m[0].x,m[0].y);for(var _=1;_<m.length;_++)r.lineTo(m[_].x,m[_].y);r.closePath(),r.stroke()}))}var Ca={name:"polygon",checkEventOn:xa,draw:function(r,e,t){ba(r,e,t)}};function br(r,e){var t,i,a=[];a=a.concat(e);try{for(var n=ut(a),o=n.next();!o.done;o=n.next()){var s=o.value,l=s.x,u=s.width;u<$*2&&(l-=$,u=$*2);var h=s.y,c=s.height;if(c<$*2&&(h-=$,c=$*2),r.x>=l&&r.x<=l+u&&r.y>=h&&r.y<=h+c)return!0}}catch(v){t={error:v}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return!1}function Cr(r,e,t){var i,a=[];a=a.concat(e);var n=t.style,o=n===void 0?X.Fill:n,s=t.color,l=s===void 0?"transparent":s,u=t.borderSize,h=u===void 0?1:u,c=t.borderColor,v=c===void 0?"transparent":c,d=t.borderStyle,g=d===void 0?H.Solid:d,f=t.borderRadius,p=f===void 0?0:f,m=t.borderDashedValue,_=m===void 0?[2,2]:m,x=(i=r.roundRect)!==null&&i!==void 0?i:r.rect,b=(o===X.Fill||t.style===X.StrokeFill)&&(!Y(l)||!Zt(l));if(b&&(r.fillStyle=l,a.forEach(function(C){var w=C.x,I=C.y,T=C.width,M=C.height;r.beginPath(),x.call(r,w,I,T,M,p),r.closePath(),r.fill()})),(o===X.Stroke||t.style===X.StrokeFill)&&h>0&&!Zt(v)){r.strokeStyle=v,r.fillStyle=v,r.lineWidth=h,g===H.Dashed?r.setLineDash(_):r.setLineDash([]);var y=h%2===1?.5:0,E=Math.round(y*2);a.forEach(function(C){var w=C.x,I=C.y,T=C.width,M=C.height;T>h*2&&M>h*2?(r.beginPath(),x.call(r,w+y,I+y,T-E,M-E,p),r.closePath(),r.stroke()):b||r.fillRect(w,I,T,M)})}}var wa={name:"rect",checkEventOn:br,draw:function(r,e,t){Cr(r,e,t)}};function wr(r,e){var t=e.size,i=t===void 0?12:t,a=e.paddingLeft,n=a===void 0?0:a,o=e.paddingTop,s=o===void 0?0:o,l=e.paddingRight,u=l===void 0?0:l,h=e.paddingBottom,c=h===void 0?0:h,v=e.weight,d=v===void 0?"normal":v,g=e.family,f=r.x,p=r.y,m=r.text,_=r.align,x=_===void 0?"left":_,b=r.baseline,y=b===void 0?"top":b,E=r.width,C=r.height,w=E??n+me(m,i,d,g)+u,I=C??s+i+c,T=0;switch(x){case"left":case"start":{T=f;break}case"right":case"end":{T=f-w;break}default:{T=f-w/2;break}}var M=0;switch(y){case"top":case"hanging":{M=p;break}case"bottom":case"ideographic":case"alphabetic":{M=p-I;break}default:{M=p-I/2;break}}return{x:T,y:M,width:w,height:I}}function Sa(r,e,t){var i,a,n=[];n=n.concat(e);try{for(var o=ut(n),s=o.next();!s.done;s=o.next()){var l=s.value,u=wr(l,t),h=u.x,c=u.y,v=u.width,d=u.height;if(r.x>=h&&r.x<=h+v&&r.y>=c&&r.y<=c+d)return!0}}catch(g){i={error:g}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}return!1}function Ea(r,e,t){var i=[];i=i.concat(e);var a=t.color,n=a===void 0?"currentColor":a,o=t.size,s=o===void 0?12:o,l=t.family,u=t.weight,h=t.paddingLeft,c=h===void 0?0:h,v=t.paddingTop,d=v===void 0?0:v,g=t.paddingRight,f=g===void 0?0:g,p=i.map(function(m){return wr(m,t)});Cr(r,p,R(R({},t),{color:t.backgroundColor})),r.textAlign="left",r.textBaseline="top",r.font=zt(s,u,l),r.fillStyle=n,i.forEach(function(m,_){var x=p[_];r.fillText(m.text,x.x+c,x.y+d,x.width-c-f)})}var Ia={name:"text",checkEventOn:Sa,draw:function(r,e,t){Ea(r,e,t)}};function Ta(r,e){var t=r.x-e.x,i=r.y-e.y;return Math.sqrt(t*t+i*i)}function Pa(r,e){var t,i,a=[];a=a.concat(e);try{for(var n=ut(a),o=n.next();!o.done;o=n.next()){var s=o.value;if(Math.abs(Ta(r,s)-s.r)<$){var l=s.r,u=s.startAngle,h=s.endAngle,c=l*Math.cos(u)+s.x,v=l*Math.sin(u)+s.y,d=l*Math.cos(h)+s.x,g=l*Math.sin(h)+s.y;if(r.x<=Math.max(c,d)+$&&r.x>=Math.min(c,d)-$&&r.y<=Math.max(v,g)+$&&r.y>=Math.min(v,g)-$)return!0}}}catch(f){t={error:f}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return!1}function Ma(r,e,t){var i=[];i=i.concat(e);var a=t.style,n=a===void 0?H.Solid:a,o=t.size,s=o===void 0?1:o,l=t.color,u=l===void 0?"currentColor":l,h=t.dashedValue,c=h===void 0?[2,2]:h;r.lineWidth=s,r.strokeStyle=u,n===H.Dashed?r.setLineDash(c):r.setLineDash([]),i.forEach(function(v){var d=v.x,g=v.y,f=v.r,p=v.startAngle,m=v.endAngle;r.beginPath(),r.arc(d,g,f,p,m),r.stroke(),r.closePath()})}var Aa={name:"arc",checkEventOn:Pa,draw:function(r,e,t){Ma(r,e,t)}};function er(r,e,t,i,a,n,o){var s=It(i,7),l=s[0],u=s[1],h=s[2],c=s[3],v=s[4],d=s[5],g=s[6],f=o?e+d:d+a,p=o?t+g:g+n,m=ka(e,t,l,u,h,c,v,f,p);m.forEach(function(_){r.bezierCurveTo(_[0],_[1],_[2],_[3],_[4],_[5])})}function ka(r,e,t,i,a,n,o,s,l){for(var u=Da(r,e,t,i,a,n,o,s,l),h=u.cx,c=u.cy,v=u.startAngle,d=u.deltaAngle,g=[],f=Math.ceil(Math.abs(d)/(Math.PI/2)),p=0;p<f;p++){var m=v+p*d/f,_=v+(p+1)*d/f,x=Ra(h,c,t,i,a,m,_);g.push(x)}return g}function Da(r,e,t,i,a,n,o,s,l){var u=a*Math.PI/180,h=(r-s)/2,c=(e-l)/2,v=Math.cos(u)*h+Math.sin(u)*c,d=-Math.sin(u)*h+Math.cos(u)*c,g=Math.pow(v,2)/Math.pow(t,2)+Math.pow(d,2)/Math.pow(i,2);g>1&&(t*=Math.sqrt(g),i*=Math.sqrt(g));var f=n===o?-1:1,p=Math.pow(t,2)*Math.pow(i,2)-Math.pow(t,2)*Math.pow(d,2)-Math.pow(i,2)*Math.pow(v,2),m=Math.pow(t,2)*Math.pow(d,2)+Math.pow(i,2)*Math.pow(v,2),_=f*Math.sqrt(Math.abs(p/m))*(t*d/i),x=f*Math.sqrt(Math.abs(p/m))*(-i*v/t),b=Math.cos(u)*_-Math.sin(u)*x+(r+s)/2,y=Math.sin(u)*_+Math.cos(u)*x+(e+l)/2,E=Math.atan2((d-x)/i,(v-_)/t),C=Math.atan2((-d-x)/i,(-v-_)/t)-E;return C<0&&o===1?C+=2*Math.PI:C>0&&o===0&&(C-=2*Math.PI),{cx:b,cy:y,startAngle:E,deltaAngle:C}}function Ra(r,e,t,i,a,n,o){var s=Math.sin(o-n)*(Math.sqrt(4+3*Math.pow(Math.tan((o-n)/2),2))-1)/3,l=Math.cos(a),u=Math.sin(a),h=r+t*Math.cos(n)*l-i*Math.sin(n)*u,c=e+t*Math.cos(n)*u+i*Math.sin(n)*l,v=r+t*Math.cos(o)*l-i*Math.sin(o)*u,d=e+t*Math.cos(o)*u+i*Math.sin(o)*l,g=h+s*(-t*Math.sin(n)*l-i*Math.cos(n)*u),f=c+s*(-t*Math.sin(n)*u+i*Math.cos(n)*l),p=v-s*(-t*Math.sin(o)*l-i*Math.cos(o)*u),m=d-s*(-t*Math.sin(o)*u+i*Math.cos(o)*l);return[g,f,p,m,v,d]}function Fa(r,e,t){var i=[];i=i.concat(e);var a=t.lineWidth,n=a===void 0?1:a,o=t.color,s=o===void 0?"currentColor":o;r.lineWidth=n,r.strokeStyle=s,r.setLineDash([]),i.forEach(function(l){var u=l.x,h=l.y,c=l.path,v=c.match(/[MLHVCSQTAZ][^MLHVCSQTAZ]*/gi);if(S(v)){var d=u,g=h;r.beginPath(),v.forEach(function(f){var p=0,m=0,_=0,x=0,b=f[0],y=f.slice(1).trim().split(/[\s,]+/).map(Number);switch(b){case"M":p=y[0]+d,m=y[1]+g,r.moveTo(p,m),_=p,x=m;break;case"m":p+=y[0],m+=y[1],r.moveTo(p,m),_=p,x=m;break;case"L":p=y[0]+d,m=y[1]+g,r.lineTo(p,m);break;case"l":p+=y[0],m+=y[1],r.lineTo(p,m);break;case"H":p=y[0]+d,r.lineTo(p,m);break;case"h":p+=y[0],r.lineTo(p,m);break;case"V":m=y[0]+g,r.lineTo(p,m);break;case"v":m+=y[0],r.lineTo(p,m);break;case"C":r.bezierCurveTo(y[0]+d,y[1]+g,y[2]+d,y[3]+g,y[4]+d,y[5]+g),p=y[4]+d,m=y[5]+g;break;case"c":r.bezierCurveTo(p+y[0],m+y[1],p+y[2],m+y[3],p+y[4],m+y[5]),p+=y[4],m+=y[5];break;case"S":r.bezierCurveTo(p,m,y[0]+d,y[1]+g,y[2]+d,y[3]+g),p=y[2]+d,m=y[3]+g;break;case"s":r.bezierCurveTo(p,m,p+y[0],m+y[1],p+y[2],m+y[3]),p+=y[2],m+=y[3];break;case"Q":r.quadraticCurveTo(y[0]+d,y[1]+g,y[2]+d,y[3]+g),p=y[2]+d,m=y[3]+g;break;case"q":r.quadraticCurveTo(p+y[0],m+y[1],p+y[2],m+y[3]),p+=y[2],m+=y[3];break;case"T":r.quadraticCurveTo(p,m,y[0]+d,y[1]+g),p=y[0]+d,m=y[1]+g;break;case"t":r.quadraticCurveTo(p,m,p+y[0],m+y[1]),p+=y[0],m+=y[1];break;case"A":er(r,p,m,y,d,g,!1),p=y[5]+d,m=y[6]+g;break;case"a":er(r,p,m,y,d,g,!0),p+=y[5],m+=y[6];break;case"Z":case"z":r.closePath(),p=_,m=x;break}}),t.style===Pe.Fill?r.fill():r.stroke()}})}var Ba={name:"path",checkEventOn:br,draw:function(r,e,t){Fa(r,e,t)}},Sr={},Oa=[_a,Zi,Ca,wa,Ia,Aa,Ba];Oa.forEach(function(r){Sr[r.name]=Hi.extend(r)});function La(r){var e;return(e=Sr[r])!==null&&e!==void 0?e:null}var xt=function(r){V(e,r);function e(t){var i=r.call(this)||this;return i._widget=t,i}return e.prototype.getWidget=function(){return this._widget},e.prototype.createFigure=function(t,i){var a=La(t.name);if(a!==null){var n=new a(t);if(S(i)){for(var o in i)i.hasOwnProperty(o)&&n.registerEvent(o,i[o]);this.addChild(n)}return n}return null},e.prototype.draw=function(t){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];this.clear(),this.drawImp(t,i)},e}(Be),Va=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var i,a,n=this.getWidget(),o=this.getWidget().getPane(),s=o.getChart(),l=n.getBounding(),u=s.getStyles().grid,h=u.show;if(h){t.save(),t.globalCompositeOperation="destination-over";var c=u.horizontal,v=c.show;if(v){var d=o.getAxisComponent(),g=d.getTicks().map(function(_){return{coordinates:[{x:0,y:_.coord},{x:l.width,y:_.coord}]}});(i=this.createFigure({name:"line",attrs:g,styles:c}))===null||i===void 0||i.draw(t)}var f=u.vertical,p=f.show;if(p){var m=s.getXAxisPane().getAxisComponent(),g=m.getTicks().map(function(x){return{coordinates:[{x:x.coord,y:0},{x:x.coord,y:l.height}]}});(a=this.createFigure({name:"line",attrs:g,styles:f}))===null||a===void 0||a.draw(t)}t.restore()}},e}(xt),Er=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.eachChildren=function(t){for(var i=this.getWidget().getPane(),a=i.getChart().getChartStore(),n=a.getVisibleRangeDataList(),o=a.getBarSpace(),s=n.length,l=0;l<s;)t(n[l],o,l),++l},e}(xt),Ir=function(r){V(e,r);function e(){var t=r.apply(this,ae([],It(arguments),!1))||this;return t._boundCandleBarClickEvent=function(i){return function(){return t.getWidget().getPane().getChart().getChartStore().executeAction(_t.OnCandleBarClick,i),!1}},t}return e.prototype.drawImp=function(t){var i=this,a=this.getWidget().getPane(),n=a.getId()===N.CANDLE,o=a.getChart().getChartStore(),s=this.getCandleBarOptions();if(s!==null){var l=s.type,u=s.styles,h=0,c=0;if(s.type===ft.Ohlc){var v=o.getBarSpace().gapBar;h=Math.min(Math.max(Math.round(v*.2),1),8),h>2&&h%2===1&&h--,c=Math.floor(c/2)}var d=a.getAxisComponent();this.eachChildren(function(g,f){var p,m=g.x,_=g.data,x=_.current,b=_.prev;if(S(x)){var y=x.open,E=x.high,C=x.low,w=x.close,I=u.compareRule===Lt.CurrentOpen?y:(p=b==null?void 0:b.close)!==null&&p!==void 0?p:w,T=[];w>I?(T[0]=u.upColor,T[1]=u.upBorderColor,T[2]=u.upWickColor):w<I?(T[0]=u.downColor,T[1]=u.downBorderColor,T[2]=u.downWickColor):(T[0]=u.noChangeColor,T[1]=u.noChangeBorderColor,T[2]=u.noChangeWickColor);var M=d.convertToPixel(y),F=d.convertToPixel(w),A=[M,F,d.convertToPixel(E),d.convertToPixel(C)];A.sort(function(k,O){return k-O});var D=f.gapBar%2===0?1:0,P=[];switch(l){case ft.CandleSolid:{P=i._createSolidBar(m,A,f,T,D);break}case ft.CandleStroke:{P=i._createStrokeBar(m,A,f,T,D);break}case ft.CandleUpStroke:{w>y?P=i._createStrokeBar(m,A,f,T,D):P=i._createSolidBar(m,A,f,T,D);break}case ft.CandleDownStroke:{y>w?P=i._createStrokeBar(m,A,f,T,D):P=i._createSolidBar(m,A,f,T,D);break}case ft.Ohlc:{P=[{name:"rect",attrs:[{x:m-c,y:A[0],width:h,height:A[3]-A[0]},{x:m-f.halfGapBar,y:M+h>A[3]?A[3]-h:M,width:f.halfGapBar,height:h},{x:m+c,y:F+h>A[3]?A[3]-h:F,width:f.halfGapBar-c,height:h}],styles:{color:T[0]}}];break}}P.forEach(function(k){var O,z=null;n&&(z={mouseClickEvent:i._boundCandleBarClickEvent(g)}),(O=i.createFigure(k,z??void 0))===null||O===void 0||O.draw(t)})}})}},e.prototype.getCandleBarOptions=function(){var t=this.getWidget().getPane().getChart().getStyles().candle;return{type:t.type,styles:t.bar}},e.prototype._createSolidBar=function(t,i,a,n,o){return[{name:"rect",attrs:{x:t,y:i[0],width:1,height:i[3]-i[0]},styles:{color:n[2]}},{name:"rect",attrs:{x:t-a.halfGapBar,y:i[1],width:a.gapBar+o,height:Math.max(1,i[2]-i[1])},styles:{style:X.StrokeFill,color:n[0],borderColor:n[1]}}]},e.prototype._createStrokeBar=function(t,i,a,n,o){return[{name:"rect",attrs:[{x:t,y:i[0],width:1,height:i[1]-i[0]},{x:t,y:i[2],width:1,height:i[3]-i[2]}],styles:{color:n[2]}},{name:"rect",attrs:{x:t-a.halfGapBar,y:i[1],width:a.gapBar+o,height:Math.max(1,i[2]-i[1])},styles:{style:X.Stroke,borderColor:n[1]}}]},e}(Er),Na=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getCandleBarOptions=function(){var t,i,a=this.getWidget().getPane(),n=a.getAxisComponent();if(!n.isInCandle()){var o=a.getChart().getChartStore(),s=o.getIndicatorsByPaneId(a.getId());try{for(var l=ut(s),u=l.next();!u.done;u=l.next()){var h=u.value;if(h.shouldOhlc&&h.visible){var c=h.styles,v=o.getStyles().indicator,d=Q(c,"ohlc.compareRule",v.ohlc.compareRule),g=Q(c,"ohlc.upColor",v.ohlc.upColor),f=Q(c,"ohlc.downColor",v.ohlc.downColor),p=Q(c,"ohlc.noChangeColor",v.ohlc.noChangeColor);return{type:ft.Ohlc,styles:{compareRule:d,upColor:g,downColor:f,noChangeColor:p,upBorderColor:g,downBorderColor:f,noChangeBorderColor:p,upWickColor:g,downWickColor:f,noChangeWickColor:p}}}}}catch(m){t={error:m}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(t)throw t.error}}}return null},e.prototype.drawImp=function(t){var i=this;r.prototype.drawImp.call(this,t);var a=this.getWidget(),n=a.getPane(),o=n.getChart(),s=a.getBounding(),l=o.getXAxisPane().getAxisComponent(),u=n.getAxisComponent(),h=o.getChartStore(),c=h.getIndicatorsByPaneId(n.getId()),v=h.getStyles().indicator;t.save(),c.forEach(function(d){if(d.visible){d.zLevel<0?t.globalCompositeOperation="destination-over":t.globalCompositeOperation="source-over";var g=!1;if(d.draw!==null&&(t.save(),g=d.draw({ctx:t,chart:o,indicator:d,bounding:s,xAxis:l,yAxis:u}),t.restore()),!g){var f=d.result,p=[];i.eachChildren(function(m,_){var x,b,y,E=_.halfGapBar,C=m.dataIndex,w=m.x,I=l.convertToPixel(C-1),T=l.convertToPixel(C+1),M=(x=f[C-1])!==null&&x!==void 0?x:null,F=(b=f[C])!==null&&b!==void 0?b:null,A=(y=f[C+1])!==null&&y!==void 0?y:null,D={x:I},P={x:w},k={x:T};d.figures.forEach(function(O){var z=O.key,U=M==null?void 0:M[z];B(U)&&(D[z]=u.convertToPixel(U));var Z=F==null?void 0:F[z];B(Z)&&(P[z]=u.convertToPixel(Z));var et=A==null?void 0:A[z];B(et)&&(k[z]=u.convertToPixel(et))}),Fe(d,C,v,function(O,z,U){var Z,et,J;if(S(F==null?void 0:F[O.key])){var ot=P[O.key],G=(Z=O.attrs)===null||Z===void 0?void 0:Z.call(O,{data:{prev:M,current:F,next:A},coordinate:{prev:D,current:P,next:k},bounding:s,barSpace:_,xAxis:l,yAxis:u});if(!S(G))switch(O.type){case"circle":{G={x:w,y:ot,r:Math.max(1,E)};break}case"rect":case"bar":{var K=(et=O.baseValue)!==null&&et!==void 0?et:u.getRange().from,gt=u.convertToPixel(K),nt=Math.abs(gt-ot);K!==(F==null?void 0:F[O.key])&&(nt=Math.max(1,nt));var tt=0;ot>gt?tt=gt:tt=ot,G={x:w-E,y:tt,width:Math.max(1,E*2),height:nt};break}case"line":{S(p[U])||(p[U]=[]),B(P[O.key])&&B(k[O.key])&&p[U].push({coordinates:[{x:P.x,y:P[O.key]},{x:k.x,y:k[O.key]}],styles:z});break}}var j=O.type;S(G)&&j!=="line"&&((J=i.createFigure({name:j==="bar"?"rect":j,attrs:G,styles:z}))===null||J===void 0||J.draw(t))}})}),p.forEach(function(m){var _,x,b,y;if(m.length>1){for(var E=[{coordinates:[m[0].coordinates[0],m[0].coordinates[1]],styles:m[0].styles}],C=1;C<m.length;C++){var w=E[E.length-1],I=m[C],T=w.coordinates[w.coordinates.length-1];T.x===I.coordinates[0].x&&T.y===I.coordinates[0].y&&w.styles.style===I.styles.style&&w.styles.color===I.styles.color&&w.styles.size===I.styles.size&&w.styles.smooth===I.styles.smooth&&((_=w.styles.dashedValue)===null||_===void 0?void 0:_[0])===((x=I.styles.dashedValue)===null||x===void 0?void 0:x[0])&&((b=w.styles.dashedValue)===null||b===void 0?void 0:b[1])===((y=I.styles.dashedValue)===null||y===void 0?void 0:y[1])?w.coordinates.push(I.coordinates[1]):E.push({coordinates:[I.coordinates[0],I.coordinates[1]],styles:I.styles})}E.forEach(function(M){var F,A=M.coordinates,D=M.styles;(F=i.createFigure({name:"line",attrs:{coordinates:A},styles:D}))===null||F===void 0||F.draw(t)})}})}}}),t.restore()},e}(Ir),Wa=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var i=this.getWidget(),a=i.getPane(),n=i.getBounding(),o=i.getPane().getChart().getChartStore(),s=o.getCrosshair(),l=o.getStyles().crosshair;if(Y(s.paneId)&&l.show){if(s.paneId===a.getId()){var u=s.y;this._drawLine(t,[{x:0,y:u},{x:n.width,y:u}],l.horizontal)}var h=s.realX;this._drawLine(t,[{x:h,y:0},{x:h,y:n.height}],l.vertical)}},e.prototype._drawLine=function(t,i,a){var n;if(a.show){var o=a.line;o.show&&((n=this.createFigure({name:"line",attrs:{coordinates:i},styles:o}))===null||n===void 0||n.draw(t))}},e}(xt),Tr=function(r){V(e,r);function e(){var t=r.apply(this,ae([],It(arguments),!1))||this;return t._boundFeatureClickEvent=function(i){return function(){var a,n=t.getWidget().getPane(),o=i.indicator,s=re(i,["indicator"]);return S(o)?(a=o.onClick)===null||a===void 0||a.call(o,R({target:Me.Feature,chart:n.getChart(),indicator:o},s)):n.getChart().getChartStore().executeAction(_t.OnCandleTooltipFeatureClick,i),!0}},t._boundFeatureMouseMoveEvent=function(i){return function(){return t.getWidget().getPane().getChart().getChartStore().setActiveTooltipFeatureInfo(i),!0}},t}return e.prototype.drawImp=function(t){var i=this.getWidget(),a=i.getPane(),n=a.getChart().getChartStore(),o=n.getCrosshair();if(S(o.kLineData)){var s=i.getBounding(),l=n.getStyles().indicator.tooltip,u=l.offsetLeft,h=l.offsetTop,c=l.offsetRight;this.drawIndicatorTooltip(t,u,h,s.width-c)}},e.prototype.drawIndicatorTooltip=function(t,i,a,n){var o=this,s=this.getWidget().getPane(),l=s.getChart().getChartStore(),u=l.getStyles().indicator,h=u.tooltip;if(this.isDrawTooltip(l.getCrosshair(),h)){var c=l.getIndicatorsByPaneId(s.getId()),v=h.text;c.forEach(function(d){var g=0,f={x:i,y:a},p=o.getIndicatorTooltipData(d),m=p.name,_=p.calcParamsText,x=p.legends,b=p.features,y=m.length>0,E=x.length>0;if(y||E){var C=It(o.classifyTooltipFeatures(b),3),w=C[0],I=C[1],T=C[2];if(g=o.drawStandardTooltipFeatures(t,w,f,d,i,g,n),y){var M=m;_.length>0&&(M="".concat(M).concat(_)),g=o.drawStandardTooltipLegends(t,[{title:{text:"",color:v.color},value:{text:M,color:v.color}}],f,i,g,n,v)}g=o.drawStandardTooltipFeatures(t,I,f,d,i,g,n),E&&(g=o.drawStandardTooltipLegends(t,x,f,i,g,n,h.text)),g=o.drawStandardTooltipFeatures(t,T,f,d,i,g,n),a=f.y+g}})}return a},e.prototype.drawStandardTooltipFeatures=function(t,i,a,n,o,s,l){var u=this;if(i.length>0){var h=0,c=0;i.forEach(function(f){var p=f.marginLeft,m=p===void 0?0:p,_=f.marginTop,x=_===void 0?0:_,b=f.marginRight,y=b===void 0?0:b,E=f.marginBottom,C=E===void 0?0:E,w=f.paddingLeft,I=w===void 0?0:w,T=f.paddingTop,M=T===void 0?0:T,F=f.paddingRight,A=F===void 0?0:F,D=f.paddingBottom,P=D===void 0?0:D,k=f.size,O=k===void 0?0:k,z=f.type,U=f.iconFont,Z=0;z===ge.IconFont?(t.font=zt(O,"normal",U.family),Z=t.measureText(U.content).width):Z=O,h+=m+I+Z+A+y,c=Math.max(c,x+M+O+P+C)}),a.x+h>l?(a.x=o,a.y+=s,s=c):s=Math.max(s,c);var v=this.getWidget().getPane(),d=v.getId(),g=v.getChart().getChartStore().getActiveTooltipFeatureInfo();i.forEach(function(f){var p,m,_,x,b=f.marginLeft,y=b===void 0?0:b,E=f.marginTop,C=E===void 0?0:E,w=f.marginRight,I=w===void 0?0:w,T=f.paddingLeft,M=T===void 0?0:T,F=f.paddingTop,A=F===void 0?0:F,D=f.paddingRight,P=D===void 0?0:D,k=f.paddingBottom,O=k===void 0?0:k,z=f.backgroundColor,U=f.activeBackgroundColor,Z=f.borderRadius,et=f.size,J=et===void 0?0:et,ot=f.color,G=f.activeColor,K=f.type,gt=f.iconFont,nt=f.path,tt=(g==null?void 0:g.paneId)===d&&((p=g.indicator)===null||p===void 0?void 0:p.id)===(n==null?void 0:n.id)&&g.feature.id===f.id,j=0,rt={mouseClickEvent:u._boundFeatureClickEvent({paneId:d,indicator:n,feature:f}),mouseMoveEvent:u._boundFeatureMouseMoveEvent({paneId:d,indicator:n,feature:f})},ct=tt?G??ot:ot,Vt=tt?U??z:z;K===ge.IconFont?((m=u.createFigure({name:"text",attrs:{text:gt.content,x:a.x+y,y:a.y+C},styles:{paddingLeft:M,paddingTop:A,paddingRight:P,paddingBottom:O,borderRadius:Z,size:J,family:gt.family,color:ct,backgroundColor:Vt}},rt))===null||m===void 0||m.draw(t),j=t.measureText(gt.content).width):((_=u.createFigure({name:"rect",attrs:{x:a.x+y,y:a.y+C,width:J,height:J},styles:{paddingLeft:M,paddingTop:A,paddingRight:P,paddingBottom:O,color:Vt}},rt))===null||_===void 0||_.draw(t),(x=u.createFigure({name:"path",attrs:{path:nt.path,x:a.x+y+M,y:a.y+C+A,width:J,height:J},styles:{style:nt.style,lineWidth:nt.lineWidth,color:ct}}))===null||x===void 0||x.draw(t),j=J),a.x+=y+M+j+P+I})}return s},e.prototype.drawStandardTooltipLegends=function(t,i,a,n,o,s,l){var u=this;if(i.length>0){var h=l.marginLeft,c=l.marginTop,v=l.marginRight,d=l.marginBottom,g=l.size,f=l.family,p=l.weight;t.font=zt(g,p,f),i.forEach(function(m){var _,x,b=m.title,y=m.value,E=t.measureText(b.text).width,C=t.measureText(y.text).width,w=E+C,I=c+g+d;a.x+h+w+v>s?(a.x=n,a.y+=o,o=I):o=Math.max(o,I),b.text.length>0&&((_=u.createFigure({name:"text",attrs:{x:a.x+h,y:a.y+c,text:b.text},styles:{color:b.color,size:g,family:f,weight:p}}))===null||_===void 0||_.draw(t)),(x=u.createFigure({name:"text",attrs:{x:a.x+h+E,y:a.y+c,text:y.text},styles:{color:y.color,size:g,family:f,weight:p}}))===null||x===void 0||x.draw(t),a.x+=h+w+v})}return o},e.prototype.isDrawTooltip=function(t,i){var a=i.showRule;return a===qt.Always||a===qt.FollowCross&&Y(t.paneId)},e.prototype.getIndicatorTooltipData=function(t){var i,a,n=this.getWidget().getPane().getChart().getChartStore(),o=n.getStyles().indicator,s=o.tooltip,l=s.showName?t.shortName:"",u="";if(s.showParams){var h=t.calcParams;h.length>0&&(u="(".concat(h.join(","),")"))}var c={name:l,calcParamsText:u,legends:[],features:s.features},v=n.getCrosshair().dataIndex,d=t.result,g=n.getCustomApi(),f=n.getDecimalFold(),p=n.getThousandsSeparator(),m=[];if(t.visible){var _=(a=(i=d[v])!==null&&i!==void 0?i:d[v-1])!==null&&a!==void 0?a:{};Fe(t,v,o,function(A,D){if(Y(A.title)){var P=D.color,k=_[A.key];B(k)&&(k=it(k,t.precision),t.shouldFormatBigNumber&&(k=g.formatBigNumber(k)),k=f.format(p.format(k))),m.push({title:{text:A.title,color:P},value:{text:k??s.defaultValue,color:P}})}}),c.legends=m}if(at(t.createTooltipDataSource)){var x=this.getWidget(),b=x.getPane(),y=b.getChart(),E=t.createTooltipDataSource({chart:y,indicator:t,crosshair:n.getCrosshair(),bounding:x.getBounding(),xAxis:b.getChart().getXAxisPane().getAxisComponent(),yAxis:b.getAxisComponent()}),C=E.name,w=E.calcParamsText,I=E.legends,T=E.features;if(Y(C)&&s.showName&&(c.name=C),Y(w)&&s.showParams&&(c.calcParamsText=w),S(T)&&(c.features=T),S(I)&&t.visible){var M=[],F=o.tooltip.text.color;I.forEach(function(A){var D={text:"",color:F};Et(A.title)?D=A.title:D.text=A.title;var P={text:"",color:F};Et(A.value)?P=A.value:P.text=A.value,B(Number(P.text))&&(P.text=f.format(p.format(P.text))),M.push({title:D,value:P})}),c.legends=M}}return c},e.prototype.classifyTooltipFeatures=function(t){var i=[],a=[],n=[];return t.forEach(function(o){switch(o.position){case Kt.Left:{i.push(o);break}case Kt.Middle:{a.push(o);break}case Kt.Right:{n.push(o);break}}}),[i,a,n]},e}(xt),Pr=function(r){V(e,r);function e(t){var i=r.call(this,t)||this;return i._initEvent(),i}return e.prototype._initEvent=function(){var t=this,i=this.getWidget().getPane(),a=i.getId(),n=i.getChart(),o=n.getChartStore();this.registerEvent("mouseMoveEvent",function(s){var l,u=o.getProgressOverlayInfo();if(u!==null){var h=u.overlay,c=u.paneId;h.isStart()&&(o.updateProgressOverlayInfo(a),c=a);var v=h.points.length-1;return h.isDrawing()&&c===a&&(h.eventMoveForDrawing(t._coordinateToPoint(h,s)),(l=h.onDrawing)===null||l===void 0||l.call(h,R({chart:n,overlay:h},s))),t._figureMouseMoveEvent(h,1,v,{key:"".concat(Yt,"point_").concat(v),type:"circle",attrs:{}})(s)}return o.setHoverOverlayInfo({paneId:a,overlay:null,figureType:0,figureIndex:-1,figure:null},s),!1}).registerEvent("mouseClickEvent",function(s){var l,u,h=o.getProgressOverlayInfo();if(h!==null){var c=h.overlay,v=h.paneId;c.isStart()&&(o.updateProgressOverlayInfo(a,!0),v=a);var d=c.points.length-1;return c.isDrawing()&&v===a&&(c.eventMoveForDrawing(t._coordinateToPoint(c,s)),(l=c.onDrawing)===null||l===void 0||l.call(c,R({chart:n,overlay:c},s)),c.nextStep(),c.isDrawing()||(o.progressOverlayComplete(),(u=c.onDrawEnd)===null||u===void 0||u.call(c,R({chart:n,overlay:c},s)))),t._figureMouseClickEvent(c,1,d,{key:"".concat(Yt,"point_").concat(d),type:"circle",attrs:{}})(s)}return o.setClickOverlayInfo({paneId:a,overlay:null,figureType:0,figureIndex:-1,figure:null},s),!1}).registerEvent("mouseDoubleClickEvent",function(s){var l,u=o.getProgressOverlayInfo();if(u!==null){var h=u.overlay,c=u.paneId;h.isDrawing()&&c===a&&(h.forceComplete(),h.isDrawing()||(o.progressOverlayComplete(),(l=h.onDrawEnd)===null||l===void 0||l.call(h,R({chart:n,overlay:h},s))));var v=h.points.length-1;return t._figureMouseClickEvent(h,1,v,{key:"".concat(Yt,"point_").concat(v),type:"circle",attrs:{}})(s)}return!1}).registerEvent("mouseRightClickEvent",function(s){var l=o.getProgressOverlayInfo();if(l!==null){var u=l.overlay;if(u.isDrawing()){var h=u.points.length-1;return t._figureMouseRightClickEvent(u,1,h,{key:"".concat(Yt,"point_").concat(h),type:"circle",attrs:{}})(s)}}return!1}).registerEvent("mouseUpEvent",function(s){var l,u=o.getPressedOverlayInfo(),h=u.overlay,c=u.figure;return h!==null&&dt("onPressedMoveEnd",c)&&((l=h.onPressedMoveEnd)===null||l===void 0||l.call(h,R({chart:n,overlay:h,figure:c??void 0},s))),o.setPressedOverlayInfo({paneId:a,overlay:null,figureType:0,figureIndex:-1,figure:null}),!1}).registerEvent("pressedMouseMoveEvent",function(s){var l,u,h=o.getPressedOverlayInfo(),c=h.overlay,v=h.figureType,d=h.figureIndex,g=h.figure;if(c!==null&&dt("onPressedMoving",g)){if(!c.lock&&!((u=(l=c.onPressedMoving)===null||l===void 0?void 0:l.call(c,R({chart:n,overlay:c,figure:g??void 0},s)))!==null&&u!==void 0&&u)){var f=t._coordinateToPoint(c,s);v===1?c.eventPressedPointMove(f,d):c.eventPressedOtherMove(f,t.getWidget().getPane().getChart().getChartStore())}return!0}return!1})},e.prototype._createFigureEvents=function(t,i,a,n){return t.isDrawing()?null:{mouseMoveEvent:this._figureMouseMoveEvent(t,i,a,n),mouseDownEvent:this._figureMouseDownEvent(t,i,a,n),mouseClickEvent:this._figureMouseClickEvent(t,i,a,n),mouseRightClickEvent:this._figureMouseRightClickEvent(t,i,a,n),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,i,a,n)}},e.prototype._figureMouseMoveEvent=function(t,i,a,n){var o=this;return function(s){var l=o.getWidget().getPane();return l.getChart().getChartStore().setHoverOverlayInfo({paneId:l.getId(),overlay:t,figureType:i,figure:n,figureIndex:a},s),dt("onMouseEnter",n)&&!t.isDrawing()}},e.prototype._figureMouseDownEvent=function(t,i,a,n){var o=this;return function(s){var l,u=o.getWidget().getPane(),h=u.getId();return t.startPressedMove(o._coordinateToPoint(t,s)),dt("onPressedMoveStart",n)?((l=t.onPressedMoveStart)===null||l===void 0||l.call(t,R({chart:u.getChart(),overlay:t,figure:n},s)),u.getChart().getChartStore().setPressedOverlayInfo({paneId:h,overlay:t,figureType:i,figureIndex:a,figure:n}),!t.isDrawing()):!1}},e.prototype._figureMouseClickEvent=function(t,i,a,n){var o=this;return function(s){var l=o.getWidget().getPane(),u=l.getId();return l.getChart().getChartStore().setClickOverlayInfo({paneId:u,overlay:t,figureType:i,figureIndex:a,figure:n},s),dt("onClick",n)&&!t.isDrawing()}},e.prototype._figureMouseDoubleClickEvent=function(t,i,a,n){var o=this;return function(s){var l;return dt("onDoubleClick",n)?((l=t.onDoubleClick)===null||l===void 0||l.call(t,R(R({},s),{chart:o.getWidget().getPane().getChart(),figure:n,overlay:t})),!t.isDrawing()):!1}},e.prototype._figureMouseRightClickEvent=function(t,i,a,n){var o=this;return function(s){var l,u;return dt("onRightClick",n)?((u=(l=t.onRightClick)===null||l===void 0?void 0:l.call(t,R({chart:o.getWidget().getPane().getChart(),overlay:t,figure:n},s)))!==null&&u!==void 0&&u||o.getWidget().getPane().getChart().getChartStore().removeOverlay(t),!t.isDrawing()):!1}},e.prototype._coordinateToPoint=function(t,i){var a,n={},o=this.getWidget().getPane(),s=o.getChart(),l=o.getId(),u=s.getChartStore();if(this.coordinateToPointTimestampDataIndexFlag()){var h=s.getXAxisPane().getAxisComponent(),c=h.convertFromPixel(i.x),v=(a=u.dataIndexToTimestamp(c))!==null&&a!==void 0?a:void 0;n.timestamp=v,n.dataIndex=c}if(this.coordinateToPointValueFlag()){var d=o.getAxisComponent(),g=d.convertFromPixel(i.y);if(t.mode!==Gt.Normal&&l===N.CANDLE&&B(n.dataIndex)){var f=u.getDataByDataIndex(n.dataIndex);if(f!==null){var p=t.modeSensitivity;if(g>f.high)if(t.mode===Gt.WeakMagnet){var m=d.convertToPixel(f.high),_=d.convertFromPixel(m-p);g<_&&(g=f.high)}else g=f.high;else if(g<f.low)if(t.mode===Gt.WeakMagnet){var x=d.convertToPixel(f.low),_=d.convertFromPixel(x-p);g>_&&(g=f.low)}else g=f.low;else{var b=Math.max(f.open,f.close),y=Math.min(f.open,f.close);g>b?g-b<f.high-g?g=b:g=f.high:g<y?g-f.low<y-g?g=f.low:g=y:b-g<g-y?g=b:g=y}}}n.value=g}return n},e.prototype.coordinateToPointValueFlag=function(){return!0},e.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!0},e.prototype.dispatchEvent=function(t,i,a){return this.getWidget().getPane().getChart().getChartStore().isOverlayDrawing()?this.onEvent(t,i,a):r.prototype.dispatchEvent.call(this,t,i,a)},e.prototype.checkEventOn=function(){return!0},e.prototype.drawImp=function(t){var i=this,a=this.getCompleteOverlays();a.forEach(function(o){o.visible&&i._drawOverlay(t,o)});var n=this.getProgressOverlay();S(n)&&n.visible&&this._drawOverlay(t,n)},e.prototype._drawOverlay=function(t,i){var a=i.points,n=this.getWidget().getPane(),o=n.getChart(),s=o.getChartStore(),l=n.getAxisComponent(),u=o.getXAxisPane().getAxisComponent(),h=a.map(function(v){var d,g=null;B(v.timestamp)&&(g=s.timestampToDataIndex(v.timestamp));var f={x:0,y:0};return B(g)&&(f.x=u.convertToPixel(g)),B(v.value)&&(f.y=(d=l==null?void 0:l.convertToPixel(v.value))!==null&&d!==void 0?d:0),f});if(h.length>0){var c=[].concat(this.getFigures(i,h));this.drawFigures(t,i,c)}this.drawDefaultFigures(t,i,h)},e.prototype.drawFigures=function(t,i,a){var n=this,o=this.getWidget().getPane().getChart().getStyles().overlay;a.forEach(function(s,l){var u=s.type,h=s.styles,c=s.attrs,v=[].concat(c);v.forEach(function(d){var g,f,p=n._createFigureEvents(i,2,l,s),m=R(R(R({},o[u]),(g=i.styles)===null||g===void 0?void 0:g[u]),h);(f=n.createFigure({name:u,attrs:d,styles:m},p??void 0))===null||f===void 0||f.draw(t)})})},e.prototype.getCompleteOverlays=function(){var t=this.getWidget().getPane();return t.getChart().getChartStore().getOverlaysByPaneId(t.getId())},e.prototype.getProgressOverlay=function(){var t=this.getWidget().getPane(),i=t.getChart().getChartStore().getProgressOverlayInfo();return S(i)&&i.paneId===t.getId()?i.overlay:null},e.prototype.getFigures=function(t,i){var a,n,o=this.getWidget(),s=o.getPane(),l=s.getChart(),u=s.getAxisComponent(),h=l.getXAxisPane().getAxisComponent(),c=o.getBounding();return(n=(a=t.createPointFigures)===null||a===void 0?void 0:a.call(t,{chart:l,overlay:t,coordinates:i,bounding:c,xAxis:h,yAxis:u}))!==null&&n!==void 0?n:[]},e.prototype.drawDefaultFigures=function(t,i,a){var n=this,o,s;if(i.needDefaultPointFigure){var l=this.getWidget().getPane().getChart().getChartStore(),u=l.getHoverOverlayInfo(),h=l.getClickOverlayInfo();if(((o=u.overlay)===null||o===void 0?void 0:o.id)===i.id&&u.figureType!==0||((s=h.overlay)===null||s===void 0?void 0:s.id)===i.id&&h.figureType!==0){var c=l.getStyles().overlay,v=i.styles,d=R(R({},c.point),v==null?void 0:v.point);a.forEach(function(g,f){var p,m,_,x,b,y=g.x,E=g.y,C=d.radius,w=d.color,I=d.borderColor,T=d.borderSize;((p=u.overlay)===null||p===void 0?void 0:p.id)===i.id&&u.figureType===1&&((m=u.figure)===null||m===void 0?void 0:m.key)==="".concat(Yt,"point_").concat(f)&&(C=d.activeRadius,w=d.activeColor,I=d.activeBorderColor,T=d.activeBorderSize),(x=n.createFigure({name:"circle",attrs:{x:y,y:E,r:C+T},styles:{color:I}},(_=n._createFigureEvents(i,1,f,{key:"".concat(Yt,"point_").concat(f),type:"circle",attrs:{x:y,y:E,r:C+T},styles:{color:I}}))!==null&&_!==void 0?_:void 0))===null||x===void 0||x.draw(t),(b=n.createFigure({name:"circle",attrs:{x:y,y:E,r:C},styles:{color:w}}))===null||b===void 0||b.draw(t)})}}},e}(xt),Mr=function(r){V(e,r);function e(t,i){var a=r.call(this,t,i)||this;return a._gridView=new Va(a),a._indicatorView=new Na(a),a._crosshairLineView=new Wa(a),a._tooltipView=a.createTooltipView(),a._overlayView=new Pr(a),a.addChild(a._tooltipView),a.addChild(a._overlayView),a.getContainer().style.cursor="crosshair",a}return e.prototype.getName=function(){return W.MAIN},e.prototype.updateMain=function(t){this.getPane().getOptions().state!=="minimize"&&(this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t))},e.prototype.createTooltipView=function(){return new Tr(this)},e.prototype.updateMainContent=function(t){},e.prototype.updateOverlay=function(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayView.draw(t),this._crosshairLineView.draw(t)),this._tooltipView.draw(t)},e}(Le),za=function(r){V(e,r);function e(){var t=r.apply(this,ae([],It(arguments),!1))||this;return t._ripplePoint=t.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}),t._animationFrameTime=0,t._animation=new Ae({iterationCount:1/0}).doFrame(function(i){t._animationFrameTime=i;var a=t.getWidget().getPane();a.getChart().updatePane(0,a.getId())}),t}return e.prototype.drawImp=function(t){var i,a,n,o=this.getWidget(),s=o.getPane(),l=s.getChart(),u=l.getDataList(),h=u.length-1,c=o.getBounding(),v=s.getAxisComponent(),d=l.getStyles().candle.area,g=[],f=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,m=null;if(this.eachChildren(function(C){var w=C.x,I=C.data.current,T=I==null?void 0:I[d.value];if(B(T)){var M=v.convertToPixel(T);p===Number.MIN_SAFE_INTEGER&&(p=w),g.push({x:w,y:M}),f=Math.min(f,M),C.dataIndex===h&&(m={x:w,y:M})}}),g.length>0){(i=this.createFigure({name:"line",attrs:{coordinates:g},styles:{color:d.lineColor,size:d.lineSize,smooth:d.smooth}}))===null||i===void 0||i.draw(t);var _=d.backgroundColor,x="";if(At(_)){var b=t.createLinearGradient(0,c.height,0,f);try{_.forEach(function(C){var w=C.offset,I=C.color;b.addColorStop(w,I)})}catch{}x=b}else x=_;t.fillStyle=x,t.beginPath(),t.moveTo(p,c.height),t.lineTo(g[0].x,g[0].y),pr(t,g,d.smooth),t.lineTo(g[g.length-1].x,c.height),t.closePath(),t.fill()}var y=d.point;if(y.show&&S(m)){(a=this.createFigure({name:"circle",attrs:{x:m.x,y:m.y,r:y.radius},styles:{style:"fill",color:y.color}}))===null||a===void 0||a.draw(t);var E=y.rippleRadius;y.animation&&(E=y.radius+this._animationFrameTime/y.animationDuration*(y.rippleRadius-y.radius),this._animation.setDuration(y.animationDuration).start()),(n=this._ripplePoint)===null||n===void 0||n.setAttrs({x:m.x,y:m.y,r:E}).setStyles({style:"fill",color:y.rippleColor}).draw(t)}else this.stopAnimation()},e.prototype.stopAnimation=function(){this._animation.stop()},e}(Er),Xa=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var i=this.getWidget(),a=i.getPane(),n=a.getChart().getChartStore(),o=n.getStyles().candle.priceMark,s=o.high,l=o.low;if(o.show&&(s.show||l.show)){var u=n.getVisibleRangeHighLowPrice(),h=n.getPrecision(),c=a.getAxisComponent(),v=u[0],d=v.price,g=v.x,f=u[1],p=f.price,m=f.x,_=c.convertToPixel(d),x=c.convertToPixel(p),b=n.getDecimalFold(),y=n.getThousandsSeparator();s.show&&d!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,b.format(y.format(it(d,h.price))),{x:g,y:_},_<x?[-2,-5]:[2,5],s),l.show&&p!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,b.format(y.format(it(p,h.price))),{x:m,y:x},_<x?[2,5]:[-2,-5],l)}},e.prototype._drawMark=function(t,i,a,n,o){var s,l,u,h=a.x,c=a.y+n[0];(s=this.createFigure({name:"line",attrs:{coordinates:[{x:h-2,y:c+n[0]},{x:h,y:c},{x:h+2,y:c+n[0]}]},styles:{color:o.color}}))===null||s===void 0||s.draw(t);var v=0,d=0,g="left",f=this.getWidget().getBounding().width;h>f/2?(v=h-5,d=v-o.textOffset,g="right"):(v=h+5,g="left",d=v+o.textOffset);var p=c+n[1];(l=this.createFigure({name:"line",attrs:{coordinates:[{x:h,y:c},{x:h,y:p},{x:v,y:p}]},styles:{color:o.color}}))===null||l===void 0||l.draw(t),(u=this.createFigure({name:"text",attrs:{x:d,y:p,text:i,align:g,baseline:"middle"},styles:{color:o.color,size:o.textSize,family:o.textFamily,weight:o.textWeight}}))===null||u===void 0||u.draw(t)},e}(xt),Ya=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var i,a,n,o=this.getWidget(),s=o.getPane(),l=o.getBounding(),u=s.getChart().getChartStore(),h=u.getStyles().candle.priceMark,c=h.last,v=c.line;if(h.show&&c.show&&v.show){var d=s.getAxisComponent(),g=u.getDataList(),f=g[g.length-1];if(S(f)){var p=f.close,m=f.open,_=c.compareRule===Lt.CurrentOpen?m:(a=(i=g[g.length-2])===null||i===void 0?void 0:i.close)!==null&&a!==void 0?a:p,x=d.convertToNicePixel(p),b="";p>_?b=c.upColor:p<_?b=c.downColor:b=c.noChangeColor,(n=this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:x},{x:l.width,y:x}]},styles:{style:v.style,color:b,size:v.size,dashedValue:v.dashedValue}}))===null||n===void 0||n.draw(t)}}},e}(xt),kt;(function(r){r.Left="left",r.Right="right"})(kt||(kt={}));function rr(){return{from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0,displayFrom:0,displayTo:0,displayRange:0}}var Ar=function(){function r(e){this.scrollZoomEnabled=!0,this._range=rr(),this._prevRange=rr(),this._ticks=[],this._autoCalcTickFlag=!0,this._parent=e}return r.prototype.getParent=function(){return this._parent},r.prototype.buildTicks=function(e){return this._autoCalcTickFlag&&(this._range=this.createRangeImp()),this._prevRange.from!==this._range.from||this._prevRange.to!==this._range.to||e?(this._prevRange=this._range,this._ticks=this.createTicksImp(),!0):!1},r.prototype.getTicks=function(){return this._ticks},r.prototype.setRange=function(e){this._autoCalcTickFlag=!1,this._range=e},r.prototype.getRange=function(){return this._range},r.prototype.setAutoCalcTickFlag=function(e){this._autoCalcTickFlag=e},r.prototype.getAutoCalcTickFlag=function(){return this._autoCalcTickFlag},r}(),Ha={time:"æ—¶é—´ï¼š",open:"å¼€ï¼š",high:"é«˜ï¼š",low:"ä½Žï¼š",close:"æ”¶ï¼š",volume:"æˆäº¤é‡ï¼š",turnover:"æˆäº¤é¢ï¼š",change:"æ¶¨å¹…ï¼š"},Ga={time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: "},Ua={"zh-CN":Ha,"en-US":Ga};function Za(r,e){var t;return(t=Ua[e][r])!==null&&t!==void 0?t:r}var qa=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var i=this.getWidget(),a=i.getPane().getChart().getChartStore(),n=a.getCrosshair();if(S(n.kLineData)){var o=i.getBounding(),s=a.getStyles(),l=s.candle,u=s.indicator;if(l.tooltip.showType===St.Rect&&u.tooltip.showType===St.Rect){var h=this.isDrawTooltip(n,l.tooltip),c=this.isDrawTooltip(n,u.tooltip);this._drawRectTooltip(t,h,c,l.tooltip.offsetTop)}else if(l.tooltip.showType===St.Standard&&u.tooltip.showType===St.Standard){var v=l.tooltip,d=v.offsetLeft,g=v.offsetTop,f=v.offsetRight,p=o.width-f,m=this._drawCandleStandardTooltip(t,d,g,p);this.drawIndicatorTooltip(t,d,m,p)}else if(l.tooltip.showType===St.Rect&&u.tooltip.showType===St.Standard){var _=l.tooltip,d=_.offsetLeft,g=_.offsetTop,f=_.offsetRight,p=o.width-f,x=this.drawIndicatorTooltip(t,d,g,p),h=this.isDrawTooltip(n,l.tooltip);this._drawRectTooltip(t,h,!1,x)}else{var b=l.tooltip,d=b.offsetLeft,g=b.offsetTop,f=b.offsetRight,p=o.width-f,y=this._drawCandleStandardTooltip(t,d,g,p),c=this.isDrawTooltip(n,u.tooltip);this._drawRectTooltip(t,!1,c,y)}}},e.prototype._drawCandleStandardTooltip=function(t,i,a,n){var o=this.getWidget().getPane().getChart().getChartStore(),s=o.getStyles().candle,l=s.tooltip,u=l.text,h=0,c={x:i,y:a},v=o.getCrosshair();if(this.isDrawTooltip(v,l)){var d=this._getCandleTooltipLegends(),g=It(this.classifyTooltipFeatures(l.features),3),f=g[0],p=g[1],m=g[2];h=this.drawStandardTooltipFeatures(t,f,c,null,i,h,n),h=this.drawStandardTooltipFeatures(t,p,c,null,i,h,n),d.length>0&&(h=this.drawStandardTooltipLegends(t,d,c,i,h,n,u)),h=this.drawStandardTooltipFeatures(t,m,c,null,i,h,n)}return c.y+h},e.prototype._drawRectTooltip=function(t,i,a,n){var o=this,s,l,u=this.getWidget(),h=u.getPane(),c=h.getChart().getChartStore(),v=c.getStyles(),d=v.candle,g=v.indicator,f=d.tooltip,p=g.tooltip;if(i||a){var m=this._getCandleTooltipLegends(),_=f.offsetLeft,x=f.offsetTop,b=f.offsetRight,y=f.offsetBottom,E=f.text,C=E.marginLeft,w=E.marginRight,I=E.marginTop,T=E.marginBottom,M=E.size,F=E.weight,A=E.family,D=f.rect,P=D.position,k=D.paddingLeft,O=D.paddingRight,z=D.paddingTop,U=D.paddingBottom,Z=D.offsetLeft,et=D.offsetRight,J=D.offsetTop,ot=D.offsetBottom,G=D.borderSize,K=D.borderRadius,gt=D.borderColor,nt=D.color,tt=0,j=0,rt=0;i&&(t.font=zt(M,F,A),m.forEach(function(Tt){var mt=Tt.title,vt=Tt.value,bt="".concat(mt.text).concat(vt.text),Pt=t.measureText(bt).width+C+w;tt=Math.max(tt,Pt)}),rt+=(T+I+M)*m.length);var ct=p.text,Vt=ct.marginLeft,ne=ct.marginRight,oe=ct.marginTop,Xt=ct.marginBottom,jt=ct.size,we=ct.weight,Se=ct.family,Ve=[];if(a){var Vr=c.getIndicatorsByPaneId(h.getId());t.font=zt(jt,we,Se),Vr.forEach(function(Tt){var mt=o.getIndicatorTooltipData(Tt).legends;Ve.push(mt),mt.forEach(function(vt){var bt=vt.title,Pt=vt.value,he="".concat(bt.text).concat(Pt.text),Yr=t.measureText(he).width+Vt+ne;tt=Math.max(tt,Yr),rt+=oe+Xt+jt})})}if(j+=tt,j!==0&&rt!==0){var se=c.getCrosshair(),le=u.getBounding(),Ne=h.getYAxisWidget().getBounding();j+=G*2+k+O,rt+=G*2+z+U;var Nr=le.width/2,We=P===pe.Pointer&&se.paneId===N.CANDLE,ze=((s=se.realX)!==null&&s!==void 0?s:0)>Nr,pt=0;if(We){var Xe=se.realX;ze?pt=Xe-et-j:pt=Xe+Z}else{var ue=this.getWidget().getPane().getAxisComponent();ze?(pt=Z+_,ue.inside&&ue.position===kt.Left&&(pt+=Ne.width)):(pt=le.width-et-j-b,ue.inside&&ue.position===kt.Right&&(pt-=Ne.width))}var Nt=n+J;if(We){var Wr=se.y;Nt=Wr-rt/2,Nt+rt>le.height-ot-y&&(Nt=le.height-ot-rt-y),Nt<n+J&&(Nt=n+J+x)}(l=this.createFigure({name:"rect",attrs:{x:pt,y:Nt,width:j,height:rt},styles:{style:X.StrokeFill,color:nt,borderColor:gt,borderSize:G,borderRadius:K}}))===null||l===void 0||l.draw(t);var zr=pt+G+k+C,Rt=Nt+G+z;if(i&&m.forEach(function(Tt){var mt,vt;Rt+=I;var bt=Tt.title;(mt=o.createFigure({name:"text",attrs:{x:zr,y:Rt,text:bt.text},styles:{color:bt.color,size:M,family:A,weight:F}}))===null||mt===void 0||mt.draw(t);var Pt=Tt.value;(vt=o.createFigure({name:"text",attrs:{x:pt+j-G-w-O,y:Rt,text:Pt.text,align:"right"},styles:{color:Pt.color,size:M,family:A,weight:F}}))===null||vt===void 0||vt.draw(t),Rt+=M+T}),a){var Xr=pt+G+k+Vt;Ve.forEach(function(Tt){Tt.forEach(function(mt){var vt,bt;Rt+=oe;var Pt=mt.title,he=mt.value;(vt=o.createFigure({name:"text",attrs:{x:Xr,y:Rt,text:Pt.text},styles:{color:Pt.color,size:jt,family:Se,weight:we}}))===null||vt===void 0||vt.draw(t),(bt=o.createFigure({name:"text",attrs:{x:pt+j-G-ne-O,y:Rt,text:he.text,align:"right"},styles:{color:he.color,size:jt,family:Se,weight:we}}))===null||bt===void 0||bt.draw(t),Rt+=jt+Xt})})}}}},e.prototype._getCandleTooltipLegends=function(){var t,i,a,n,o,s,l=this.getWidget().getPane().getChart().getChartStore(),u=l.getStyles().candle,h=l.getDataList(),c=l.getCustomApi(),v=l.getDecimalFold(),d=l.getThousandsSeparator(),g=l.getLocale(),f=l.getPrecision(),p=f.price,m=f.volume,_=(t=l.getCrosshair().dataIndex)!==null&&t!==void 0?t:0,x=u.tooltip,b=x.text.color,y=(i=h[_-1])!==null&&i!==void 0?i:null,E=h[_],C=(a=y==null?void 0:y.close)!==null&&a!==void 0?a:E.close,w=E.close-C,I={"{time}":c.formatDate(E.timestamp,"YYYY-MM-DD HH:mm",yt.Tooltip),"{open}":v.format(d.format(it(E.open,p))),"{high}":v.format(d.format(it(E.high,p))),"{low}":v.format(d.format(it(E.low,p))),"{close}":v.format(d.format(it(E.close,p))),"{volume}":v.format(d.format(c.formatBigNumber(it((n=E.volume)!==null&&n!==void 0?n:x.defaultValue,m)))),"{turnover}":v.format(d.format(it((o=E.turnover)!==null&&o!==void 0?o:x.defaultValue,p))),"{change}":C===0?x.defaultValue:"".concat(d.format(it(w/C*100)),"%")},T=at(x.custom)?x.custom({prev:y,current:E,next:(s=h[_+1])!==null&&s!==void 0?s:null},u):x.custom;return T.map(function(M){var F,A=M.title,D=M.value,P={text:"",color:b};Et(A)?P=R({},A):P.text=A,P.text=Za(P.text,g);var k={text:x.defaultValue,color:b};Et(D)?k=R({},D):k.text=D;var O=/{(\S*)}/.exec(k.text);if(O!==null&&O.length>1){var z="{".concat(O[1],"}");k.text=k.text.replace(z,(F=I[z])!==null&&F!==void 0?F:x.defaultValue),z==="{change}"&&(k.color=w===0?u.priceMark.last.noChangeColor:w>0?u.priceMark.last.upColor:u.priceMark.last.downColor)}return{title:P,value:k}})},e}(Tr),ja=function(r){V(e,r);function e(t,i){var a=r.call(this,t,i)||this;return a._candleBarView=new Ir(a),a._candleAreaView=new za(a),a._candleHighLowPriceView=new Xa(a),a._candleLastPriceLineView=new Ya(a),a.addChild(a._candleBarView),a}return e.prototype.updateMainContent=function(t){var i=this.getPane().getChart().getStyles().candle;i.type!==ft.Area?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleAreaView.stopAnimation()):this._candleAreaView.draw(t),this._candleLastPriceLineView.draw(t)},e.prototype.createTooltipView=function(){return new qa(this)},e}(Mr),kr=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t,i){var a=this,n,o,s=this.getWidget(),l=s.getPane(),u=s.getBounding(),h=l.getAxisComponent(),c=this.getAxisStyles(l.getChart().getStyles());if(c.show&&(c.axisLine.show&&((n=this.createFigure({name:"line",attrs:this.createAxisLine(u,c),styles:c.axisLine}))===null||n===void 0||n.draw(t)),!i[0])){var v=h.getTicks();if(c.tickLine.show){var d=this.createTickLines(v,u,c);d.forEach(function(f){var p;(p=a.createFigure({name:"line",attrs:f,styles:c.tickLine}))===null||p===void 0||p.draw(t)})}if(c.tickText.show){var g=this.createTickTexts(v,u,c);(o=this.createFigure({name:"text",attrs:g,styles:c.tickText}))===null||o===void 0||o.draw(t)}}},e}(xt),$a=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getAxisStyles=function(t){return t.yAxis},e.prototype.createAxisLine=function(t,i){var a=this.getWidget().getPane().getAxisComponent(),n=i.axisLine.size,o=0;return a.isFromZero()?o=0:o=t.width-n,{coordinates:[{x:o,y:0},{x:o,y:t.height}]}},e.prototype.createTickLines=function(t,i,a){var n=this.getWidget().getPane().getAxisComponent(),o=a.axisLine,s=a.tickLine,l=0,u=0;return n.isFromZero()?(l=0,o.show&&(l+=o.size),u=l+s.length):(l=i.width,o.show&&(l-=o.size),u=l-s.length),t.map(function(h){return{coordinates:[{x:l,y:h.coord},{x:u,y:h.coord}]}})},e.prototype.createTickTexts=function(t,i,a){var n=this.getWidget().getPane().getAxisComponent(),o=a.axisLine,s=a.tickLine,l=a.tickText,u=0;n.isFromZero()?(u=l.marginStart,o.show&&(u+=o.size),s.show&&(u+=s.length)):(u=i.width-l.marginEnd,o.show&&(u-=o.size),s.show&&(u-=s.length));var h=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map(function(c){return{x:u,y:c.coord,text:c.text,align:h,baseline:"middle"}})},e}(kr),Qa=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var i,a,n,o=this.getWidget(),s=o.getPane(),l=o.getBounding(),u=s.getChart().getChartStore(),h=u.getStyles().candle.priceMark,c=h.last,v=c.text;if(h.show&&c.show&&v.show){var d=u.getPrecision(),g=s.getAxisComponent(),f=u.getDataList(),p=f[f.length-1];if(S(p)){var m=p.close,_=p.open,x=c.compareRule===Lt.CurrentOpen?_:(a=(i=f[f.length-2])===null||i===void 0?void 0:i.close)!==null&&a!==void 0?a:m,b=g.convertToNicePixel(m),y="";m>x?y=c.upColor:m<x?y=c.downColor:y=c.noChangeColor;var E=g.getRange(),C=g.displayValueToText(g.realValueToDisplayValue(g.valueToRealValue(m,{range:E}),{range:E}),d.price);C=u.getDecimalFold().format(u.getThousandsSeparator().format(C));var w=0,I="left";g.isFromZero()?(w=0,I="left"):(w=l.width,I="right"),(n=this.createFigure({name:"text",attrs:{x:w,y:b,text:C,align:I,baseline:"middle"},styles:R(R({},v),{backgroundColor:y})}))===null||n===void 0||n.draw(t)}}},e}(xt),Ja=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var i=this,a=this.getWidget(),n=a.getPane(),o=a.getBounding(),s=n.getChart().getChartStore(),l=s.getStyles().indicator,u=l.lastValueMark,h=u.text;if(u.show){var c=n.getAxisComponent(),v=c.getRange(),d=s.getDataList(),g=d.length-1,f=s.getIndicatorsByPaneId(n.getId()),p=s.getCustomApi(),m=s.getDecimalFold(),_=s.getThousandsSeparator();f.forEach(function(x){var b,y,E=x.result,C=(y=(b=E[g])!==null&&b!==void 0?b:E[g-1])!==null&&y!==void 0?y:{};if(S(C)&&x.visible){var w=x.precision;Fe(x,g,l,function(I,T){var M,F=C[I.key];if(B(F)){var A=c.convertToNicePixel(F),D=c.displayValueToText(c.realValueToDisplayValue(c.valueToRealValue(F,{range:v}),{range:v}),w);x.shouldFormatBigNumber&&(D=p.formatBigNumber(D)),D=m.format(_.format(D));var P=0,k="left";c.isFromZero()?(P=0,k="left"):(P=o.width,k="right"),(M=i.createFigure({name:"text",attrs:{x:P,y:A,text:D,align:k,baseline:"middle"},styles:R(R({},h),{backgroundColor:T.color})}))===null||M===void 0||M.draw(t)}})}})}},e}(xt),Dr=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!1},e.prototype.drawDefaultFigures=function(t,i,a){this.drawFigures(t,i,this.getDefaultFigures(i,a))},e.prototype.getDefaultFigures=function(t,i){var a,n=this.getWidget(),o=n.getPane(),s=o.getChart().getChartStore(),l=s.getClickOverlayInfo(),u=[];if(t.needDefaultYAxisFigure&&t.id===((a=l.overlay)===null||a===void 0?void 0:a.id)&&l.paneId===o.getId()){var h=o.getAxisComponent(),c=n.getBounding(),v=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER,g=h.isFromZero(),f="left",p=0;g?(f="left",p=0):(f="right",p=c.width);var m=s.getDecimalFold(),_=s.getThousandsSeparator();i.forEach(function(x,b){var y=t.points[b];if(B(y.value)){v=Math.min(v,x.y),d=Math.max(d,x.y);var E=m.format(_.format(it(y.value,s.getPrecision().price)));u.push({type:"text",attrs:{x:p,y:x.y,text:E,align:f,baseline:"middle"},ignoreEvent:!0})}}),i.length>1&&u.unshift({type:"rect",attrs:{x:0,y:v,width:c.width,height:d-v},ignoreEvent:!0})}return u},e.prototype.getFigures=function(t,i){var a,n,o=this.getWidget(),s=o.getPane(),l=s.getChart(),u=s.getAxisComponent(),h=l.getXAxisPane().getAxisComponent(),c=o.getBounding();return(n=(a=t.createYAxisFigures)===null||a===void 0?void 0:a.call(t,{chart:l,overlay:t,coordinates:i,bounding:c,xAxis:h,yAxis:u}))!==null&&n!==void 0?n:[]},e}(Pr),Rr=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.drawImp=function(t){var i,a=this.getWidget(),n=a.getPane(),o=a.getBounding(),s=a.getPane().getChart().getChartStore(),l=s.getCrosshair(),u=s.getStyles().crosshair;if(Y(l.paneId)&&this.compare(l,n.getId())&&u.show){var h=this.getDirectionStyles(u),c=h.text;if(h.show&&c.show){var v=n.getAxisComponent(),d=this.getText(l,s,v);t.font=zt(c.size,c.weight,c.family),(i=this.createFigure({name:"text",attrs:this.getTextAttrs(d,t.measureText(d).width,l,o,v,c),styles:c}))===null||i===void 0||i.draw(t)}}},e.prototype.compare=function(t,i){return t.paneId===i},e.prototype.getDirectionStyles=function(t){return t.horizontal},e.prototype.getText=function(t,i,a){var n=a,o=a.convertFromPixel(t.y),s=0,l=!1;if(n.isInCandle())s=i.getPrecision().price;else{var u=i.getIndicatorsByPaneId(t.paneId);u.forEach(function(v){s=Math.max(v.precision,s),l||(l=v.shouldFormatBigNumber)})}var h=n.getRange(),c=n.displayValueToText(n.realValueToDisplayValue(n.valueToRealValue(o,{range:h}),{range:h}),s);return l&&(c=i.getCustomApi().formatBigNumber(c)),i.getDecimalFold().format(i.getThousandsSeparator().format(c))},e.prototype.getTextAttrs=function(t,i,a,n,o,s){var l=o,u=0,h="left";return l.isFromZero()?(u=0,h="left"):(u=n.width,h="right"),{x:u,y:a.y,text:t,align:h,baseline:"middle"}},e}(xt),Ka=function(r){V(e,r);function e(t,i){var a=r.call(this,t,i)||this;return a._yAxisView=new $a(a),a._candleLastPriceLabelView=new Qa(a),a._indicatorLastValueView=new Ja(a),a._overlayYAxisView=new Dr(a),a._crosshairHorizontalLabelView=new Rr(a),a.getContainer().style.cursor="ns-resize",a.addChild(a._overlayYAxisView),a}return e.prototype.getName=function(){return W.Y_AXIS},e.prototype.updateMain=function(t){var i=this.getPane().getOptions().state==="minimize";this._yAxisView.draw(t,i),i||(this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t))},e.prototype.updateOverlay=function(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t))},e}(Le),ce=8,fe=function(r){V(e,r);function e(t,i){var a=r.call(this,t)||this;return a.reverse=!1,a.inside=!1,a.position=kt.Right,a.gap={top:.2,bottom:.1},a.createRange=function(n){return n.defaultRange},a.minSpan=function(n){return Wt(-n)},a.valueToRealValue=function(n){return n},a.realValueToDisplayValue=function(n){return n},a.displayValueToRealValue=function(n){return n},a.realValueToValue=function(n){return n},a.displayValueToText=function(n,o){return it(n,o)},a.override(i),a}return e.prototype.override=function(t){var i=t.name,a=t.gap,n=re(t,["name","gap"]);Y(this.name)||(this.name=i),q(this.gap,a),q(this,n)},e.prototype.createRangeImp=function(){var t=this.getParent(),i=t.getChart(),a=i.getChartStore(),n=t.getId(),o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,l=!1,u=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,v=a.getIndicatorsByPaneId(n);v.forEach(function(K){l||(l=K.shouldOhlc),c=Math.min(c,K.precision),B(K.minValue)&&(u=Math.min(u,K.minValue)),B(K.maxValue)&&(h=Math.max(h,K.maxValue))});var d=4,g=this.isInCandle();if(g){var f=a.getPrecision().price;c!==Number.MAX_SAFE_INTEGER?d=Math.min(c,f):d=f}else c!==Number.MAX_SAFE_INTEGER&&(d=c);var p=a.getVisibleRangeDataList(),m=i.getStyles().candle,_=m.type===ft.Area,x=m.area.value,b=g&&!_||!g&&l;p.forEach(function(K){var gt=K.dataIndex,nt=K.data.current;if(S(nt)&&(b&&(o=Math.min(o,nt.low),s=Math.max(s,nt.high)),g&&_)){var tt=nt[x];B(tt)&&(o=Math.min(o,tt),s=Math.max(s,tt))}v.forEach(function(j){var rt,ct=j.result,Vt=j.figures,ne=(rt=ct[gt])!==null&&rt!==void 0?rt:{};Vt.forEach(function(oe){var Xt=ne[oe.key];B(Xt)&&(o=Math.min(o,Xt),s=Math.max(s,Xt))})})}),o!==Number.MAX_SAFE_INTEGER&&s!==Number.MIN_SAFE_INTEGER?(o=Math.min(u,o),s=Math.max(h,s)):(o=0,s=10);var y=s-o,E={from:o,to:s,range:y,realFrom:o,realTo:s,realRange:y,displayFrom:o,displayTo:s,displayRange:y},C=this.createRange({chart:i,paneId:n,defaultRange:E}),w=C.realFrom,I=C.realTo,T=C.realRange,M=this.minSpan(d);if(w===I||T<M){var F=u===w,A=h===I,D=ce/2;w=F?w:A?w-ce*M:w-D*M,I=A?I:F?I+ce*M:I+D*M}var P=this.getBounding().height,k=this.gap,O=k.top,z=k.bottom,U=O;U>=1&&(U=U/P);var Z=z;Z>=1&&(Z=Z/P),T=I-w,w=w-T*Z,I=I+T*U;var et=this.realValueToValue(w,{range:C}),J=this.realValueToValue(I,{range:C}),ot=this.realValueToDisplayValue(w,{range:C}),G=this.realValueToDisplayValue(I,{range:C});return{from:et,to:J,range:J-et,realFrom:w,realTo:I,realRange:I-w,displayFrom:ot,displayTo:G,displayRange:G-ot}},e.prototype.isInCandle=function(){return this.getParent().getId()===N.CANDLE},e.prototype.isFromZero=function(){return this.position===kt.Left&&this.inside||this.position===kt.Right&&!this.inside},e.prototype.createTicksImp=function(){var t=this,i,a,n=this.getRange(),o=n.displayFrom,s=n.displayTo,l=n.displayRange,u=[];if(l>=0){var h=li(l/ce),c=ui(h),v=qe(Math.ceil(o/h)*h,c),d=qe(Math.floor(s/h)*h,c),g=0,f=v;if(h!==0)for(;f<=d;){var p=f.toFixed(c);u[g]={text:p,coord:0,value:p},++g,f+=h}}var m=this.getParent(),_=(a=(i=m.getYAxisWidget())===null||i===void 0?void 0:i.getBounding().height)!==null&&a!==void 0?a:0,x=m.getChart().getChartStore(),b=[],y=x.getIndicatorsByPaneId(m.getId()),E=x.getStyles(),C=0,w=!1;this.isInCandle()?C=x.getPrecision().price:y.forEach(function(D){C=Math.max(C,D.precision),w||(w=D.shouldFormatBigNumber)});var I=x.getCustomApi(),T=x.getThousandsSeparator(),M=x.getDecimalFold(),F=E.xAxis.tickText.size,A=NaN;return u.forEach(function(D){var P=D.value,k=t.displayValueToText(+P,C),O=t.convertToPixel(t.realValueToValue(t.displayValueToRealValue(+P,{range:n}),{range:n}));w&&(k=I.formatBigNumber(P)),k=M.format(T.format(k));var z=B(A);O>F&&O<_-F&&(z&&Math.abs(A-O)>F*2||!z)&&(b.push({text:k,coord:O,value:P}),A=O)}),at(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:b}):b},e.prototype.getAutoSize=function(){var t=this.getParent(),i=t.getChart(),a=i.getChartStore(),n=a.getStyles(),o=n.yAxis,s=o.size;if(s!=="auto")return s;var l=0;if(o.show&&(o.axisLine.show&&(l+=o.axisLine.size),o.tickLine.show&&(l+=o.tickLine.length),o.tickText.show)){var u=0;this.getTicks().forEach(function(x){u=Math.max(u,me(x.text,o.tickText.size,o.tickText.weight,o.tickText.family))}),l+=o.tickText.marginStart+o.tickText.marginEnd+u}var h=n.crosshair,c=0;if(h.show&&h.horizontal.show&&h.horizontal.text.show){var v=a.getIndicatorsByPaneId(t.getId()),d=0,g=!1;v.forEach(function(x){d=Math.max(x.precision,d),g||(g=x.shouldFormatBigNumber)});var f=2;if(this.isInCandle()){var p=a.getPrecision().price,m=n.indicator.lastValueMark;m.show&&m.text.show?f=Math.max(d,p):f=p}else f=d;var _=it(this.getRange().displayTo,f);g&&(_=a.getCustomApi().formatBigNumber(_)),_=a.getDecimalFold().format(_),c+=h.horizontal.text.paddingLeft+h.horizontal.text.paddingRight+h.horizontal.text.borderSize*2+me(_,h.horizontal.text.size,h.horizontal.text.weight,h.horizontal.text.family)}return Math.max(l,c)},e.prototype.getBounding=function(){return this.getParent().getYAxisWidget().getBounding()},e.prototype.convertFromPixel=function(t){var i=this.getBounding().height,a=this.getRange(),n=a.realFrom,o=a.realRange,s=this.reverse?t/i:1-t/i,l=s*o+n;return this.realValueToValue(l,{range:a})},e.prototype.convertToPixel=function(t){var i,a,n=this.getRange(),o=this.valueToRealValue(t,{range:n}),s=(a=(i=this.getParent().getYAxisWidget())===null||i===void 0?void 0:i.getBounding().height)!==null&&a!==void 0?a:0,l=n.realFrom,u=n.realRange,h=(o-l)/u;return this.reverse?Math.round(h*s):Math.round((1-h)*s)},e.prototype.convertToNicePixel=function(t){var i,a,n=(a=(i=this.getParent().getYAxisWidget())===null||i===void 0?void 0:i.getBounding().height)!==null&&a!==void 0?a:0,o=this.convertToPixel(t);return Math.round(Math.max(n*.05,Math.min(o,n*.98)))},e.extend=function(t){var i=function(a){V(n,a);function n(o){return a.call(this,o,t)||this}return n}(e);return i},e}(Ar),tn={name:"normal"},en={name:"percentage",minSpan:function(){return Math.pow(10,-2)},displayValueToText:function(r){return"".concat(it(r,2),"%")},valueToRealValue:function(r,e){var t=e.range;return(r-t.from)/t.range*t.realRange+t.realFrom},realValueToValue:function(r,e){var t=e.range;return(r-t.realFrom)/t.realRange*t.range+t.from},createRange:function(r){var e=r.chart,t=r.defaultRange,i=e.getDataList(),a=e.getVisibleRange(),n=i[a.from];if(S(n)){var o=t.from,s=t.to,l=t.range,u=(t.from-n.close)/n.close*100,h=(t.to-n.close)/n.close*100,c=h-u;return{from:o,to:s,range:l,realFrom:u,realTo:h,realRange:c,displayFrom:u,displayTo:h,displayRange:c}}return t}},rn={name:"logarithm",minSpan:function(r){return .05*Wt(-r)},valueToRealValue:function(r){return r<0?-Mt(Math.abs(r)):Mt(r)},realValueToDisplayValue:function(r){return r<0?-Wt(Math.abs(r)):Wt(r)},displayValueToRealValue:function(r){return r<0?-Mt(Math.abs(r)):Mt(r)},realValueToValue:function(r){return r<0?-Wt(Math.abs(r)):Wt(r)},createRange:function(r){var e=r.defaultRange,t=e.from,i=e.to,a=e.range,n=t<0?-Mt(Math.abs(t)):Mt(t),o=i<0?-Mt(Math.abs(i)):Mt(i);return{from:t,to:i,range:a,realFrom:n,realTo:o,realRange:o-n,displayFrom:t,displayTo:i,displayRange:a}}},ir={normal:fe.extend(tn),percentage:fe.extend(en),logarithm:fe.extend(rn)};function an(r){var e;return(e=ir[r])!==null&&e!==void 0?e:ir.normal}var Fr=function(){function r(e,t){this._bounding=ye(),this._originalBounding=ye(),this._visible=!0,this._chart=e,this._id=t,this._container=Dt("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"})}return r.prototype.getContainer=function(){return this._container},r.prototype.setVisible=function(e){this._visible!==e&&(this._container.style.display=e?"block":"none",this._visible=e)},r.prototype.getVisible=function(){return this._visible},r.prototype.getId=function(){return this._id},r.prototype.getChart=function(){return this._chart},r.prototype.getBounding=function(){return this._bounding},r.prototype.setOriginalBounding=function(e){q(this._originalBounding,e)},r.prototype.getOriginalBounding=function(){return this._originalBounding},r.prototype.update=function(e){this._bounding.height!==this._container.clientHeight&&(this._container.style.height="".concat(this._bounding.height,"px")),this.updateImp(e??3,this._container,this._bounding)},r}(),Br=function(r){V(e,r);function e(t,i,a){var n=r.call(this,t,i)||this;n._yAxisWidget=null,n._options={id:"",minHeight:de,dragEnabled:!0,order:0,height:_r,state:"normal",axis:{name:"normal",scrollZoomEnabled:!0}};var o=n.getContainer();return n._mainWidget=n.createMainWidget(o),n._yAxisWidget=n.createYAxisWidget(o),n.setOptions(a),n}return e.prototype.setOptions=function(t){var i,a,n,o,s,l=this.getId();if(l===N.CANDLE||l===N.X_AXIS){var u=(i=t.axis)===null||i===void 0?void 0:i.name;(!S(this._axis)||S(u)&&this._options.axis.name!==u)&&(this._axis=this.createAxisComponent(u??"normal"))}else S(this._axis)||(this._axis=this.createAxisComponent("normal"));this._axis instanceof fe&&this._axis.setAutoCalcTickFlag(!0),q(this._options,t),this._axis.override(R(R({},this._options.axis),{name:(n=(a=t.axis)===null||a===void 0?void 0:a.name)!==null&&n!==void 0?n:"normal"}));var h=null,c="default";return this.getId()===N.X_AXIS?(h=this.getMainWidget().getContainer(),c="ew-resize"):(h=this.getYAxisWidget().getContainer(),c="ns-resize"),!((s=(o=t.axis)===null||o===void 0?void 0:o.scrollZoomEnabled)!==null&&s!==void 0)||s?h.style.cursor=c:h.style.cursor="default",this},e.prototype.getOptions=function(){return this._options},e.prototype.getAxisComponent=function(){return this._axis},e.prototype.setBounding=function(t,i,a,n){var o,s,l,u;q(this.getBounding(),t);var h={};S(t.height)&&(h.height=t.height),S(t.top)&&(h.top=t.top),this._mainWidget.setBounding(h);var c=S(i);if(c&&this._mainWidget.setBounding(i),S(this._yAxisWidget)){this._yAxisWidget.setBounding(h);var v=this._axis;v.position===kt.Left?S(a)&&this._yAxisWidget.setBounding(R(R({},a),{left:0})):S(n)&&(this._yAxisWidget.setBounding(n),c&&this._yAxisWidget.setBounding({left:((o=i.left)!==null&&o!==void 0?o:0)+((s=i.width)!==null&&s!==void 0?s:0)+((l=i.right)!==null&&l!==void 0?l:0)-((u=n.width)!==null&&u!==void 0?u:0)}))}return this},e.prototype.getMainWidget=function(){return this._mainWidget},e.prototype.getYAxisWidget=function(){return this._yAxisWidget},e.prototype.updateImp=function(t){var i;this._mainWidget.update(t),(i=this._yAxisWidget)===null||i===void 0||i.update(t)},e.prototype.destroy=function(){var t;this._mainWidget.destroy(),(t=this._yAxisWidget)===null||t===void 0||t.destroy()},e.prototype.getImage=function(t){var i=this.getBounding(),a=i.width,n=i.height,o=Dt("canvas",{width:"".concat(a,"px"),height:"".concat(n,"px"),boxSizing:"border-box"}),s=o.getContext("2d"),l=Ot(o);o.width=a*l,o.height=n*l,s.scale(l,l);var u=this._mainWidget.getBounding();if(s.drawImage(this._mainWidget.getImage(t),u.left,0,u.width,u.height),this._yAxisWidget!==null){var h=this._yAxisWidget.getBounding();s.drawImage(this._yAxisWidget.getImage(t),h.left,0,h.width,h.height)}return o},e.prototype.createYAxisWidget=function(t){return null},e}(Fr),Or=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.createAxisComponent=function(t){var i=an(t??"default");return new i(this)},e.prototype.createMainWidget=function(t){return new Mr(t,this)},e.prototype.createYAxisWidget=function(t){return new Ka(t,this)},e}(Br),nn=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.createMainWidget=function(t){return new ja(t,this)},e}(Or),on=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getAxisStyles=function(t){return t.xAxis},e.prototype.createAxisLine=function(t){return{coordinates:[{x:0,y:0},{x:t.width,y:0}]}},e.prototype.createTickLines=function(t,i,a){var n=a.tickLine,o=a.axisLine.size;return t.map(function(s){return{coordinates:[{x:s.coord,y:0},{x:s.coord,y:o+n.length}]}})},e.prototype.createTickTexts=function(t,i,a){var n=a.tickText,o=a.axisLine.size,s=a.tickLine.length;return t.map(function(l){return{x:l.coord,y:o+s+n.marginStart,text:l.text,align:"center",baseline:"top"}})},e}(kr),sn=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.coordinateToPointTimestampDataIndexFlag=function(){return!0},e.prototype.coordinateToPointValueFlag=function(){return!1},e.prototype.getCompleteOverlays=function(){return this.getWidget().getPane().getChart().getChartStore().getOverlaysByPaneId()},e.prototype.getProgressOverlay=function(){var t,i;return(i=(t=this.getWidget().getPane().getChart().getChartStore().getProgressOverlayInfo())===null||t===void 0?void 0:t.overlay)!==null&&i!==void 0?i:null},e.prototype.getDefaultFigures=function(t,i){var a,n=[],o=this.getWidget(),s=o.getPane(),l=s.getChart().getChartStore(),u=l.getClickOverlayInfo();if(t.needDefaultXAxisFigure&&t.id===((a=u.overlay)===null||a===void 0?void 0:a.id)){var h=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;i.forEach(function(v,d){h=Math.min(h,v.x),c=Math.max(c,v.x);var g=t.points[d];if(B(g.timestamp)){var f=l.getCustomApi().formatDate(g.timestamp,"YYYY-MM-DD HH:mm",yt.Crosshair);n.push({type:"text",attrs:{x:v.x,y:0,text:f,align:"center"},ignoreEvent:!0})}}),i.length>1&&n.unshift({type:"rect",attrs:{x:h,y:0,width:c-h,height:o.getBounding().height},ignoreEvent:!0})}return n},e.prototype.getFigures=function(t,i){var a,n,o=this.getWidget(),s=o.getPane(),l=s.getChart(),u=s.getAxisComponent(),h=l.getXAxisPane().getAxisComponent(),c=o.getBounding();return(n=(a=t.createXAxisFigures)===null||a===void 0?void 0:a.call(t,{chart:l,overlay:t,coordinates:i,bounding:c,xAxis:h,yAxis:u}))!==null&&n!==void 0?n:[]},e}(Dr),ln=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.compare=function(t){return S(t.timestamp)},e.prototype.getDirectionStyles=function(t){return t.vertical},e.prototype.getText=function(t,i){var a=t.timestamp;return i.getCustomApi().formatDate(a,"YYYY-MM-DD HH:mm",yt.Crosshair)},e.prototype.getTextAttrs=function(t,i,a,n,o,s){var l=a.realX,u=0,h="center";return l-i/2-s.paddingLeft<0?(u=0,h="left"):l+i/2+s.paddingRight>n.width?(u=n.width,h="right"):u=l,{x:u,y:0,text:t,align:h,baseline:"top"}},e}(Rr),un=function(r){V(e,r);function e(t,i){var a=r.call(this,t,i)||this;return a._xAxisView=new on(a),a._overlayXAxisView=new sn(a),a._crosshairVerticalLabelView=new ln(a),a.getContainer().style.cursor="ew-resize",a.addChild(a._overlayXAxisView),a}return e.prototype.getName=function(){return W.X_AXIS},e.prototype.updateMain=function(t){this._xAxisView.draw(t)},e.prototype.updateOverlay=function(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)},e}(Le),hn=function(r){V(e,r);function e(t,i){var a=r.call(this,t)||this;return a.override(i),a}return e.prototype.override=function(t){var i=t.name,a=t.scrollZoomEnabled,n=t.createTicks;Y(this.name)||(this.name=i),this.scrollZoomEnabled=a??this.scrollZoomEnabled,this.createTicks=n??this.createTicks},e.prototype.createRangeImp=function(){var t=this.getParent().getChart().getChartStore(),i=t.getVisibleRange(),a=i.realFrom,n=i.realTo,o=a,s=n,l=n-a+1,u={from:o,to:s,range:l,realFrom:o,realTo:s,realRange:l,displayFrom:o,displayTo:s,displayRange:l};return u},e.prototype.createTicksImp=function(){var t=this,i=this.getRange(),a=i.realFrom,n=i.realTo,o=this.getParent().getChart().getChartStore(),s=o.getCustomApi().formatDate,l=o.getTimeWeightTickList(),u=[],h=function(x,b){var y,E;try{for(var C=ut(x),w=C.next();!w.done;w=C.next()){var I=w.value;if(I.dataIndex>=b&&I.dataIndex<n){var T=I.timestamp,M=I.weight,F=I.dataIndex,A="";switch(M){case lt.Year:{A=s(T,"YYYY",yt.XAxis);break}case lt.Month:{A=s(T,"YYYY-MM",yt.XAxis);break}case lt.Day:{A=s(T,"MM-DD",yt.XAxis);break}case lt.Hour:case lt.Minute:{A=s(T,"HH:mm",yt.XAxis);break}case lt.Second:{A=s(T,"HH:mm:ss",yt.XAxis);break}default:{A=s(T,"YYYY-MM-DD HH:mm",yt.XAxis);break}}u.push({coord:t.convertToPixel(F),value:T,text:A})}}}catch(D){y={error:D}}finally{try{w&&!w.done&&(E=C.return)&&E.call(C)}finally{if(y)throw y.error}}};if(h(l,a),l.length>0){for(var c=o.getBarSpace().bar,v=o.getStyles().xAxis.tickText,d=vr(c,v),g=l[l.length-1].dataIndex+d-1,f=[],p=g;p<n;p++){var m=o.dataIndexToTimestamp(p);B(m)&&f.push({timestamp:m})}if(f.length>0){var _=new Map;cr(_,f,o.getDateTimeFormat(),g),h(De(_,c,v),g)}}return at(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:u}):u},e.prototype.getAutoSize=function(){var t=this.getParent().getChart().getStyles(),i=t.xAxis,a=i.size;if(a!=="auto")return a;var n=t.crosshair,o=0;i.show&&(i.axisLine.show&&(o+=i.axisLine.size),i.tickLine.show&&(o+=i.tickLine.length),i.tickText.show&&(o+=i.tickText.marginStart+i.tickText.marginEnd+i.tickText.size));var s=0;return n.show&&n.vertical.show&&n.vertical.text.show&&(s+=n.vertical.text.paddingTop+n.vertical.text.paddingBottom+n.vertical.text.borderSize*2+n.vertical.text.size),Math.max(o,s)},e.prototype.getBounding=function(){return this.getParent().getMainWidget().getBounding()},e.prototype.convertTimestampFromPixel=function(t){var i=this.getParent().getChart().getChartStore(),a=i.coordinateToDataIndex(t);return i.dataIndexToTimestamp(a)},e.prototype.convertTimestampToPixel=function(t){var i=this.getParent().getChart().getChartStore(),a=i.timestampToDataIndex(t);return i.dataIndexToCoordinate(a)},e.prototype.convertFromPixel=function(t){return this.getParent().getChart().getChartStore().coordinateToDataIndex(t)},e.prototype.convertToPixel=function(t){return this.getParent().getChart().getChartStore().dataIndexToCoordinate(t)},e.extend=function(t){var i=function(a){V(n,a);function n(o){return a.call(this,o,t)||this}return n}(e);return i},e}(Ar),cn={name:"normal"},ar={normal:hn.extend(cn)};function vn(r){var e;return(e=ar[r])!==null&&e!==void 0?e:ar.normal}var dn=function(r){V(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.createAxisComponent=function(t){var i=vn(t);return new i(this)},e.prototype.createMainWidget=function(t){return new un(t,this)},e}(Br);function fn(r,e){var t=0;return function(){var i=Date.now();i-t>e&&(r.apply(this,arguments),t=i)}}var gn=function(r){V(e,r);function e(t,i){var a=r.call(this,t,i)||this;return a._dragFlag=!1,a._dragStartY=0,a._topPaneHeight=0,a._bottomPaneHeight=0,a._topPane=null,a._bottomPane=null,a._pressedMouseMoveEvent=fn(a._pressedTouchMouseMoveEvent,20),a.registerEvent("touchStartEvent",a._mouseDownEvent.bind(a)).registerEvent("touchMoveEvent",a._pressedMouseMoveEvent.bind(a)).registerEvent("touchEndEvent",a._mouseUpEvent.bind(a)).registerEvent("mouseDownEvent",a._mouseDownEvent.bind(a)).registerEvent("mouseUpEvent",a._mouseUpEvent.bind(a)).registerEvent("pressedMouseMoveEvent",a._pressedMouseMoveEvent.bind(a)).registerEvent("mouseEnterEvent",a._mouseEnterEvent.bind(a)).registerEvent("mouseLeaveEvent",a._mouseLeaveEvent.bind(a)),a}return e.prototype.getName=function(){return W.SEPARATOR},e.prototype.checkEventOn=function(){return!0},e.prototype._mouseDownEvent=function(t){var i=this;this._dragFlag=!0,this._dragStartY=t.pageY;var a=this.getPane(),n=a.getChart();this._topPane=a.getTopPane(),this._bottomPane=a.getBottomPane();var o=n.getDrawPanes();if(this._topPane.getOptions().state==="minimize")for(var s=o.findIndex(function(c){var v;return c.getId()===((v=i._topPane)===null||v===void 0?void 0:v.getId())}),l=s-1;l>-1;l--){var u=o[l];if(u.getOptions().state!=="minimize"){this._topPane=u;break}}if(this._bottomPane.getOptions().state==="minimize")for(var s=o.findIndex(function(v){var d;return v.getId()===((d=i._bottomPane)===null||d===void 0?void 0:d.getId())}),l=s+1;l<o.length;l++){var h=o[l];if(h.getOptions().state!=="minimize"){this._bottomPane=h;break}}return this._topPaneHeight=this._topPane.getBounding().height,this._bottomPaneHeight=this._bottomPane.getBounding().height,!0},e.prototype._mouseUpEvent=function(){return this._dragFlag=!1,this._topPane=null,this._bottomPane=null,this._topPaneHeight=0,this._bottomPaneHeight=0,this._mouseLeaveEvent()},e.prototype._pressedTouchMouseMoveEvent=function(t){var i=t.pageY-this._dragStartY,a=i<0;if(S(this._topPane)&&S(this._bottomPane)){var n=this._bottomPane.getOptions();if(this._topPane.getOptions().state!=="minimize"&&n.state!=="minimize"&&n.dragEnabled){var o=null,s=null,l=0,u=0;a?(o=this._topPane,s=this._bottomPane,l=this._topPaneHeight,u=this._bottomPaneHeight):(o=this._bottomPane,s=this._topPane,l=this._bottomPaneHeight,u=this._topPaneHeight);var h=o.getOptions().minHeight;if(l>h){var c=Math.max(l-Math.abs(i),h),v=l-c;o.setBounding({height:c}),s.setBounding({height:u+v});var d=this.getPane(),g=d.getChart();g.getChartStore().executeAction(_t.OnPaneDrag,{paneId:d.getId()}),g.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}}}return!0},e.prototype._mouseEnterEvent=function(){var t=this.getPane(),i=t.getBottomPane();if(i.getOptions().dragEnabled){var a=t.getChart(),n=a.getStyles().separator;return this.getContainer().style.background=n.activeBackgroundColor,!0}return!1},e.prototype._mouseLeaveEvent=function(){return this._dragFlag?!1:(this.getContainer().style.background="transparent",!0)},e.prototype.createContainer=function(){return Dt("div",{width:"100%",height:"".concat(ee,"px"),margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"})},e.prototype.updateImp=function(t,i,a){if(a===4||a===2){var n=this.getPane().getChart().getStyles().separator;t.style.top="".concat(-Math.floor((ee-n.size)/2),"px"),t.style.height="".concat(ee,"px")}},e}(xr),pn=function(r){V(e,r);function e(t,i,a,n){var o=r.call(this,t,i)||this;return o.getContainer().style.overflow="",o._topPane=a,o._bottomPane=n,o._separatorWidget=new gn(o.getContainer(),o),o}return e.prototype.setBounding=function(t){return q(this.getBounding(),t),this},e.prototype.getTopPane=function(){return this._topPane},e.prototype.setTopPane=function(t){return this._topPane=t,this},e.prototype.getBottomPane=function(){return this._bottomPane},e.prototype.setBottomPane=function(t){return this._bottomPane=t,this},e.prototype.getWidget=function(){return this._separatorWidget},e.prototype.getImage=function(t){var i=this.getBounding(),a=i.width,n=i.height,o=this.getChart().getStyles().separator,s=Dt("canvas",{width:"".concat(a,"px"),height:"".concat(n,"px"),boxSizing:"border-box"}),l=s.getContext("2d"),u=Ot(s);return s.width=a*u,s.height=n*u,l.scale(u,u),l.fillStyle=o.color,l.fillRect(0,0,a,n),s},e.prototype.updateImp=function(t,i,a){if(t===4||t===2){var n=this.getChart().getStyles().separator;i.style.backgroundColor=n.color,i.style.height="".concat(a.height,"px"),i.style.marginLeft="".concat(a.left,"px"),i.style.width="".concat(a.width,"px"),this._separatorWidget.update(t)}},e}(Fr);function nr(){return typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes("firefox")}function Ie(){return typeof window>"u"?!1:/iPhone|iPad|iPod|iOS/.test(window.navigator.userAgent)}var Ht={CancelClick:5,CancelTap:5,DoubleClick:5,DoubleTap:30},Jt={Left:0,Middle:1,Right:2},mn=10,yn=function(){function r(e,t,i){var a=this;this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!Ie(),this._onFirefoxOutsideMouseUp=function(n){a._mouseUpHandler(n)},this._onMobileSafariDoubleClick=function(n){if(a._firesTouchEvents(n)){if(++a._tapCount,a._tapTimeoutId!==null&&a._tapCount>1){var o=a._mouseTouchMoveWithDownInfo(a._getCoordinate(n),a._tapCoordinate).manhattanDistance;o<Ht.DoubleTap&&!a._cancelTap&&a._processEvent(a._makeCompatEvent(n),a._handler.doubleTapEvent),a._resetTapTimeout()}}else if(++a._clickCount,a._clickTimeoutId!==null&&a._clickCount>1){var o=a._mouseTouchMoveWithDownInfo(a._getCoordinate(n),a._clickCoordinate).manhattanDistance;o<Ht.DoubleClick&&!a._cancelClick&&a._processEvent(a._makeCompatEvent(n),a._handler.mouseDoubleClickEvent),a._resetClickTimeout()}},this._target=e,this._handler=t,this._options=i,this._init()}return r.prototype.destroy=function(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()},r.prototype._mouseEnterHandler=function(e){var t=this,i,a,n;(i=this._unsubscribeMousemove)===null||i===void 0||i.call(this),(a=this._unsubscribeMouseWheel)===null||a===void 0||a.call(this),(n=this._unsubscribeContextMenu)===null||n===void 0||n.call(this);var o=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=function(){t._target.removeEventListener("mousemove",o)},this._target.addEventListener("mousemove",o);var s=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=function(){t._target.removeEventListener("wheel",s)},this._target.addEventListener("wheel",s,{passive:!1});var l=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=function(){t._target.removeEventListener("contextmenu",l)},this._target.addEventListener("contextmenu",l,{passive:!1}),!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)},r.prototype._resetClickTimeout=function(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}},r.prototype._resetTapTimeout=function(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}},r.prototype._mouseMoveHandler=function(e){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(e)||(this._processEvent(this._makeCompatEvent(e),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)},r.prototype._mouseWheelHandler=function(e){if(Math.abs(e.deltaX)>Math.abs(e.deltaY)){if(!S(this._handler.mouseWheelHortEvent)||(this._preventDefault(e),Math.abs(e.deltaX)===0))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(e),-e.deltaX)}else{if(!S(this._handler.mouseWheelVertEvent))return;var t=-(e.deltaY/100);if(t===0)return;switch(this._preventDefault(e),e.deltaMode){case e.DOM_DELTA_PAGE:{t*=120;break}case e.DOM_DELTA_LINE:{t*=32;break}}if(t!==0){var i=Math.sign(t)*Math.min(1,Math.abs(t));this._handler.mouseWheelVertEvent(this._makeCompatEvent(e),i)}}},r.prototype._contextMenuHandler=function(e){this._preventDefault(e)},r.prototype._touchMoveHandler=function(e){var t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t!==null&&(this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._startPinchMiddleCoordinate===null&&!this._preventTouchDragProcess)){this._pinchPrevented=!0;var i=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._touchMoveStartCoordinate),a=i.xOffset,n=i.yOffset,o=i.manhattanDistance;if(!(!this._touchMoveExceededManhattanDistance&&o<Ht.CancelTap)){if(!this._touchMoveExceededManhattanDistance){var s=a*.5,l=n>=s&&!this._options.treatVertDragAsPageScroll(),u=s>n&&!this._options.treatHorzDragAsPageScroll();!l&&!u&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(e,t),this._handler.touchMoveEvent)}}},r.prototype._mouseMoveWithDownHandler=function(e){if(e.button===Jt.Left){var t=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._mouseMoveStartCoordinate),i=t.manhattanDistance;i>=Ht.CancelClick&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(e),this._handler.pressedMouseMoveEvent)}},r.prototype._mouseTouchMoveWithDownInfo=function(e,t){var i=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y),n=i+a;return{xOffset:i,yOffset:a,manhattanDistance:n}},r.prototype._touchEndHandler=function(e){var t=this._touchWithId(e.changedTouches,this._activeTouchId);if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t!==null){this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(e),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);var i=this._makeCompatEvent(e,t);if(this._processEvent(i,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){var a=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate).manhattanDistance;a<Ht.DoubleTap&&!this._cancelTap&&this._processEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(i,this._handler.tapEvent),S(this._handler.tapEvent)&&this._preventDefault(e));this._tapCount===0&&this._preventDefault(e),e.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(e))}},r.prototype._mouseUpHandler=function(e){if(e.button===Jt.Left){var t=this._makeCompatEvent(e);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),nr()){var i=this._target.ownerDocument.documentElement;i.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp)}if(!this._firesTouchEvents(e))if(this._processEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){var a=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._clickCoordinate).manhattanDistance;a<Ht.DoubleClick&&!this._cancelClick&&this._processEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(t,this._handler.mouseClickEvent)}},r.prototype._clearLongTapTimeout=function(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)},r.prototype._touchStartHandler=function(e){if(this._activeTouchId===null){var t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(e);var i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{var a=this._touchMoveHandler.bind(this),n=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=function(){i.removeEventListener("touchmove",a),i.removeEventListener("touchend",n)},i.addEventListener("touchmove",a,{passive:!1}),i.addEventListener("touchend",n,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),500)}this._processEvent(this._makeCompatEvent(e,t),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapCoordinate=this._getCoordinate(t))}},r.prototype._mouseDownHandler=function(e){if(e.button===Jt.Right){this._preventDefault(e),this._processEvent(this._makeCompatEvent(e),this._handler.mouseRightClickEvent);return}if(e.button===Jt.Left){var t=this._target.ownerDocument.documentElement;nr()&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{var i=this._mouseMoveWithDownHandler.bind(this),a=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=function(){t.removeEventListener("mousemove",i),t.removeEventListener("mouseup",a)},t.addEventListener("mousemove",i),t.addEventListener("mouseup",a)}this._mousePressed=!0,!this._firesTouchEvents(e)&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickCoordinate=this._getCoordinate(e)))}},r.prototype._init=function(){var e=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{var t=this._target.ownerDocument,i=function(a){e._handler.mouseDownOutsideEvent!=null&&(a.composed&&e._target.contains(a.composedPath()[0])||a.target!==null&&e._target.contains(a.target)||e._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=function(){t.removeEventListener("touchstart",i)},this._unsubscribeOutsideMouseEvents=function(){t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}Ie()&&(this._unsubscribeMobileSafariEvents=function(){e._target.removeEventListener("dblclick",e._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",function(a){if(a.button===Jt.Middle)return a.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",function(){},{passive:!1})},r.prototype._initPinch=function(){var e=this;!S(this._handler.pinchStartEvent)&&!S(this._handler.pinchEvent)&&!S(this._handler.pinchEndEvent)||(this._target.addEventListener("touchstart",function(t){e._checkPinchState(t.touches)},{passive:!0}),this._target.addEventListener("touchmove",function(t){if(!(t.touches.length!==2||e._startPinchMiddleCoordinate===null)&&S(e._handler.pinchEvent)){var i=e._getTouchDistance(t.touches[0],t.touches[1]),a=i/e._startPinchDistance;e._handler.pinchEvent(R(R({},e._startPinchMiddleCoordinate),{pageX:0,pageY:0}),a),e._preventDefault(t)}},{passive:!1}),this._target.addEventListener("touchend",function(t){e._checkPinchState(t.touches)}))},r.prototype._checkPinchState=function(e){e.length===1&&(this._pinchPrevented=!1),e.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)},r.prototype._startPinch=function(e){var t=this._target.getBoundingClientRect();this._startPinchMiddleCoordinate={x:(e[0].clientX-t.left+(e[1].clientX-t.left))/2,y:(e[0].clientY-t.top+(e[1].clientY-t.top))/2},this._startPinchDistance=this._getTouchDistance(e[0],e[1]),S(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()},r.prototype._stopPinch=function(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,S(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))},r.prototype._mouseLeaveHandler=function(e){var t,i,a;(t=this._unsubscribeMousemove)===null||t===void 0||t.call(this),(i=this._unsubscribeMouseWheel)===null||i===void 0||i.call(this),(a=this._unsubscribeContextMenu)===null||a===void 0||a.call(this),!this._firesTouchEvents(e)&&this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(e),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!Ie())},r.prototype._longTapHandler=function(e){var t=this._touchWithId(e.touches,this._activeTouchId);t!==null&&(this._processEvent(this._makeCompatEvent(e,t),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)},r.prototype._firesTouchEvents=function(e){var t;return S((t=e.sourceCapabilities)===null||t===void 0?void 0:t.firesTouchEvents)?e.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(e)<this._lastTouchEventTimeStamp+500},r.prototype._processEvent=function(e,t){t==null||t.call(this._handler,e)},r.prototype._makeCompatEvent=function(e,t){var i=this,a=t??e,n=this._target.getBoundingClientRect();return{x:a.clientX-n.left,y:a.clientY-n.top,pageX:a.pageX,pageY:a.pageY,isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click"&&e.type!=="wheel",preventDefault:function(){e.type!=="touchstart"&&i._preventDefault(e)}}},r.prototype._getTouchDistance=function(e,t){var i=e.clientX-t.clientX,a=e.clientY-t.clientY;return Math.sqrt(i*i+a*a)},r.prototype._preventDefault=function(e){e.cancelable&&e.preventDefault()},r.prototype._getCoordinate=function(e){return{x:e.pageX,y:e.pageY}},r.prototype._eventTimeStamp=function(e){var t;return(t=e.timeStamp)!==null&&t!==void 0?t:performance.now()},r.prototype._touchWithId=function(e,t){for(var i=0;i<e.length;++i)if(e[i].identifier===t)return e[i];return null},r}(),_n=function(){function r(e,t){var i=this;this._flingStartTime=new Date().getTime(),this._flingScrollRequestId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._mouseDownWidget=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._mouseMoveTriggerWidgetInfo={pane:null,widget:null},this._boundKeyBoardDownEvent=function(a){if(a.shiftKey)switch(a.code){case"Equal":{i._chart.getChartStore().zoom(.5);break}case"Minus":{i._chart.getChartStore().zoom(-.5);break}case"ArrowLeft":{var n=i._chart.getChartStore();n.startScroll(),n.scroll(-3*n.getBarSpace().bar);break}case"ArrowRight":{var n=i._chart.getChartStore();n.startScroll(),n.scroll(3*n.getBarSpace().bar);break}}},this._container=e,this._chart=t,this._event=new yn(e,this,{treatVertDragAsPageScroll:function(){return!1},treatHorzDragAsPageScroll:function(){return!1}}),e.addEventListener("keydown",this._boundKeyBoardDownEvent)}return r.prototype.pinchStartEvent=function(){return this._touchZoomed=!0,this._pinchScale=1,!0},r.prototype.pinchEvent=function(e,t){var i=this._findWidgetByEvent(e),a=i.pane,n=i.widget;if((a==null?void 0:a.getId())!==N.X_AXIS&&(n==null?void 0:n.getName())===W.MAIN){var o=this._makeWidgetEvent(e,n),s=(t-this._pinchScale)*5;return this._pinchScale=t,this._chart.getChartStore().zoom(s,{x:o.x,y:o.y}),!0}return!1},r.prototype.mouseWheelHortEvent=function(e,t){var i=this._chart.getChartStore();return i.startScroll(),i.scroll(t),!0},r.prototype.mouseWheelVertEvent=function(e,t){var i=this._findWidgetByEvent(e).widget,a=this._makeWidgetEvent(e,i),n=i==null?void 0:i.getName();return n===W.MAIN?(this._chart.getChartStore().zoom(t,{x:a.x,y:a.y}),!0):!1},r.prototype.mouseDownEvent=function(e){var t=this._findWidgetByEvent(e),i=t.pane,a=t.widget;if(this._mouseDownWidget=a,a!==null){var n=this._makeWidgetEvent(e,a),o=a.getName();switch(o){case W.SEPARATOR:return a.dispatchEvent("mouseDownEvent",n);case W.MAIN:{var s=i.getAxisComponent();if(!s.getAutoCalcTickFlag()){var l=s.getRange();this._prevYAxisRange=R({},l)}return this._startScrollCoordinate={x:n.x,y:n.y},this._chart.getChartStore().startScroll(),a.dispatchEvent("mouseDownEvent",n)}case W.X_AXIS:return this._processXAxisScrollStartEvent(a,n);case W.Y_AXIS:return this._processYAxisScaleStartEvent(a,n)}}return!1},r.prototype.mouseMoveEvent=function(e){var t,i,a,n=this._findWidgetByEvent(e),o=n.pane,s=n.widget,l=this._makeWidgetEvent(e,s);if((((t=this._mouseMoveTriggerWidgetInfo.pane)===null||t===void 0?void 0:t.getId())!==(o==null?void 0:o.getId())||((i=this._mouseMoveTriggerWidgetInfo.widget)===null||i===void 0?void 0:i.getName())!==(s==null?void 0:s.getName()))&&(s==null||s.dispatchEvent("mouseEnterEvent",l),(a=this._mouseMoveTriggerWidgetInfo.widget)===null||a===void 0||a.dispatchEvent("mouseLeaveEvent",l),this._mouseMoveTriggerWidgetInfo={pane:o,widget:s}),s!==null){var u=s.getName();switch(u){case W.MAIN:{var h=s.dispatchEvent("mouseMoveEvent",l),c={x:l.x,y:l.y,paneId:o==null?void 0:o.getId()};return h?(c=void 0,s.getContainer().style.cursor="pointer"):s.getContainer().style.cursor="crosshair",this._chart.getChartStore().setCrosshair(c),h}case W.SEPARATOR:case W.X_AXIS:case W.Y_AXIS:{var h=s.dispatchEvent("mouseMoveEvent",l);return this._chart.getChartStore().setCrosshair(),h}}}return!1},r.prototype.pressedMouseMoveEvent=function(e){var t,i;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===W.SEPARATOR)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",e);var a=this._findWidgetByEvent(e),n=a.pane,o=a.widget;if(o!==null&&((t=this._mouseDownWidget)===null||t===void 0?void 0:t.getPane().getId())===(n==null?void 0:n.getId())&&((i=this._mouseDownWidget)===null||i===void 0?void 0:i.getName())===o.getName()){var s=this._makeWidgetEvent(e,o),l=o.getName();switch(l){case W.MAIN:{var u=void 0,h=o.dispatchEvent("pressedMouseMoveEvent",s);return h||(u={x:s.x,y:s.y,paneId:n==null?void 0:n.getId()},this._processMainScrollingEvent(o,s)),this._chart.getChartStore().setCrosshair(u,{forceInvalidate:!0}),h}case W.X_AXIS:return this._processXAxisScrollingEvent(o,s);case W.Y_AXIS:return this._processYAxisScalingEvent(o,s)}}return!1},r.prototype.mouseUpEvent=function(e){var t=this._findWidgetByEvent(e).widget,i=!1;if(t!==null){var a=this._makeWidgetEvent(e,t),n=t.getName();switch(n){case W.MAIN:case W.SEPARATOR:case W.X_AXIS:case W.Y_AXIS:{i=t.dispatchEvent("mouseUpEvent",a);break}}i&&this._chart.updatePane(1)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,i},r.prototype.mouseClickEvent=function(e){var t=this._findWidgetByEvent(e).widget;if(t!==null){var i=this._makeWidgetEvent(e,t);return t.dispatchEvent("mouseClickEvent",i)}return!1},r.prototype.mouseRightClickEvent=function(e){var t=this._findWidgetByEvent(e).widget,i=!1;if(t!==null){var a=this._makeWidgetEvent(e,t),n=t.getName();switch(n){case W.MAIN:case W.X_AXIS:case W.Y_AXIS:{i=t.dispatchEvent("mouseRightClickEvent",a);break}}i&&this._chart.updatePane(1)}return!1},r.prototype.mouseDoubleClickEvent=function(e){var t=this._findWidgetByEvent(e),i=t.pane,a=t.widget;if(a!==null){var n=a.getName();switch(n){case W.MAIN:{var o=this._makeWidgetEvent(e,a);return a.dispatchEvent("mouseDoubleClickEvent",o)}case W.Y_AXIS:{var s=i.getAxisComponent();if(!s.getAutoCalcTickFlag())return s.setAutoCalcTickFlag(!0),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}),!0;break}}}return!1},r.prototype.mouseLeaveEvent=function(){return this._chart.getChartStore().setCrosshair(),!0},r.prototype.touchStartEvent=function(e){var t,i=this._findWidgetByEvent(e),a=i.pane,n=i.widget;if(n!==null){var o=this._makeWidgetEvent(e,n);(t=o.preventDefault)===null||t===void 0||t.call(o);var s=n.getName();switch(s){case W.MAIN:{var l=this._chart.getChartStore();if(n.dispatchEvent("mouseDownEvent",o))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,l.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(1),!0;this._flingScrollRequestId!==null&&(Ge(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=new Date().getTime();var u=a.getAxisComponent();if(!u.getAutoCalcTickFlag()){var h=u.getRange();this._prevYAxisRange=R({},h)}if(this._startScrollCoordinate={x:o.x,y:o.y},l.startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){var c=o.x-this._touchCoordinate.x,v=o.y-this._touchCoordinate.y,d=Math.sqrt(c*c+v*v);d<mn?(this._touchCoordinate={x:o.x,y:o.y},l.setCrosshair({x:o.x,y:o.y,paneId:a==null?void 0:a.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,l.setCrosshair())}return!0}case W.X_AXIS:return this._processXAxisScrollStartEvent(n,o);case W.Y_AXIS:return this._processYAxisScaleStartEvent(n,o)}}return!1},r.prototype.touchMoveEvent=function(e){var t,i=this._findWidgetByEvent(e),a=i.pane,n=i.widget;if(n!==null){var o=this._makeWidgetEvent(e,n);(t=o.preventDefault)===null||t===void 0||t.call(o);var s=n.getName(),l=this._chart.getChartStore();switch(s){case W.MAIN:return n.dispatchEvent("pressedMouseMoveEvent",o)?(l.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(1),!0):(this._touchCoordinate!==null?l.setCrosshair({x:o.x,y:o.y,paneId:a==null?void 0:a.getId()}):this._processMainScrollingEvent(n,o),!0);case W.X_AXIS:return this._processXAxisScrollingEvent(n,o);case W.Y_AXIS:return this._processYAxisScalingEvent(n,o)}}return!1},r.prototype.touchEndEvent=function(e){var t=this,i=this._findWidgetByEvent(e).widget;if(i!==null){var a=this._makeWidgetEvent(e,i),n=i.getName();switch(n){case W.MAIN:{if(i.dispatchEvent("mouseUpEvent",a),this._startScrollCoordinate!==null){var o=new Date().getTime()-this._flingStartTime,s=a.x-this._startScrollCoordinate.x,l=s/(o>0?o:1)*20;if(o<200&&Math.abs(l)>0){var u=this._chart.getChartStore(),h=function(){t._flingScrollRequestId=_e(function(){u.startScroll(),u.scroll(l),l=l*(1-.025),Math.abs(l)<1?t._flingScrollRequestId!==null&&(Ge(t._flingScrollRequestId),t._flingScrollRequestId=null):h()})};h()}}return!0}case W.X_AXIS:case W.Y_AXIS:{var c=i.dispatchEvent("mouseUpEvent",a);c&&this._chart.updatePane(1)}}this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0}return!1},r.prototype.tapEvent=function(e){var t=this._findWidgetByEvent(e),i=t.pane,a=t.widget,n=!1;if(a!==null){var o=this._makeWidgetEvent(e,a),s=a.dispatchEvent("mouseClickEvent",o);if(a.getName()===W.MAIN){var l=this._makeWidgetEvent(e,a),u=this._chart.getChartStore();s?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,u.setCrosshair(void 0,{notInvalidate:!0}),n=!0):(!this._touchCancelCrosshair&&!this._touchZoomed&&(this._touchCoordinate={x:l.x,y:l.y},u.setCrosshair({x:l.x,y:l.y,paneId:i==null?void 0:i.getId()},{notInvalidate:!0}),n=!0),this._touchCancelCrosshair=!1)}(n||s)&&this._chart.updatePane(1)}return n},r.prototype.doubleTapEvent=function(e){return this.mouseDoubleClickEvent(e)},r.prototype.longTapEvent=function(e){var t=this._findWidgetByEvent(e),i=t.pane,a=t.widget;if(a!==null&&a.getName()===W.MAIN){var n=this._makeWidgetEvent(e,a);return this._touchCoordinate={x:n.x,y:n.y},this._chart.getChartStore().setCrosshair({x:n.x,y:n.y,paneId:i==null?void 0:i.getId()}),!0}return!1},r.prototype._processMainScrollingEvent=function(e,t){if(this._startScrollCoordinate!==null){var i=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&!i.getAutoCalcTickFlag()&&i.scrollZoomEnabled){var a=this._prevYAxisRange,n=a.from,o=a.to,s=a.range,l=0;i.reverse?l=this._startScrollCoordinate.y-t.y:l=t.y-this._startScrollCoordinate.y;var u=e.getBounding(),h=l/u.height,c=s*h,v=n+c,d=o+c,g=i.valueToRealValue(v,{range:this._prevYAxisRange}),f=i.valueToRealValue(d,{range:this._prevYAxisRange}),p=i.realValueToDisplayValue(g,{range:this._prevYAxisRange}),m=i.realValueToDisplayValue(f,{range:this._prevYAxisRange});i.setRange({from:v,to:d,range:d-v,realFrom:g,realTo:f,realRange:f-g,displayFrom:p,displayTo:m,displayRange:m-p})}var _=t.x-this._startScrollCoordinate.x;this._chart.getChartStore().scroll(_)}},r.prototype._processXAxisScrollStartEvent=function(e,t){var i=e.dispatchEvent("mouseDownEvent",t);return i&&this._chart.updatePane(1),this._xAxisStartScaleCoordinate={x:t.x,y:t.y},this._xAxisStartScaleDistance=t.pageX,i},r.prototype._processXAxisScrollingEvent=function(e,t){var i,a=e.dispatchEvent("pressedMouseMoveEvent",t);if(a)this._chart.updatePane(1);else{var n=e.getPane().getAxisComponent();if(n.scrollZoomEnabled&&this._xAxisStartScaleDistance!==0){var o=this._xAxisStartScaleDistance/t.pageX;if(Number.isFinite(o)){var s=(o-this._xAxisScale)*10;this._xAxisScale=o,this._chart.getChartStore().zoom(s,(i=this._xAxisStartScaleCoordinate)!==null&&i!==void 0?i:void 0)}}}return a},r.prototype._processYAxisScaleStartEvent=function(e,t){var i=e.dispatchEvent("mouseDownEvent",t);i&&this._chart.updatePane(1);var a=e.getPane().getAxisComponent().getRange();return this._prevYAxisRange=R({},a),this._yAxisStartScaleDistance=t.pageY,i},r.prototype._processYAxisScalingEvent=function(e,t){var i=e.dispatchEvent("pressedMouseMoveEvent",t);if(i)this._chart.updatePane(1);else{var a=e.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&a.scrollZoomEnabled&&this._yAxisStartScaleDistance!==0){var n=this._prevYAxisRange,o=n.from,s=n.to,l=n.range,u=t.pageY/this._yAxisStartScaleDistance,h=l*u,c=(h-l)/2,v=o-c,d=s+c,g=a.valueToRealValue(v,{range:this._prevYAxisRange}),f=a.valueToRealValue(d,{range:this._prevYAxisRange}),p=a.realValueToDisplayValue(g,{range:this._prevYAxisRange}),m=a.realValueToDisplayValue(f,{range:this._prevYAxisRange});a.setRange({from:v,to:d,range:h,realFrom:g,realTo:f,realRange:f-g,displayFrom:p,displayTo:m,displayRange:m-p}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})}}return i},r.prototype._findWidgetByEvent=function(e){var t,i,a,n,o=e.x,s=e.y,l=this._chart.getSeparatorPanes(),u=this._chart.getStyles().separator.size;try{for(var h=ut(l),c=h.next();!c.done;c=h.next()){var v=It(c.value,2),d=v[1],g=d.getBounding(),f=g.top-Math.round((ee-u)/2);if(o>=g.left&&o<=g.left+g.width&&s>=f&&s<=f+ee)return{pane:d,widget:d.getWidget()}}}catch(T){t={error:T}}finally{try{c&&!c.done&&(i=h.return)&&i.call(h)}finally{if(t)throw t.error}}var p=this._chart.getDrawPanes(),m=null;try{for(var _=ut(p),x=_.next();!x.done;x=_.next()){var b=x.value,g=b.getBounding();if(o>=g.left&&o<=g.left+g.width&&s>=g.top&&s<=g.top+g.height){m=b;break}}}catch(T){a={error:T}}finally{try{x&&!x.done&&(n=_.return)&&n.call(_)}finally{if(a)throw a.error}}var y=null;if(m!==null){if(!S(y)){var E=m.getMainWidget(),C=E.getBounding();o>=C.left&&o<=C.left+C.width&&s>=C.top&&s<=C.top+C.height&&(y=E)}if(!S(y)){var w=m.getYAxisWidget();if(w!==null){var I=w.getBounding();o>=I.left&&o<=I.left+I.width&&s>=I.top&&s<=I.top+I.height&&(y=w)}}}return{pane:m,widget:y}},r.prototype._makeWidgetEvent=function(e,t){var i,a,n,o=(i=t==null?void 0:t.getBounding())!==null&&i!==void 0?i:null;return R(R({},e),{x:e.x-((a=o==null?void 0:o.left)!==null&&a!==void 0?a:0),y:e.y-((n=o==null?void 0:o.top)!==null&&n!==void 0?n:0)})},r.prototype.destroy=function(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()},r}(),wt;(function(r){r.Root="root",r.Main="main",r.YAxis="yAxis"})(wt||(wt={}));var Lr=function(){function r(e,t){this._chartBounding=ye(),this._drawPanes=[],this._separatorPanes=new Map,this._layoutOptions={sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!1,forceBuildYAxisTick:!1},this._layoutPending=!1,this._initContainer(e),this._chartEvent=new _n(this._chartContainer,this),this._chartStore=new ga(this,t),this._initPanes(t),this._layout()}return r.prototype._initContainer=function(e){this._container=e,this._chartContainer=Dt("div",{position:"relative",width:"100%",height:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",overflow:"hidden",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,e.appendChild(this._chartContainer),this._cacheChartBounding()},r.prototype._cacheChartBounding=function(){this._chartBounding.width=Math.floor(this._chartContainer.clientWidth),this._chartBounding.height=Math.floor(this._chartContainer.clientHeight)},r.prototype._initPanes=function(e){var t=this,i,a=(i=e==null?void 0:e.layout)!==null&&i!==void 0?i:[{type:"candle"}],n=function(s){var l,u;if(!S(t._candlePane)){var h=(l=s.options)!==null&&l!==void 0?l:{};q(h,{id:N.CANDLE}),t._candlePane=t._createPane(nn,N.CANDLE,h);var c=(u=s.content)!==null&&u!==void 0?u:[];c.forEach(function(v){t.createIndicator(v,!0,h)})}},o=function(s){if(!S(t._xAxisPane)){var l=t._createPane(dn,N.X_AXIS,s??{});t._xAxisPane=l}};a.forEach(function(s){var l,u,h;switch(s.type){case"candle":{n(s);break}case"indicator":{var c=(l=s.content)!==null&&l!==void 0?l:[];if(c.length>0){var v=(h=(u=s.options)===null||u===void 0?void 0:u.id)!==null&&h!==void 0?h:null;S(v)&&(v=ve(N.INDICATOR));var d=R(R({},s.options),{id:v});c.forEach(function(g){t.createIndicator(g,!0,d)})}break}case"xAxis":{o(s.options);break}}}),n({}),o({order:Number.MAX_SAFE_INTEGER})},r.prototype._createPane=function(e,t,i){var a=new e(this,t,i??{});return this._drawPanes.push(a),a},r.prototype._recalculatePaneHeight=function(e,t,i){if(i===0)return!1;var a=this._drawPanes.filter(function(c){var v=c.getId();return c.getOptions().state==="normal"&&v!==e.getId()&&v!==N.X_AXIS}),n=a.length;if(n===0)return!1;if(e.getId()!==N.CANDLE&&S(this._candlePane)&&this._candlePane.getOptions().state==="normal"){var o=this._candlePane.getBounding().height;if(o>0){var s=this._candlePane.getOptions().minHeight,l=o+i;l<s&&(l=s,t-=o+i-l),this._candlePane.setBounding({height:l})}}else{var u=i,h=Math.floor(i/n);a.forEach(function(c,v){var d=c.getBounding().height,g=0;v===n-1?g=d+u:g=d+h,g<c.getOptions().minHeight&&(g=c.getOptions().minHeight),c.setBounding({height:g}),u-=g-d}),Math.abs(u)>0&&(t-=u)}return e.setBounding({height:t}),!0},r.prototype.getDrawPaneById=function(e){if(e===N.CANDLE)return this._candlePane;if(e===N.X_AXIS)return this._xAxisPane;var t=this._drawPanes.find(function(i){return i.getId()===e});return t??null},r.prototype.getContainer=function(){return this._container},r.prototype.getChartStore=function(){return this._chartStore},r.prototype.getXAxisPane=function(){return this._xAxisPane},r.prototype.getDrawPanes=function(){return this._drawPanes},r.prototype.getSeparatorPanes=function(){return this._separatorPanes},r.prototype.layout=function(e){var t=this,i,a,n,o,s,l;(i=e.sort)!==null&&i!==void 0&&i&&(this._layoutOptions.sort=e.sort),(a=e.measureHeight)!==null&&a!==void 0&&a&&(this._layoutOptions.measureHeight=e.measureHeight),(n=e.measureWidth)!==null&&n!==void 0&&n&&(this._layoutOptions.measureWidth=e.measureWidth),(o=e.update)!==null&&o!==void 0&&o&&(this._layoutOptions.update=e.update),(s=e.buildYAxisTick)!==null&&s!==void 0&&s&&(this._layoutOptions.buildYAxisTick=e.buildYAxisTick),(l=e.buildYAxisTick)!==null&&l!==void 0&&l&&(this._layoutOptions.forceBuildYAxisTick=e.forceBuildYAxisTick),this._layoutPending||(this._layoutPending=!0,Promise.resolve().then(function(u){t._layout(),t._layoutPending=!1}).catch(function(u){}))},r.prototype._layout=function(){var e=this,t=this._layoutOptions,i=t.sort,a=t.measureHeight,n=t.measureWidth,o=t.update,s=t.buildYAxisTick,l=t.forceBuildYAxisTick;if(i){for(;S(this._chartContainer.firstChild);)this._chartContainer.removeChild(this._chartContainer.firstChild);this._separatorPanes.clear(),this._drawPanes.sort(function(P,k){return P.getOptions().order-k.getOptions().order});var u=null;this._drawPanes.forEach(function(P){if(P.getId()!==N.X_AXIS){if(S(u)){var k=new pn(e,"",u,P);e._chartContainer.appendChild(k.getContainer()),e._separatorPanes.set(P,k)}u=P}e._chartContainer.appendChild(P.getContainer())})}if(a){var h=this._chartBounding.height,c=this.getStyles().separator.size,v=this._xAxisPane.getAxisComponent().getAutoSize(),d=h-v;d<0&&(d=0),this._drawPanes.forEach(function(P){var k=P.getId();if(S(e._separatorPanes.get(P))&&(d-=c),k!==N.X_AXIS&&k!==N.CANDLE&&P.getVisible()){var O=P.getBounding().height;O>d?(O=d,d=0):d-=O,P.setBounding({height:O})}}),this._candlePane.setBounding({height:Math.max(d,0)}),this._xAxisPane.setBounding({height:v});var g=0;this._drawPanes.forEach(function(P){var k=e._separatorPanes.get(P);S(k)&&(k.setBounding({height:c,top:g}),g+=c),P.setBounding({top:g}),g+=P.getBounding().height})}var f=n;if((s||l)&&this._drawPanes.forEach(function(P){var k=P.getAxisComponent().buildTicks(l);f||(f=k)}),f){var p=this._chartBounding.width,m=this.getStyles(),_=0,x=!0,b=0,y=!0;this._drawPanes.forEach(function(P){if(P.getId()!==N.X_AXIS){var k=P.getAxisComponent(),O=k.inside,z=k.getAutoSize();k.position===kt.Left?(_=Math.max(_,z),O&&(x=!1)):(b=Math.max(b,z),O&&(y=!1))}});var E=p,C=0,w=0;x&&(E-=_,C=_),y&&(E-=b,w=b),this._chartStore.setTotalBarSpace(E);var I={width:p},T={width:E,left:C,right:w},M={width:_},F={width:b},A=m.separator.fill,D={};A?D=I:D=T,this._drawPanes.forEach(function(P){var k;(k=e._separatorPanes.get(P))===null||k===void 0||k.setBounding(D),P.setBounding(I,T,M,F)})}o&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(4)),this._layoutOptions={sort:!1,measureHeight:!1,measureWidth:!1,update:!1,buildYAxisTick:!1,forceBuildYAxisTick:!1}},r.prototype.updatePane=function(e,t){var i=this;if(S(t)){var a=this.getDrawPaneById(t);a==null||a.update(e)}else this._drawPanes.forEach(function(n){var o;n.update(e),(o=i._separatorPanes.get(n))===null||o===void 0||o.update(e)})},r.prototype.crosshairChange=function(e){var t=this;if(this._chartStore.hasAction(_t.OnCrosshairChange)){var i={};this._drawPanes.forEach(function(a){var n=a.getId(),o={},s=t._chartStore.getIndicatorsByPaneId(n);s.forEach(function(l){var u,h=l.result;o[l.name]=h[(u=e.dataIndex)!==null&&u!==void 0?u:h.length-1]}),i[n]=o}),Y(e.paneId)&&this._chartStore.executeAction(_t.OnCrosshairChange,R(R({},e),{indicatorData:i}))}},r.prototype.getDom=function(e,t){var i,a;if(S(e)){var n=this.getDrawPaneById(e);if(S(n)){var o=t??wt.Root;switch(o){case wt.Root:return n.getContainer();case wt.Main:return n.getMainWidget().getContainer();case wt.YAxis:return(a=(i=n.getYAxisWidget())===null||i===void 0?void 0:i.getContainer())!==null&&a!==void 0?a:null}}}else return this._chartContainer;return null},r.prototype.getSize=function(e,t){var i,a;if(S(e)){var n=this.getDrawPaneById(e);if(S(n)){var o=t??wt.Root;switch(o){case wt.Root:return n.getBounding();case wt.Main:return n.getMainWidget().getBounding();case wt.YAxis:return(a=(i=n.getYAxisWidget())===null||i===void 0?void 0:i.getBounding())!==null&&a!==void 0?a:null}}}else return this._chartBounding;return null},r.prototype.setPrecision=function(e){this._chartStore.setPrecision(e)},r.prototype.getPrecision=function(){return this._chartStore.getPrecision()},r.prototype.setStyles=function(e){var t=this;this._setOptions(function(){t._chartStore.setStyles(e)})},r.prototype.getStyles=function(){return this._chartStore.getStyles()},r.prototype.setCustomApi=function(e){var t=this;this._setOptions(function(){t._chartStore.setCustomApi(e)})},r.prototype.getCustomApi=function(){return this._chartStore.getCustomApi()},r.prototype.setLocale=function(e){var t=this;this._setOptions(function(){t._chartStore.setLocale(e)})},r.prototype.getLocale=function(){return this._chartStore.getLocale()},r.prototype.setTimezone=function(e){var t=this;this._setOptions(function(){t._chartStore.setTimezone(e)})},r.prototype.getTimezone=function(){return this._chartStore.getTimezone()},r.prototype.setThousandsSeparator=function(e){var t=this;this._setOptions(function(){t._chartStore.setThousandsSeparator(e)})},r.prototype.getThousandsSeparator=function(){return this._chartStore.getThousandsSeparator()},r.prototype.setDecimalFold=function(e){var t=this;this._setOptions(function(){t._chartStore.setDecimalFold(e)})},r.prototype.getDecimalFold=function(){return this._chartStore.getDecimalFold()},r.prototype._setOptions=function(e){e(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})},r.prototype.setOffsetRightDistance=function(e){this._chartStore.setOffsetRightDistance(e,!0)},r.prototype.getOffsetRightDistance=function(){return this._chartStore.getOffsetRightDistance()},r.prototype.setMaxOffsetLeftDistance=function(e){e<0||this._chartStore.setMaxOffsetLeftDistance(e)},r.prototype.setMaxOffsetRightDistance=function(e){e<0||this._chartStore.setMaxOffsetRightDistance(e)},r.prototype.setLeftMinVisibleBarCount=function(e){e<0||this._chartStore.setLeftMinVisibleBarCount(Math.ceil(e))},r.prototype.setRightMinVisibleBarCount=function(e){e<0||this._chartStore.setRightMinVisibleBarCount(Math.ceil(e))},r.prototype.setBarSpace=function(e){this._chartStore.setBarSpace(e)},r.prototype.getBarSpace=function(){return this._chartStore.getBarSpace()},r.prototype.getVisibleRange=function(){return this._chartStore.getVisibleRange()},r.prototype.clearData=function(){this._chartStore.clearData()},r.prototype.getDataList=function(){return this._chartStore.getDataList()},r.prototype.applyNewData=function(e,t){this._drawPanes.forEach(function(a){a.getAxisComponent().setAutoCalcTickFlag(!0)});var i={forward:!1,backward:!1};Ce(t)?(i.forward=t,i.backward=t):i=R(R({},i),t),this._chartStore.addData(e,st.Init,i)},r.prototype.updateData=function(e){this._chartStore.addData(e,st.Update)},r.prototype.setLoadMoreDataCallback=function(e){this._chartStore.setLoadMoreDataCallback(e)},r.prototype.createIndicator=function(e,t,i){var a,n=Y(e)?{name:e}:e;if(fr(n.name)===null)return null;var o=i??{};Y(o.id)||(o.id=ve(N.INDICATOR)),Y(n.id)||(n.id=ve(n.name));var s=this._chartStore.addIndicator(n,o.id,t??!1);if(s){var l=!1;return S(this.getDrawPaneById(o.id))||(this._createPane(Or,o.id,o),(a=o.height)!==null&&a!==void 0||(o.height=_r),l=!0),this.setPaneOptions(o),this.layout({sort:l,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0}),n.id}return null},r.prototype.overrideIndicator=function(e){return this._chartStore.overrideIndicator(e)},r.prototype.getIndicators=function(e){return this._chartStore.getIndicatorsByFilter(e??{})},r.prototype.removeIndicator=function(e){var t=this,i=this._chartStore.removeIndicator(e??{});if(i){var a=!1,n=[];this._drawPanes.forEach(function(o){var s=o.getId();s!==N.CANDLE&&s!==N.X_AXIS&&n.push(s)}),n.forEach(function(o){if(!t._chartStore.hasIndicators(o)){var s=t._drawPanes.findIndex(function(u){return u.getId()===o}),l=t._drawPanes[s];S(l)&&(a=!0,t._recalculatePaneHeight(l,0,l.getBounding().height),t._drawPanes.splice(s,1),l.destroy())}}),this._drawPanes.length===2&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:a,measureHeight:a,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return i},r.prototype.createOverlay=function(e){var t=this,i=[],a=[],n=function(s){!S(s.paneId)||t.getDrawPaneById(s.paneId)===null?(s.paneId=N.CANDLE,a.push(!1)):a.push(!0),i.push(s)};Y(e)?n({name:e}):At(e)?e.forEach(function(s){var l=null;Y(s)?l={name:s}:l=s,n(l)}):n(e);var o=this._chartStore.addOverlays(i,a);return At(e)?o:o[0]},r.prototype.getOverlays=function(e){return this._chartStore.getOverlaysByFilter(e??{})},r.prototype.overrideOverlay=function(e){return this._chartStore.overrideOverlay(e)},r.prototype.removeOverlay=function(e){return this._chartStore.removeOverlay(e??{})},r.prototype.setPaneOptions=function(e){var t,i,a=this,n,o=!1,s=!1,l=S(e.id),u=function(f){var p=f.getId();if(l&&e.id===p||!l){if(p!==N.X_AXIS){if(B(e.height)&&e.height>0){var m=Math.max((n=e.minHeight)!==null&&n!==void 0?n:f.getOptions().minHeight,0),_=Math.max(m,e.height);s=!0,o=!0,f.setOriginalBounding({height:_}),h._recalculatePaneHeight(f,_,-_)}if(S(e.state)&&f.getOptions().state!==e.state){o=!0,s=!0;var x=e.state;switch(x){case"maximize":{var b=h._drawPanes.find(function(I){var T=I.getId();return I.getOptions().state==="maximize"&&T!==N.X_AXIS});if(!S(b)){f.getOptions().state==="normal"&&f.setOriginalBounding({height:f.getBounding().height}),f.setOptions({state:x});var y=h._chartBounding.height;f.setBounding({height:y-h._xAxisPane.getBounding().height}),h._drawPanes.forEach(function(I){var T;I.getId()!==N.X_AXIS&&I.getId()!==p&&(I.setBounding({height:I.getOriginalBounding().height}),I.setVisible(!1),(T=a._separatorPanes.get(I))===null||T===void 0||T.setVisible(!1))})}break}case"minimize":{var _=f.getBounding().height,E=f.getOptions().state,C=_-de;E==="maximize"&&(C=f.getOriginalBounding().height-de),h._recalculatePaneHeight(f,de,C)&&(E==="normal"&&f.setOriginalBounding({height:_}),f.setOptions({state:x})),h._drawPanes.forEach(function(T){var M;T.getId()!==N.X_AXIS&&(T.setVisible(!0),(M=a._separatorPanes.get(T))===null||M===void 0||M.setVisible(!0))});break}default:{var _=f.getOriginalBounding().height;h._recalculatePaneHeight(f,_,f.getBounding().height-_)&&f.setOptions({state:x}),h._drawPanes.forEach(function(T){var M;T.getId()!==N.X_AXIS&&(T.setVisible(!0),(M=a._separatorPanes.get(T))===null||M===void 0||M.setVisible(!0))});break}}}}S(e.axis)&&(s=!0);var w=R({},e);if(delete w.state,f.setOptions(w),p===e.id)return"break"}},h=this;try{for(var c=ut(this._drawPanes),v=c.next();!v.done;v=c.next()){var d=v.value,g=u(d);if(g==="break")break}}catch(f){t={error:f}}finally{try{v&&!v.done&&(i=c.return)&&i.call(c)}finally{if(t)throw t.error}}s&&this.layout({measureHeight:o,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})},r.prototype.getPaneOptions=function(e){var t;if(S(e)){var i=this.getDrawPaneById(e);return(t=i==null?void 0:i.getOptions())!==null&&t!==void 0?t:null}return this._drawPanes.map(function(a){return a.getOptions()})},r.prototype.setZoomEnabled=function(e){this._chartStore.setZoomEnabled(e)},r.prototype.isZoomEnabled=function(){return this._chartStore.isZoomEnabled()},r.prototype.setScrollEnabled=function(e){this._chartStore.setScrollEnabled(e)},r.prototype.isScrollEnabled=function(){return this._chartStore.isScrollEnabled()},r.prototype.scrollByDistance=function(e,t){var i=this,a=B(t)&&t>0?t:0;if(this._chartStore.startScroll(),a>0){var n=new Ae({duration:a});n.doFrame(function(o){var s=e*(o/a);i._chartStore.scroll(s)}),n.start()}else this._chartStore.scroll(e)},r.prototype.scrollToRealTime=function(e){var t=this._chartStore.getBarSpace().bar,i=this._chartStore.getLastBarRightSideDiffBarCount()-this._chartStore.getInitialOffsetRightDistance()/t,a=i*t;this.scrollByDistance(a,e)},r.prototype.scrollToDataIndex=function(e,t){var i=(this._chartStore.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-e))*this._chartStore.getBarSpace().bar;this.scrollByDistance(i,t)},r.prototype.scrollToTimestamp=function(e,t){var i=ke(this.getDataList(),"timestamp",e);this.scrollToDataIndex(i,t)},r.prototype.zoomAtCoordinate=function(e,t,i){var a=this,n=B(i)&&i>0?i:0,o=this._chartStore.getBarSpace().bar,s=o*e,l=s-o;if(n>0){var u=0,h=new Ae({duration:n});h.doFrame(function(c){var v=l*(c/n),d=(v-u)/a._chartStore.getBarSpace().bar*Re;a._chartStore.zoom(d,t),u=v}),h.start()}else this._chartStore.zoom(l/o*Re,t)},r.prototype.zoomAtDataIndex=function(e,t,i){var a=this._chartStore.dataIndexToCoordinate(t);this.zoomAtCoordinate(e,{x:a,y:0},i)},r.prototype.zoomAtTimestamp=function(e,t,i){var a=ke(this.getDataList(),"timestamp",t);this.zoomAtDataIndex(e,a,i)},r.prototype.convertToPixel=function(e,t){var i=this,a,n=t??{},o=n.paneId,s=o===void 0?N.CANDLE:o,l=n.absolute,u=l===void 0?!1:l,h=[];if(s!==N.X_AXIS){var c=this.getDrawPaneById(s);if(c!==null){var v=c.getBounding(),d=[].concat(e),g=this._xAxisPane.getAxisComponent(),f=c.getAxisComponent();h=d.map(function(p){var m={},_=p.dataIndex;if(B(p.timestamp)&&(_=i._chartStore.timestampToDataIndex(p.timestamp)),B(_)&&(m.x=g.convertToPixel(_)),B(p.value)){var x=f.convertToPixel(p.value);m.y=u?v.top+x:x}return m})}}return At(e)?h:(a=h[0])!==null&&a!==void 0?a:{}},r.prototype.convertFromPixel=function(e,t){var i=this,a,n=t??{},o=n.paneId,s=o===void 0?N.CANDLE:o,l=n.absolute,u=l===void 0?!1:l,h=[];if(s!==N.X_AXIS){var c=this.getDrawPaneById(s);if(c!==null){var v=c.getBounding(),d=[].concat(e),g=this._xAxisPane.getAxisComponent(),f=c.getAxisComponent();h=d.map(function(p){var m,_={};if(B(p.x)){var x=g.convertFromPixel(p.x);_.dataIndex=x,_.timestamp=(m=i._chartStore.dataIndexToTimestamp(x))!==null&&m!==void 0?m:void 0}if(B(p.y)){var b=u?p.y-v.top:p.y;_.value=f.convertFromPixel(b)}return _})}}return At(e)?h:(a=h[0])!==null&&a!==void 0?a:{}},r.prototype.executeAction=function(e,t){var i;switch(e){case _t.OnCrosshairChange:{var a=R({},t);(i=a.paneId)!==null&&i!==void 0||(a.paneId=N.CANDLE),this._chartStore.setCrosshair(a,{notExecuteAction:!0});break}}},r.prototype.subscribeAction=function(e,t){this._chartStore.subscribeAction(e,t)},r.prototype.unsubscribeAction=function(e,t){this._chartStore.unsubscribeAction(e,t)},r.prototype.getConvertPictureUrl=function(e,t,i){var a=this,n=this._chartBounding,o=n.width,s=n.height,l=Dt("canvas",{width:"".concat(o,"px"),height:"".concat(s,"px"),boxSizing:"border-box"}),u=l.getContext("2d"),h=Ot(l);l.width=o*h,l.height=s*h,u.scale(h,h),u.fillStyle=i??"#FFFFFF",u.fillRect(0,0,o,s);var c=e??!1;return this._drawPanes.forEach(function(v){var d=a._separatorPanes.get(v);if(S(d)){var g=d.getBounding();u.drawImage(d.getImage(c),g.left,g.top,g.width,g.height)}var f=v.getBounding();u.drawImage(v.getImage(c),0,f.top,o,f.height)}),l.toDataURL("image/".concat(t??"jpeg"))},r.prototype.resize=function(){this._cacheChartBounding(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})},r.prototype.destroy=function(){this._chartEvent.destroy(),this._drawPanes.forEach(function(e){e.destroy()}),this._drawPanes=[],this._separatorPanes.clear(),this._container.removeChild(this._chartContainer)},r}(),be=new Map,xn=1;function bn(r,e){var t=null;if(Y(r)?t=document.getElementById(r):t=r,t===null)return null;var i=be.get(t.id);if(S(i))return i;var a="k_line_chart_".concat(xn++);return i=new Lr(t,e),i.id=a,t.setAttribute("k-line-chart-id",a),be.set(a,i),i}function Cn(r){var e,t,i=null;if(r instanceof Lr)i=r.id;else{var a=null;Y(r)?a=document.getElementById(r):a=r,i=(e=a==null?void 0:a.getAttribute("k-line-chart-id"))!==null&&e!==void 0?e:null}i!==null&&((t=be.get(i))===null||t===void 0||t.destroy(),be.delete(i))}const wn=["MA","EMA","BOLL","MACD","RSI","WR","VOL"],Sn=["1m","5m","15m","1h","4h","1d"],or={"1m":"1m","5m":"5m","15m":"15m","1h":"1h","4h":"4h","1d":"1d"},En=["candle","bar","area"],In=(r,e,t)=>{const n=t?{id:"candle_pane"}:{id:"osc_pane",height:140},o=[()=>r.createIndicator&&r.createIndicator(e,t,n),()=>r.createIndicator&&r.createIndicator({name:e},t,n),()=>r.createTechnicalIndicator&&r.createTechnicalIndicator(e,t,n),()=>r.createTechnicalIndicator&&r.createTechnicalIndicator({name:e},t,n),()=>r.addIndicator&&r.addIndicator(e,n),()=>r.addTechnicalIndicator&&r.addTechnicalIndicator(e,t,n),()=>r.overrideIndicator&&r.overrideIndicator(e,n)];for(const s of o)try{const l=s();if(typeof l=="string")return l;if(l&&typeof l=="object"){if("id"in l)return l.id;if("indicatorId"in l)return l.indicatorId}if(l===void 0)return!0}catch{}return console.warn("[kline-compat] failed to create indicator:",e),null},Tn=(r,e)=>{const t=[()=>r.removeIndicator&&r.removeIndicator({id:e}),()=>r.removeTechnicalIndicatorByName&&r.removeTechnicalIndicatorByName(e),()=>r.removeTechnicalIndicator&&r.removeTechnicalIndicator(e),()=>r.removeIndicatorById&&r.removeIndicatorById(e),()=>r.removeIndicatorByName&&r.removeIndicatorByName(e),()=>r.removeIndicator&&r.removeIndicator(e)];for(const i of t)try{if(i()!==void 0)return!0}catch{}try{if(r.removeTechnicalIndicator)return r.removeTechnicalIndicator(e),!0}catch{}return console.warn("[kline-compat] failed to remove indicator:",e),!1},Mn=({symbol:r="BTCUSDT"})=>{const e=Ft.useRef(null),t=Ft.useRef(null),[i,a]=Ft.useState("1m"),[n,o]=Ft.useState({}),[s,l]=Ft.useState("candle"),u=async v=>{var d,g,f,p;try{const m=`https://api.binance.com/api/v3/klines?symbol=${r}&interval=${or[v]}&limit=500`,b=(await(await fetch(m)).json()).map(y=>({timestamp:y[0],open:+y[1],high:+y[2],low:+y[3],close:+y[4],volume:+y[5]}));(g=(d=e.current)==null?void 0:d.applyNewData)==null||g.call(d,b),(p=(f=e.current)==null?void 0:f.setData)==null||p.call(f,b)}catch(m){console.error("loadData error",m)}},h=v=>{var g;(g=t.current)==null||g.close();const d=`wss://stream.binance.com:9443/ws/${r.toLowerCase()}@kline_${or[v]}`;try{const f=new WebSocket(d);t.current=f,f.onmessage=p=>{var b,y,E,C;const m=JSON.parse(p.data),_=m==null?void 0:m.k;if(!_)return;const x={timestamp:_.t,open:+_.o,high:+_.h,low:+_.l,close:+_.c,volume:+_.v};(y=(b=e.current)==null?void 0:b.updateData)==null||y.call(b,x),(C=(E=e.current)==null?void 0:E.appendData)==null||C.call(E,x)}}catch(f){console.warn("WS start failed",f)}};Ft.useEffect(()=>{var g;const v=bn("futures-chart");e.current=v,(g=v.setStyles)==null||g.call(v,{candle:{type:"candle_solid",bar:{upColor:"#0ECB81",downColor:"#F6465D",noChangeColor:"#999"},priceMark:{last:{line:{color:"#888",style:"dashed"},text:{color:"#fff",backgroundColor:"#888"}}}},grid:{horizontal:{color:"rgba(255,255,255,0.06)"},vertical:{color:"rgba(255,255,255,0.03)"}}}),u(i),h(i);const d=()=>{var f;return(f=v.resize)==null?void 0:f.call(v)};return window.addEventListener("resize",d),()=>{var f;window.removeEventListener("resize",d),(f=t.current)==null||f.close(),Cn("futures-chart")}},[]),Ft.useEffect(()=>{e.current&&(u(i),h(i))},[i,r]),Ft.useEffect(()=>{var v,d,g,f,p,m;e.current&&(s==="candle"?(d=(v=e.current).setStyles)==null||d.call(v,{candle:{type:"candle_solid"}}):s==="bar"?(f=(g=e.current).setStyles)==null||f.call(g,{candle:{type:"candle_stroke"}}):s==="area"&&((m=(p=e.current).setStyles)==null||m.call(p,{candle:{type:"area",area:{lineColor:"#0ECB81",lineSize:2,gradient:[{offset:0,color:"rgba(14,203,129,0.35)"},{offset:1,color:"rgba(14,203,129,0.04)"}]}}})))},[s]);const c=v=>{const d=e.current;if(!d)return;const g=n[v];if(g){Tn(d,typeof g=="string"?g:v);const x={...n};delete x[v],o(x);return}const p=["MA","EMA","BOLL","VOL","BBI","SMA","SAR"].includes(v),m=In(d,v,p);o(m?_=>({..._,[v]:typeof m=="string"?m:!0}):_=>({..._,[v]:!0}))};return Ct.jsxs("div",{style:{width:"100%",height:"100%",background:"#0B0E11",color:"#fff",padding:8},children:[Ct.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:8,alignItems:"center"},children:[Ct.jsx("div",{style:{display:"flex",gap:6},children:Sn.map(v=>Ct.jsx("button",{onClick:()=>a(v),style:{padding:"6px 10px",background:i===v?"#0ECB81":"transparent",color:i===v?"#000":"#fff",borderRadius:6,border:"1px solid rgba(255,255,255,0.06)",cursor:"pointer"},children:v},v))}),Ct.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:Ct.jsx("select",{value:s,onChange:v=>l(v.target.value),style:{padding:"6px 10px",borderRadius:6,background:"#0B0E11",color:"#fff",border:"1px solid rgba(255,255,255,0.06)"},children:En.map(v=>Ct.jsx("option",{value:v,children:v},v))})})]}),Ct.jsx("div",{id:"futures-chart",style:{width:"100%",height:"380px"}}),Ct.jsx("div",{style:{display:"flex",gap:6},children:wn.map(v=>Ct.jsx("button",{onClick:()=>c(v),style:{padding:"6px 10px",borderRadius:6,background:n[v]?"#0ECB81":"transparent",color:n[v]?"#000":"#fff",border:"1px solid rgba(255,255,255,0.06)",cursor:"pointer"},children:v},v))})]})};export{Mn as F};
